<!DOCTYPE html><html lang="en"><head><title>tile</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="tile"><meta name="groc-project-path" content="source/tile.js"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path">source/tile.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="cm">/**</span>
<span class="cm">Tile constructor</span>
<span class="cm">@param {object} [options={}] options object to set properties</span>
<span class="cm">@classdesc A Tile that displays simple information and serves as a front door to the an underlying app.  The </span>
<span class="cm">tile is composted of a square div element that can be small, medium, or wide.  The height of the tile is 150px</span>
<span class="cm">for small and 300px for large tiles.  The width is expressed as bootstrap span units of 3(small), 6(medium), or</span>
<span class="cm">12(wide).  This base class provides mechanisms for injecting html into the DOM and showing or hiding the tile as</span>
<span class="cm">well as default styling</span>
<span class="cm">@class Tile</span>
<span class="cm">@constructor</span>
<span class="cm">@param {string}  [options.div_target] the div id into which to inject html, defaults to &quot;body&quot;</span>
<span class="cm">@param {string}  [options.div_id] the div id for generated html, defaults to &quot;Tile&quot; plus a random number</span>
<span class="cm">@param {string}  [options.style]  inline style specification, defaults to &quot;#bdbdbd&quot;</span>
<span class="cm">@param {string}  [options.color]  the background color of the tile, defuaults to </span>
<span class="cm">@param {string}  [options.tile_type]  tile type, can be &quot;small&quot;, &quot;medium&quot;, or &quot;wide&quot;, defaults to &quot;medium&quot;</span>
<span class="cm">@param {bool}  [options.display]  true to render the tile on object creation, false not to, defaults to true</span>

<span class="cm">**/</span>
<span class="kd">function</span> <span class="nx">Tile</span><span class="p">(</span><span class="nx">options</span><span class="p">){</span>
  <span class="nx">options</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">options</span> <span class="o">:</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">div_target</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">div_target</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">div_target</span> <span class="o">:</span> <span class="s2">&quot;body&quot;</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">:</span> <span class="s2">&quot;Tile&quot;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">1000000000</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">link</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">link</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">link</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">style</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">style</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">style</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">color</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">color</span> <span class="o">:</span> <span class="s2">&quot;#bdbdbd&quot;</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">display</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">display</span> <span class="o">:</span> <span class="kc">true</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>initialize the tile</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">init_state</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm">Initializes Tile by building the appropriate html and injecting it into the DOM</span>
<span class="cm">@memberof Tile</span>
<span class="cm">@method init </span>
<span class="cm">**/</span>
<span class="nx">Tile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>build the html to inject into the DOM</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">build_html</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>inject the html into the target div</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">inject</span><span class="p">();</span>

  <span class="c1">//draw the background of the tile</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw_bg</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set the initialization flag to true</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">init_state</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>bind the tile to redraw when the window resizes</p></div></div><div class="code"><div class="wrapper">  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">resize</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nx">self</span><span class="p">.</span><span class="nx">draw_bg</span><span class="p">();}</span> <span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">Builds the html for the tile based on the tile_type given in the constructor</span>
<span class="cm">@memberof Tile</span>
<span class="cm">@method build_html </span>
<span class="cm">**/</span>
<span class="nx">Tile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">build_html</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;small&quot;</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;div id=&quot;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">+</span> <span class="s1">&#39;&quot; class=&quot;span3&quot; style=&quot;height:150px &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">style</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;medium&quot;</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;div id=&quot;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">+</span> <span class="s1">&#39;&quot; class=&quot;span6&quot; style=&quot;height:300px &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">style</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;wide&quot;</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;div id=&quot;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">+</span> <span class="s1">&#39;&quot; class=&quot;span12&quot; style=&quot;height:300px &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">style</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">Injects the Tile&#39;s html into the DOM at the target id given in the constructor</span>
<span class="cm">@memberof Tile</span>
<span class="cm">@method inject</span>
<span class="cm">**/</span>
<span class="nx">Tile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">inject</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">div_target</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">html</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">draws the tiles background using d3.js</span>
<span class="cm">@memberof Tile</span>
<span class="cm">@method draw_bg </span>
<span class="cm">**/</span>
<span class="nx">Tile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">draw_bg</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>get the correct height and width to draw</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">outerWidth</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;small&quot;</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up a top level svg selection if the tile needs to be initialized</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">init_state</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="o">=</span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">+</span> <span class="s2">&quot;_tile_svg&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>add a group to drawing elements</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;draw_layer&quot;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>add a group to link elements</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;link_layer&quot;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>add the link</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">link_selection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;.link_layer&#39;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;rect.link_rect&quot;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">]);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">link_selection</span><span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;xlink:href&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">link</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;rect&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;rx&quot;</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;ry&quot;</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;link_rect&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">color</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>(re)draw the background</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;.draw_layer&#39;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;rect.bg&quot;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;.draw_layer&#39;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;rect.bg&quot;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
      <span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;rect&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;rx&quot;</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;ry&quot;</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;bg&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">hides the tile</span>
<span class="cm">@param {object} [duration=0] the duration of a fade out animation applied before hiding the tile</span>
<span class="cm">@memberof Tile</span>
<span class="cm">@method hide </span>
<span class="cm">**/</span>
<span class="nx">Tile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hide</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">duration</span> <span class="o">=</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">duration</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">width</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">height</span><span class="o">:</span><span class="mi">0</span><span class="p">},</span><span class="nx">duration</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">hide</span><span class="p">();},</span><span class="nx">duration</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">shows the tile</span>
<span class="cm">@param {object} [duration=0] the duration of a fade out animation applied after showing the tile</span>
<span class="cm">@memberof Tile</span>
<span class="cm">@method show </span>
<span class="cm">**/</span>
<span class="nx">Tile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">duration</span> <span class="o">=</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">duration</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">width</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="nx">height</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">},</span><span class="nx">duration</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">ImageTile constructor</span>
<span class="cm">@param {object} [options={}] options object to set properties</span>
<span class="cm">@classdesc A Tile that extends the base Tile to add an image in the center of the tile</span>
<span class="cm">@class ImageTile</span>
<span class="cm">@constructor</span>
<span class="cm">@extends Tile</span>
<span class="cm">@param {string}  [options.image] the url to use as the image,defaults to &quot;../Bellhop/img.two_circles.png&quot;</span>
<span class="cm">@param {string}  [options.div_target] the div id into which to inject html, defaults to &quot;body&quot;</span>
<span class="cm">@param {string}  [options.div_id] the div id for generated html, defaults to &quot;Tile&quot; plus a random number</span>
<span class="cm">@param {string}  [options.style] inline style specification, defaults to &quot;#f0f0f0&quot;</span>
<span class="cm">@param {string}  [options.color] the background color of the tile, defuaults to </span>
<span class="cm">@param {string}  [options.tile_type] tile type, can be &quot;small&quot;, &quot;medium&quot;, or &quot;wide&quot;, defaults to &quot;medium&quot;</span>

<span class="cm">**/</span>
<span class="kd">function</span> <span class="nx">ImageTile</span><span class="p">(</span><span class="nx">options</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">image</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">image</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">image</span> <span class="o">:</span> <span class="s2">&quot;../Bellhop/img/CMap_Logo_gray.png&quot;</span><span class="p">;</span>
  <span class="nx">Tile</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">resize</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nx">self</span><span class="p">.</span><span class="nx">draw</span><span class="p">();}</span> <span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
<span class="p">}</span>
<span class="nx">ImageTile</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Tile</span><span class="p">({</span><span class="nx">display</span><span class="o">:</span><span class="kc">false</span><span class="p">});</span>
<span class="nx">ImageTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">ImageTile</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">top level draw wrapper around draw\_bg and draw\_image</span>
<span class="cm">@memberof ImageTile</span>
<span class="cm">@method draw </span>
<span class="cm">**/</span>
<span class="nx">ImageTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw_bg</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw_image</span><span class="p">();</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">draws the tile&#39;s image using d3.js</span>
<span class="cm">@memberof ImageTile</span>
<span class="cm">@method draw_image </span>
<span class="cm">**/</span>
<span class="nx">ImageTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">draw_image</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>get the correct height and width to draw</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">outerWidth</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;small&quot;</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up a top level svg selection if the tile needs to be initialized</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">init_state</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="o">=</span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">+</span> <span class="s2">&quot;_tile_svg&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>(re)draw the image</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">image_size</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">50</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;.draw_layer&#39;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;image.&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">image_selection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;.draw_layer&#39;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;image.&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;xlink:href&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">image</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">image_size</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">image_size</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">image_size</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">image_size</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">AnimatedImageTextTile constructor</span>
<span class="cm">@param {object} [options={}] options object to set properties</span>
<span class="cm">@classdesc A Tile that extends the base Tile to add an image in the center of the tile</span>
<span class="cm">@class AnimatedImageTile</span>
<span class="cm">@constructor</span>
<span class="cm">@extends Tile</span>
<span class="cm">@param {string}  [options.image] the url to use as the image,defaults to &quot;../Bellhop/img.two_circles.png&quot;</span>
<span class="cm">@param {string}  [options.div_target] the div id into which to inject html, defaults to &quot;body&quot;</span>
<span class="cm">@param {string}  [options.div_id] the div id for generated html, defaults to &quot;Tile&quot; plus a random number</span>
<span class="cm">@param {string}  [options.style] inline style specification, defaults to &quot;#f0f0f0&quot;</span>
<span class="cm">@param {string}  [options.color] the background color of the tile, defuaults to </span>
<span class="cm">@param {string}  [options.tile_type] tile type, can be &quot;small&quot;, &quot;medium&quot;, or &quot;wide&quot;, defaults to &quot;medium&quot;</span>

<span class="cm">**/</span>
<span class="kd">function</span> <span class="nx">AnimatedImageTile</span><span class="p">(</span><span class="nx">options</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">image</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">image</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">image</span> <span class="o">:</span> <span class="s2">&quot;../Bellhop/img/CMap_Logo_gray.png&quot;</span><span class="p">;</span>
  <span class="nx">Tile</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">resize</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nx">self</span><span class="p">.</span><span class="nx">draw</span><span class="p">();}</span> <span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">start_animation</span><span class="p">();</span>
<span class="p">}</span>
<span class="nx">AnimatedImageTile</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ImageTile</span><span class="p">({</span><span class="nx">display</span><span class="o">:</span><span class="kc">false</span><span class="p">});</span>
<span class="nx">AnimatedImageTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">AnimatedImageTile</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">top level draw wrapper around draw\_bg and draw\_image</span>
<span class="cm">@memberof AnimatedImageTile</span>
<span class="cm">@method draw </span>
<span class="cm">**/</span>
<span class="nx">AnimatedImageTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw_bg</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw_image</span><span class="p">();</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">starts periodic animation of the Image on the Tile</span>
<span class="cm">@memberof AnimatedImageTile</span>
<span class="cm">@method start_animation </span>
<span class="cm">@param {int}  [duration=2000] duration the length of the animation in milliseconds</span>
<span class="cm">@param {int}  [frequency= 10000 to 20000] frequency the frequency of the animation in milliseconds</span>
<span class="cm">**/</span>
<span class="nx">AnimatedImageTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">start_animation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">,</span><span class="nx">frequency</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">duration</span> <span class="o">=</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">duration</span> <span class="o">:</span> <span class="mi">2000</span><span class="p">;</span>
  <span class="nx">frequency</span> <span class="o">=</span> <span class="p">(</span><span class="nx">frequency</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">frequency</span> <span class="o">:</span> <span class="mi">10000</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">image_selection</span><span class="p">.</span><span class="nx">transition</span><span class="p">().</span><span class="nx">duration</span><span class="p">(</span><span class="nx">duration</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="o">-</span><span class="nx">self</span><span class="p">.</span><span class="nx">image_size</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">transition</span><span class="p">().</span><span class="nx">duration</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">height</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">image_size</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">transition</span><span class="p">().</span><span class="nx">duration</span><span class="p">(</span><span class="nx">duration</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="nx">self</span><span class="p">.</span><span class="nx">image_size</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">},</span><span class="nx">frequency</span><span class="p">);</span>
<span class="p">};</span>


<span class="cm">/**</span>
<span class="cm">ImageTextTile constructor</span>
<span class="cm">@param {object} [options={}] options object to set properties</span>
<span class="cm">@classdesc A Tile that extends ImageTile to add text </span>
<span class="cm">@class ImageTextTile</span>
<span class="cm">@constructor</span>
<span class="cm">@extends ImageTile</span>
<span class="cm">@param {string}  [options.image] the url to use as the image,defaults to &quot;../Bellhop/img.two_circles.png&quot;</span>
<span class="cm">@param {string}  [options.div_target] the div id into which to inject html, defaults to &quot;body&quot;</span>
<span class="cm">@param {string}  [options.div_id] the div id for generated html, defaults to &quot;Tile&quot; plus a random number</span>
<span class="cm">@param {string}  [options.text] the text to display on the panel, defaults to &quot;Title&quot;</span>
<span class="cm">@param {string}  [options.style] inline style specification, defaults to &quot;#f0f0f0&quot;</span>
<span class="cm">@param {string}  [options.color] the background color of the tile, defuaults to </span>
<span class="cm">@param {string}  [options.tile_type] tile type, can be &quot;small&quot;, &quot;medium&quot;, or &quot;wide&quot;, defaults to &quot;medium&quot;</span>

<span class="cm">**/</span>
<span class="kd">function</span> <span class="nx">ImageTextTile</span><span class="p">(</span><span class="nx">options</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">title</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">title</span> <span class="o">:</span> <span class="s2">&quot;Title&quot;</span><span class="p">;</span>
  <span class="nx">ImageTile</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">resize</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nx">self</span><span class="p">.</span><span class="nx">draw</span><span class="p">();}</span> <span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
<span class="p">}</span>
<span class="nx">ImageTextTile</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ImageTile</span><span class="p">({</span><span class="nx">display</span><span class="o">:</span><span class="kc">false</span><span class="p">});</span>
<span class="nx">ImageTextTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">ImageTextTile</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">top level draw wrapper around draw\_bg and draw\_image and draw\_text</span>
<span class="cm">@memberof ImageTextTile</span>
<span class="cm">@method draw </span>
<span class="cm">**/</span>
<span class="nx">ImageTextTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw_bg</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw_image</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw_text</span><span class="p">();</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">draws the tile&#39;s text using d3.js</span>
<span class="cm">@memberof ImageTextTile</span>
<span class="cm">@method draw_text </span>
<span class="cm">**/</span>
<span class="nx">ImageTextTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">draw_text</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>get the correct height and width to draw</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">outerWidth</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;small&quot;</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up a top level svg selection if the tile needs to be initialized</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">init_state</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="o">=</span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">+</span> <span class="s2">&quot;_tile_svg&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>(re)draw the text</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;wide&quot;</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;medium&quot;</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">height</span><span class="p">,</span><span class="nx">width</span><span class="p">,</span><span class="nx">html</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;wide&quot;</span><span class="p">){</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">10</span><span class="o">*</span><span class="mi">5</span><span class="p">;</span>
      <span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">5</span><span class="p">;</span>
      <span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">20</span><span class="p">;</span>
      <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;h2&gt;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s1">&#39;&lt;/h2&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;medium&quot;</span><span class="p">){</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">10</span><span class="o">*</span><span class="mf">8.5</span><span class="p">;</span>
      <span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">10</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">;</span>
      <span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">40</span><span class="p">;</span>
      <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;h3&gt;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s1">&#39;&lt;/h3&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;.draw_layer&#39;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.tile_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;.draw_layer&#39;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.tile_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">title</span><span class="p">])</span>
      <span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;foreignObject&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;tile_text&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="nx">x</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="nx">height</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="nx">width</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;xhtml:div&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">color</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">AnimatedImageTextTile constructor</span>
<span class="cm">@param {object} [options={}] options object to set properties</span>
<span class="cm">@classdesc A Tile that extends ImageTile to add text that animates on mouseover</span>
<span class="cm">@class AnimatedImageTextTile</span>
<span class="cm">@constructor</span>
<span class="cm">@extends ImageTile</span>
<span class="cm">@param {string}  [options.image] the url to use as the image,defaults to &quot;../Bellhop/img.two_circles.png&quot;</span>
<span class="cm">@param {string}  [options.div_target] the div id into which to inject html, defaults to &quot;body&quot;</span>
<span class="cm">@param {string}  [options.div_id] the div id for generated html, defaults to &quot;Tile&quot; plus a random number</span>
<span class="cm">@param {string}  [options.text] the text to display on the panel, defaults to &quot;Title&quot;</span>
<span class="cm">@param {string}  [options.style] inline style specification, defaults to &quot;#f0f0f0&quot;</span>
<span class="cm">@param {string}  [options.color] the background color of the tile, defuaults to </span>
<span class="cm">@param {string}  [options.tile_type] tile type, can be &quot;small&quot;, &quot;medium&quot;, or &quot;wide&quot;, defaults to &quot;medium&quot;</span>

<span class="cm">**/</span>
<span class="kd">function</span> <span class="nx">AnimatedImageTextTile</span><span class="p">(</span><span class="nx">options</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">title</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">title</span> <span class="o">:</span> <span class="s2">&quot;Title&quot;</span><span class="p">;</span>
  <span class="nx">ImageTile</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">resize</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nx">self</span><span class="p">.</span><span class="nx">draw</span><span class="p">();}</span> <span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">TextIsAnimatingIn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">TextIsAnimatingOut</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">AnimatedImageTextTile</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ImageTile</span><span class="p">({</span><span class="nx">display</span><span class="o">:</span><span class="kc">false</span><span class="p">});</span>
<span class="nx">AnimatedImageTextTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">AnimatedImageTextTile</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">top level draw wrapper around draw\_bg and draw\_image and draw\_text</span>
<span class="cm">@memberof AnimatedImageTextTile</span>
<span class="cm">@method draw </span>
<span class="cm">**/</span>
<span class="nx">AnimatedImageTextTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw_bg</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw_image</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw_text</span><span class="p">();</span>
  <span class="c1">//add callbacks to expose the display of the animated text</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">link_selection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mouseover&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">show_text</span><span class="p">();});</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">link_selection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mouseout&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">hide_text</span><span class="p">();});</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">show the text in the Tile</span>
<span class="cm">@memberof AnimatedImageTextTile</span>
<span class="cm">@method show_text</span>
<span class="cm">**/</span>
<span class="nx">AnimatedImageTextTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">show_text</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">TextIsAnimating</span><span class="p">){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">+</span> <span class="s2">&quot;_tile_text&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="mi">500</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">TextIsAnimating</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">TextIsAnimatingIn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;},</span><span class="mi">500</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">hide the text in the Tile</span>
<span class="cm">@memberof AnimatedImageTextTile</span>
<span class="cm">@method hide_text </span>
<span class="cm">**/</span>
<span class="nx">AnimatedImageTextTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hide_text</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">TextIsAnimating</span><span class="p">){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">+</span> <span class="s2">&quot;_tile_text&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">0</span><span class="p">},</span><span class="mi">500</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">TextIsAnimating</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">TextIsAnimatingOut</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;},</span><span class="mi">500</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">draws the tile&#39;s text using d3.js</span>
<span class="cm">@memberof AnimatedImageTextTile</span>
<span class="cm">@method draw_text </span>
<span class="cm">**/</span>
<span class="nx">AnimatedImageTextTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">draw_text</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>get the correct height and width to draw</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">outerWidth</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;small&quot;</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up a top level svg selection if the tile needs to be initialized</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">init_state</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="o">=</span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">+</span> <span class="s2">&quot;_tile_svg&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>(re)draw the text</p></div></div><div class="code"><div class="wrapper">  <span class="kd">var</span> <span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">height</span><span class="p">,</span><span class="nx">width</span><span class="p">,</span><span class="nx">html</span><span class="p">;</span>
  <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">y</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
  <span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">40</span><span class="p">;</span>
  <span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;wide&quot;</span><span class="p">){</span>
    <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;h2&gt;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s1">&#39;&lt;/h2&gt;&#39;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;medium&quot;</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;small&quot;</span><span class="p">){</span>
    <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;h3&gt;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s1">&#39;&lt;/h3&gt;&#39;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;.draw_layer&#39;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.tile_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;.draw_layer&#39;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.tile_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">title</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;foreignObject&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;tile_text&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="nx">x</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="nx">height</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="nx">width</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;pointer-events&quot;</span><span class="p">,</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;xhtml:div&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">+</span> <span class="s2">&quot;_tile_text&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span><span class="s2">&quot;#ffffff&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>

<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">FullAnimatedImageTextTile constructor</span>
<span class="cm">@param {object} [options={}] options object to set properties</span>
<span class="cm">@classdesc A Tile that extends AnimatedImageTile to add text that animates on mouseover</span>
<span class="cm">@class FullAnimatedImageTextTile</span>
<span class="cm">@constructor</span>
<span class="cm">@extends ImageTile</span>
<span class="cm">@param {string}  [options.image] the url to use as the image,defaults to &quot;../Bellhop/img.two_circles.png&quot;</span>
<span class="cm">@param {string}  [options.div_target] the div id into which to inject html, defaults to &quot;body&quot;</span>
<span class="cm">@param {string}  [options.div_id] the div id for generated html, defaults to &quot;Tile&quot; plus a random number</span>
<span class="cm">@param {string}  [options.text] the text to display on the panel, defaults to &quot;Title&quot;</span>
<span class="cm">@param {string}  [options.style] inline style specification, defaults to &quot;#f0f0f0&quot;</span>
<span class="cm">@param {string}  [options.color] the background color of the tile, defuaults to </span>
<span class="cm">@param {string}  [options.tile_type] tile type, can be &quot;small&quot;, &quot;medium&quot;, or &quot;wide&quot;, defaults to &quot;medium&quot;</span>

<span class="cm">**/</span>
<span class="kd">function</span> <span class="nx">FullAnimatedImageTextTile</span><span class="p">(</span><span class="nx">options</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">title</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">title</span> <span class="o">:</span> <span class="s2">&quot;Title&quot;</span><span class="p">;</span>
  <span class="nx">ImageTile</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">resize</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nx">self</span><span class="p">.</span><span class="nx">draw</span><span class="p">();}</span> <span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">start_animation</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">TextIsAnimatingIn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">TextIsAnimatingOut</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">FullAnimatedImageTextTile</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AnimatedImageTile</span><span class="p">({</span><span class="nx">display</span><span class="o">:</span><span class="kc">false</span><span class="p">});</span>
<span class="nx">FullAnimatedImageTextTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">FullAnimatedImageTextTile</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">top level draw wrapper around draw\_bg and draw\_image and draw\_text</span>
<span class="cm">@memberof FullAnimatedImageTextTile</span>
<span class="cm">@method draw </span>
<span class="cm">**/</span>
<span class="nx">FullAnimatedImageTextTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw_bg</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw_image</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">draw_text</span><span class="p">();</span>
  <span class="c1">//add callbacks to expose the display of the animated text</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">link_selection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mouseover&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">show_text</span><span class="p">();});</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">link_selection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mouseout&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">hide_text</span><span class="p">();});</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">show the text in the Tile</span>
<span class="cm">@memberof FullAnimatedImageTextTile</span>
<span class="cm">@method show_text</span>
<span class="cm">**/</span>
<span class="nx">FullAnimatedImageTextTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">show_text</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">TextIsAnimatingIn</span><span class="p">){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">+</span> <span class="s2">&quot;_tile_text&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="mi">500</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">TextIsAnimating</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">TextIsAnimatingIn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;},</span><span class="mi">500</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">hide the text in the Tile</span>
<span class="cm">@memberof FullAnimatedImageTextTile</span>
<span class="cm">@method hide_text </span>
<span class="cm">**/</span>
<span class="nx">FullAnimatedImageTextTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hide_text</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">TextIsAnimatingOut</span><span class="p">){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">+</span> <span class="s2">&quot;_tile_text&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">0</span><span class="p">},</span><span class="mi">500</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">TextIsAnimating</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">TextIsAnimatingOut</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;},</span><span class="mi">500</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">draws the tile&#39;s text using d3.js</span>
<span class="cm">@memberof FullAnimatedImageTextTile</span>
<span class="cm">@method draw_text </span>
<span class="cm">**/</span>
<span class="nx">FullAnimatedImageTextTile</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">draw_text</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>get the correct height and width to draw</p></div></div><div class="code"><div class="wrapper">  <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">outerWidth</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;small&quot;</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up a top level svg selection if the tile needs to be initialized</p></div></div><div class="code"><div class="wrapper">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">init_state</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="o">=</span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_id</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">+</span> <span class="s2">&quot;_tile_svg&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>(re)draw the text</p></div></div><div class="code"><div class="wrapper">  <span class="kd">var</span> <span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">height</span><span class="p">,</span><span class="nx">width</span><span class="p">,</span><span class="nx">html</span><span class="p">;</span>
  <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">y</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
  <span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">40</span><span class="p">;</span>
  <span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;wide&quot;</span><span class="p">){</span>
    <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;h2&gt;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s1">&#39;&lt;/h2&gt;&#39;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;medium&quot;</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">tile_type</span> <span class="o">==</span> <span class="s2">&quot;small&quot;</span><span class="p">){</span>
    <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;h3&gt;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s1">&#39;&lt;/h3&gt;&#39;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;.draw_layer&#39;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.tile_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;.draw_layer&#39;</span><span class="p">).</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.tile_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="k">this</span><span class="p">.</span><span class="nx">title</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;foreignObject&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;tile_text&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="nx">x</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="nx">y</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="nx">height</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="nx">width</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;pointer-events&quot;</span><span class="p">,</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;xhtml:body&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">+</span> <span class="s2">&quot;_tile_text&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="nx">height</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="nx">width</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span><span class="s2">&quot;#ffffff&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>

<span class="p">};</span></div></div></div></div></body></html>