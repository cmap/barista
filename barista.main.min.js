/*! barista 2013-07-09 */
function RGBColor(a){this.ok=!1,"#"==a.charAt(0)&&(a=a.substr(1,6)),a=a.replace(/ /g,""),a=a.toLowerCase();var b={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var c in b)a==c&&(a=b[c]);for(var d=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}],e=0;e<d.length;e++){var f=d[e].re,g=d[e].process,h=f.exec(a);h&&(channels=g(h),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var a=this.r.toString(16),b=this.g.toString(16),c=this.b.toString(16);return 1==a.length&&(a="0"+a),1==b.length&&(b="0"+b),1==c.length&&(c="0"+c),"#"+a+b+c},this.getHelpXML=function(){for(var a=new Array,c=0;c<d.length;c++)for(var e=d[c].example,f=0;f<e.length;f++)a[a.length]=e[f];for(var g in b)a[a.length]=g;var h=document.createElement("ul");h.setAttribute("id","rgbcolor-examples");for(var c=0;c<a.length;c++)try{var i=document.createElement("li"),j=new RGBColor(a[c]),k=document.createElement("div");k.style.cssText="margin: 3px; border: 1px solid black; background:"+j.toHex()+"; "+"color:"+j.toHex(),k.appendChild(document.createTextNode("test"));var l=document.createTextNode(" "+a[c]+" -> "+j.toRGB()+" -> "+j.toHex());i.appendChild(k),i.appendChild(l),h.appendChild(i)}catch(m){}return h}}function Tile(a){a=void 0!==a?a:{},this.div_target=void 0!==a.div_target?a.div_target:"body",this.div_id=void 0!==a.div_id?a.div_id:"Tile"+Math.floor(1e9*Math.random()),this.link=void 0!==a.link?a.link:"",this.style=void 0!==a.style?a.style:"",this.color=void 0!==a.color?a.color:"#bdbdbd",this.tile_type=void 0!==a.tile_type?a.tile_type:"medium",this.display=void 0!==a.display?a.display:!0,this.init_state=!1,this.display&&this.init()}function ImageTile(a){this.image=void 0!==a.image?a.image:"../Bellhop/img/CMap_Logo_gray.png",Tile.apply(this,arguments);var b=this;$(window).resize(function(){b.draw()}),this.draw()}function AnimatedImageTile(a){this.image=void 0!==a.image?a.image:"../Bellhop/img/CMap_Logo_gray.png",Tile.apply(this,arguments);var b=this;$(window).resize(function(){b.draw()}),this.draw(),this.start_animation()}function ImageTextTile(a){this.title=void 0!==a.title?a.title:"Title",ImageTile.apply(this,arguments);var b=this;$(window).resize(function(){b.draw()}),this.draw()}function AnimatedImageTextTile(a){this.title=void 0!==a.title?a.title:"Title",ImageTile.apply(this,arguments);var b=this;$(window).resize(function(){b.draw()}),this.draw(),this.TextIsAnimatingIn=!1,this.TextIsAnimatingOut=!1}function FullAnimatedImageTextTile(a){this.title=void 0!==a.title?a.title:"Title",ImageTile.apply(this,arguments);var b=this;$(window).resize(function(){b.draw()}),this.draw(),this.start_animation(),this.TextIsAnimatingIn=!1,this.TextIsAnimatingOut=!1}!function(a,b,c,d){"use strict";function e(a){return String.fromCharCode(a.charCodeAt(0)-32)+a.slice(1)}function f(a,b,c){var d=b-(a+"").length;d=0>d?0:d;for(var e="",f=0;d>f;f++)e+=c;return e+a}var g=a,h="	\n\f\r   ᠎             　\u2028\u2029";if(!String.prototype.trim||h.trim()){h="["+h+"]";var i=RegExp("^"+h+h+"*"),j=RegExp(h+h+"*$");String.prototype.trim=function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return(this+"").replace(i,"").replace(j,"")}}var k=a.Backgrid={VERSION:"0.2.0",Extension:{},requireOptions:function(a,b){for(var d=0;b.length>d;d++){var e=b[d];if(c.isUndefined(a[e]))throw new TypeError("'"+e+"' is required")}},resolveNameToClass:function(a,b){if(c.isString(a)){var d=c.map(a.split("-"),function(a){return e(a)}).join("")+b,f=k[d]||k.Extension[d];if(c.isUndefined(f))throw new ReferenceError("Class '"+d+"' not found");return f}return a}};c.extend(k,d.Events);var l=k.Command=function(a){c.extend(this,{altKey:!!a.altKey,"char":a.char,charCode:a.charCode,ctrlKey:!!a.ctrlKey,key:a.key,keyCode:a.keyCode,locale:a.locale,location:a.location,metaKey:!!a.metaKey,repeat:!!a.repeat,shiftKey:!!a.shiftKey,which:a.which})};c.extend(l.prototype,{moveUp:function(){return 38==this.keyCode},moveDown:function(){return 40===this.keyCode},moveLeft:function(){return this.shiftKey&&9===this.keyCode},moveRight:function(){return!this.shiftKey&&9===this.keyCode},save:function(){return 13===this.keyCode},cancel:function(){return 27===this.keyCode},passThru:function(){return!(this.moveUp()||this.moveDown()||this.moveLeft()||this.moveRight()||this.save()||this.cancel())}});var m=k.CellFormatter=function(){};c.extend(m.prototype,{fromRaw:function(a){return a},toRaw:function(a){return a}});var n=k.NumberFormatter=function(a){if(a=a?c.clone(a):{},c.extend(this,this.defaults,a),0>this.decimals||this.decimals>20)throw new RangeError("decimals must be between 0 and 20")};n.prototype=new m,c.extend(n.prototype,{defaults:{decimals:2,decimalSeparator:".",orderSeparator:","},HUMANIZED_NUM_RE:/(\d)(?=(?:\d{3})+$)/g,fromRaw:function(a){if(c.isNull(a)||c.isUndefined(a))return"";a=a.toFixed(~~this.decimals);var b=a.split("."),d=b[0],e=b[1]?(this.decimalSeparator||".")+b[1]:"";return d.replace(this.HUMANIZED_NUM_RE,"$1"+this.orderSeparator)+e},toRaw:function(a){for(var b="",d=a.trim().split(this.orderSeparator),e=0;d.length>e;e++)b+=d[e];var f=b.split(this.decimalSeparator);b="";for(var e=0;f.length>e;e++)b=b+f[e]+".";"."===b[b.length-1]&&(b=b.slice(0,b.length-1));var g=1*(1*b).toFixed(~~this.decimals);return c.isNumber(g)&&!c.isNaN(g)?g:void 0}});var o=k.DatetimeFormatter=function(a){if(a=a?c.clone(a):{},c.extend(this,this.defaults,a),!this.includeDate&&!this.includeTime)throw Error("Either includeDate or includeTime must be true")};o.prototype=new m,c.extend(o.prototype,{defaults:{includeDate:!0,includeTime:!0,includeMilli:!1},DATE_RE:/^([+\-]?\d{4})-(\d{2})-(\d{2})$/,TIME_RE:/^(\d{2}):(\d{2}):(\d{2})(\.(\d{3}))?$/,ISO_SPLITTER_RE:/T|Z| +/,_convert:function(a,b){a=a.trim();var d=a.split(this.ISO_SPLITTER_RE)||[],e=this.DATE_RE.test(d[0])?d[0]:"",g=e&&d[1]?d[1]:this.TIME_RE.test(d[0])?d[0]:"",h=this.DATE_RE.exec(e)||[],i=this.TIME_RE.exec(g)||[];if(b){if(this.includeDate&&c.isUndefined(h[0]))return;if(this.includeTime&&c.isUndefined(i[0]))return;if(!this.includeDate&&e)return;if(!this.includeTime&&g)return}var j=new Date(Date.UTC(1*h[1]||0,1*h[2]-1||0,1*h[3]||0,1*i[1]||null,1*i[2]||null,1*i[3]||null,1*i[5]||null)),k="";return this.includeDate&&(k=f(j.getUTCFullYear(),4,0)+"-"+f(j.getUTCMonth()+1,2,0)+"-"+f(j.getUTCDate(),2,0)),this.includeTime&&(k=k+(this.includeDate?"T":"")+f(j.getUTCHours(),2,0)+":"+f(j.getUTCMinutes(),2,0)+":"+f(j.getUTCSeconds(),2,0),this.includeMilli&&(k=k+"."+f(j.getUTCMilliseconds(),3,0))),this.includeDate&&this.includeTime&&(k+="Z"),k},fromRaw:function(a){return c.isNull(a)||c.isUndefined(a)?"":this._convert(a)},toRaw:function(a){return this._convert(a,!0)}});var p=k.StringFormatter=function(){};p.prototype=new m,c.extend(p.prototype,{fromRaw:function(a){return c.isUndefined(a)||c.isNull(a)?"":a+""}});var q=k.EmailFormatter=function(){};q.prototype=new m,c.extend(q.prototype,{toRaw:function(a){var b=a.trim().split("@");return 2===b.length&&c.all(b)?a:void 0}});var r=k.CellEditor=d.View.extend({initialize:function(a){k.requireOptions(a,["formatter","column","model"]),this.formatter=a.formatter,this.column=a.column,this.column instanceof z||(this.column=new z(this.column)),this.listenTo(this.model,"backgrid:editing",this.postRender)},postRender:function(a,b){return(null==b||b.get("name")==this.column.get("name"))&&this.$el.focus(),this}}),s=k.InputCellEditor=r.extend({tagName:"input",attributes:{type:"text"},events:{blur:"saveOrCancel",keydown:"saveOrCancel"},initialize:function(a){r.prototype.initialize.apply(this,arguments),a.placeholder&&this.$el.attr("placeholder",a.placeholder)},render:function(){return this.$el.val(this.formatter.fromRaw(this.model.get(this.column.get("name")))),this},saveOrCancel:function(a){var b=this.formatter,d=this.model,e=this.column,f=new l(a),h="blur"===a.type;if(f.moveUp()||f.moveDown()||f.moveLeft()||f.moveRight()||f.save()||h){a.preventDefault(),a.stopPropagation();var i=this.$el.val(),j=b.toRaw(i);if(c.isUndefined(j)){if(d.trigger("backgrid:error",d,e,i),h)var k=this,m=g.setTimeout(function(){k.$el.focus(),g.clearTimeout(m)},1)}else d.set(e.get("name"),j),d.trigger("backgrid:edited",d,e,f)}else f.cancel()&&(a.stopPropagation(),d.trigger("backgrid:edited",d,e,f))},postRender:function(a,b){if(null==b||b.get("name")==this.column.get("name"))if("right"===this.$el.css("text-align")){var c=this.$el.val();this.$el.focus().val(null).val(c)}else this.$el.focus();return this}}),t=k.Cell=d.View.extend({tagName:"td",formatter:new m,editor:s,events:{click:"enterEditMode"},initialize:function(a){k.requireOptions(a,["model","column"]),this.column=a.column,this.column instanceof z||(this.column=new z(this.column)),this.formatter=k.resolveNameToClass(this.formatter,"Formatter"),this.editor=k.resolveNameToClass(this.editor,"CellEditor"),this.listenTo(this.model,"change:"+this.column.get("name"),function(){this.$el.hasClass("editor")||this.render()})},render:function(){return this.$el.empty(),this.$el.text(this.formatter.fromRaw(this.model.get(this.column.get("name")))),this.delegateEvents(),this},enterEditMode:function(){var a=this.model,b=this.column;b.get("editable")&&(this.currentEditor=new this.editor({column:this.column,model:this.model,formatter:this.formatter}),a.trigger("backgrid:edit",a,b,this,this.currentEditor),this.listenTo(a,"backgrid:error",this.renderError),this.undelegateEvents(),this.$el.empty(),this.$el.append(this.currentEditor.$el),this.currentEditor.render(),this.$el.addClass("editor"),a.trigger("backgrid:editing",a,b,this,this.currentEditor))},renderError:function(a,b){(null==b||b.get("name")==this.column.get("name"))&&this.$el.addClass("error")},exitEditMode:function(){this.$el.removeClass("error"),this.currentEditor.remove(),this.stopListening(this.currentEditor),delete this.currentEditor,this.$el.removeClass("editor"),this.render()},remove:function(){return this.currentEditor&&(this.currentEditor.remove.apply(this,arguments),delete this.currentEditor),d.View.prototype.remove.apply(this,arguments)}}),u=k.StringCell=t.extend({className:"string-cell",formatter:new p});k.UriCell=t.extend({className:"uri-cell",render:function(){this.$el.empty();var a=this.formatter.fromRaw(this.model.get(this.column.get("name")));return this.$el.append(b("<a>",{tabIndex:-1,href:a,title:a,target:"_blank"}).text(a)),this.delegateEvents(),this}}),k.EmailCell=u.extend({className:"email-cell",formatter:new q,render:function(){this.$el.empty();var a=this.formatter.fromRaw(this.model.get(this.column.get("name")));return this.$el.append(b("<a>",{tabIndex:-1,href:"mailto:"+a,title:a}).text(a)),this.delegateEvents(),this}});var v=k.NumberCell=t.extend({className:"number-cell",decimals:n.prototype.defaults.decimals,decimalSeparator:n.prototype.defaults.decimalSeparator,orderSeparator:n.prototype.defaults.orderSeparator,formatter:n,initialize:function(){t.prototype.initialize.apply(this,arguments),this.formatter=new this.formatter({decimals:this.decimals,decimalSeparator:this.decimalSeparator,orderSeparator:this.orderSeparator})}});k.IntegerCell=v.extend({className:"integer-cell",decimals:0});var w=k.DatetimeCell=t.extend({className:"datetime-cell",includeDate:o.prototype.defaults.includeDate,includeTime:o.prototype.defaults.includeTime,includeMilli:o.prototype.defaults.includeMilli,formatter:o,initialize:function(){t.prototype.initialize.apply(this,arguments),this.formatter=new this.formatter({includeDate:this.includeDate,includeTime:this.includeTime,includeMilli:this.includeMilli});var a=this.includeDate?"YYYY-MM-DD":"";a+=this.includeDate&&this.includeTime?"T":"",a+=this.includeTime?"HH:mm:ss":"",a+=this.includeTime&&this.includeMilli?".SSS":"",this.editor=this.editor.extend({attributes:c.extend({},this.editor.prototype.attributes,this.editor.attributes,{placeholder:a})})}});k.DateCell=w.extend({className:"date-cell",includeTime:!1}),k.TimeCell=w.extend({className:"time-cell",includeDate:!1});var x=k.BooleanCellEditor=r.extend({tagName:"input",attributes:{tabIndex:-1,type:"checkbox"},events:{blur:"enterOrExitEditMode",change:"saveOrCancel",keydown:"saveOrCancel"},render:function(){var a=this.formatter.fromRaw(this.model.get(this.column.get("name")));return this.$el.prop("checked",a),this},enterOrExitEditMode:function(a){var b=this.$el.prop("checked"),c=this,d=this.model,e=g.setTimeout(function(){c.$el.prop("checked")!=b?c.$el.focus():d.trigger("backgrid:edited",d,c.column,new l(a)),g.clearTimeout(e)},50)},saveOrCancel:function(a){var b=this.model,c=this.column,d=this.formatter,e=new l(a);if(e.passThru()&&"change"!=a.type)return!0;if(e.cancel()&&(a.stopPropagation(),b.trigger("backgrid:edited",b,c,e)),e.save()||e.moveLeft()||e.moveRight()||e.moveUp()||e.moveDown()){a.preventDefault(),a.stopPropagation();var f=d.toRaw(this.$el.prop("checked"));b.set(c.get("name"),f),b.trigger("backgrid:edited",b,c,e)}else if("change"==a.type){var f=d.toRaw(this.$el.prop("checked"));b.set(c.get("name"),f)}}});k.BooleanCell=t.extend({className:"boolean-cell",editor:x,events:{click:"enterEditMode"},render:function(){return this.$el.empty(),this.$el.append(b("<input>",{tabIndex:-1,type:"checkbox",checked:this.formatter.fromRaw(this.model.get(this.column.get("name")))})),this.delegateEvents(),this}});var y=k.SelectCellEditor=r.extend({tagName:"select",events:{change:"save",blur:"close",keydown:"close"},template:c.template('<option value="<%- value %>" <%= selected ? \'selected="selected"\' : "" %>><%- text %></option>'),setOptionValues:function(a){this.optionValues=a},_renderOptions:function(a,b){for(var c="",d=0;a.length>d;d++)c+=this.template({text:a[d][0],value:a[d][1],selected:b==a[d][1]});return c},render:function(){this.$el.empty();var a=c.result(this,"optionValues"),d=this.model.get(this.column.get("name"));if(!c.isArray(a))throw TypeError("optionValues must be an array");for(var e=null,f=null,e=null,g=null,h=null,i=0;a.length>i;i++){var e=a[i];if(c.isArray(e))f=e[0],e=e[1],this.$el.append(this.template({text:f,value:e,selected:e==d}));else{if(!c.isObject(e))throw TypeError("optionValues elements must be a name-value pair or an object hash of { name: 'optgroup label', value: [option name-value pairs] }");g=e.name,h=b("<optgroup></optgroup>",{label:g}),h.append(this._renderOptions(e.values,d)),this.$el.append(h)}}return this.delegateEvents(),this},save:function(a){var b=this.model,c=this.column;b.set(c.get("name"),this.formatter.toRaw(this.$el.val())),b.trigger("backgrid:edited",b,c,new l(a))},close:function(a){var b=this.model,c=this.column,d=new l(a);d.cancel()?(a.stopPropagation(),b.trigger("backgrid:edited",b,c,new l(a))):(d.save()||d.moveLeft()||d.moveRight()||d.moveUp()||d.moveDown()||"blur"==a.type)&&(a.preventDefault(),a.stopPropagation(),b.trigger("backgrid:edited",b,c,new l(a)))}});k.SelectCell=t.extend({className:"select-cell",editor:y,optionValues:void 0,initialize:function(){t.prototype.initialize.apply(this,arguments),k.requireOptions(this,["optionValues"]),this.optionValues=c.result(this,"optionValues"),this.listenTo(this.model,"backgrid:edit",function(a,b,c,d){b.get("name")==this.column.get("name")&&d.setOptionValues(this.optionValues)})},render:function(){this.$el.empty();var a=this.optionValues,b=this.formatter.fromRaw(this.model.get(this.column.get("name")));try{if(!c.isArray(a)||c.isEmpty(a))throw new TypeError;for(var d=0;a.length>d;d++){var e=a[d];if(c.isArray(e)){var f=e[0],e=e[1];if(e==b){this.$el.append(f);break}}else{if(!c.isObject(e))throw new TypeError;for(var g=e.values,h=0;g.length>h;h++){var i=g[h];if(i[1]==b){this.$el.append(i[0]);break}}}}}catch(j){if(j instanceof TypeError)throw TypeError("'optionValues' must be of type {Array.<Array>|Array.<{name: string, values: Array.<Array>}>}");throw j}return this.delegateEvents(),this}});var z=k.Column=d.Model.extend({defaults:{name:void 0,label:void 0,sortable:!0,editable:!0,renderable:!0,formatter:void 0,cell:void 0,headerCell:void 0},initialize:function(a){k.requireOptions(a,["cell","name"]),this.has("label")||this.set({label:this.get("name")},{silent:!0});var b=k.resolveNameToClass(this.get("headerCell"),"HeaderCell"),c=k.resolveNameToClass(this.get("cell"),"Cell");this.set({cell:c,headerCell:b},{silent:!0})}}),A=k.Columns=d.Collection.extend({model:z}),B=k.Row=d.View.extend({tagName:"tr",requiredOptions:["columns","model"],initialize:function(a){k.requireOptions(a,this.requiredOptions);var b=this.columns=a.columns;b instanceof d.Collection||(b=this.columns=new A(b));for(var c=this.cells=[],e=0;b.length>e;e++)c.push(this.makeCell(b.at(e),a));this.listenTo(b,"change:renderable",function(a,b){for(var d=0;c.length>d;d++){var e=c[d];e.column.get("name")==a.get("name")&&(b?e.$el.show():e.$el.hide())}}),this.listenTo(b,"add",function(b,d){var e=d.indexOf(b),f=this.makeCell(b,a);c.splice(e,0,f),f.column.get("renderable")||f.$el.hide();var g=this.$el;0===e?g.prepend(f.render().$el):e===d.length-1?g.append(f.render().$el):g.children().eq(e).before(f.render().$el)}),this.listenTo(b,"remove",function(a,b,d){c[d.index].remove(),c.splice(d.index,1)})},makeCell:function(a){return new(a.get("cell"))({column:a,model:this.model})},render:function(){this.$el.empty();for(var a=document.createDocumentFragment(),b=0;this.cells.length>b;b++){var c=this.cells[b];a.appendChild(c.render().el),c.column.get("renderable")||c.$el.hide()}return this.el.appendChild(a),this.delegateEvents(),this},remove:function(){for(var a=0;this.cells.length>a;a++){var b=this.cells[a];b.remove.apply(b,arguments)}return d.View.prototype.remove.apply(this,arguments)}}),C=k.EmptyRow=d.View.extend({tagName:"tr",emptyText:null,initialize:function(a){k.requireOptions(a,["emptyText","columns"]),this.emptyText=a.emptyText,this.columns=a.columns},render:function(){this.$el.empty();var a=document.createElement("td");return a.setAttribute("colspan",this.columns.length),a.textContent=this.emptyText,this.el.setAttribute("class","empty"),this.el.appendChild(a),this}}),D=k.HeaderCell=d.View.extend({tagName:"th",events:{"click a":"onClick"},_direction:null,initialize:function(a){k.requireOptions(a,["column","collection"]),this.column=a.column,this.column instanceof z||(this.column=new z(this.column)),this.listenTo(d,"backgrid:sort",this._resetCellDirection)},direction:function(a){return arguments.length&&(this._direction&&this.$el.removeClass(this._direction),a&&this.$el.addClass(a),this._direction=a),this._direction},_resetCellDirection:function(a,b,c,d){d==this.collection&&(a!==this.column.get("name")?this.direction(null):this.direction(b))},onClick:function(a){a.preventDefault();var b=this.column.get("name");this.column.get("sortable")&&("ascending"===this.direction()?this.sort(b,"descending",function(a,c){var d=a.get(b),e=c.get(b);return d===e?0:d>e?-1:1}):"descending"===this.direction()?this.sort(b,null):this.sort(b,"ascending",function(a,c){var d=a.get(b),e=c.get(b);return d===e?0:e>d?-1:1}))},sort:function(a,b,c){c=c||this._cidComparator;var e=this.collection;if(d.PageableCollection&&e instanceof d.PageableCollection){var f;f="ascending"===b?-1:"descending"===b?1:null,e.setSorting(f?a:null,f),"client"==e.mode?(e.fullCollection.comparator||(e.fullCollection.comparator=c),e.fullCollection.sort()):e.fetch()}else e.comparator=c,e.sort();d.trigger("backgrid:sort",a,b,c,this.collection)},_cidComparator:function(a,b){var d=a.cid,e=b.cid;if(!c.isUndefined(d)&&!c.isUndefined(e)){if(d=1*d.slice(1),e=1*e.slice(1),e>d)return-1;if(d>e)return 1}return 0},render:function(){this.$el.empty();var a=b("<a>").text(this.column.get("label")).append("<b class='sort-caret'></b>");return this.$el.append(a),this.delegateEvents(),this}});k.HeaderRow=k.Row.extend({requiredOptions:["columns","collection"],initialize:function(){k.Row.prototype.initialize.apply(this,arguments)},makeCell:function(a,b){var c=a.get("headerCell")||b.headerCell||D;return c=new c({column:a,collection:this.collection})}});var E=k.Header=d.View.extend({tagName:"thead",initialize:function(a){k.requireOptions(a,["columns","collection"]),this.columns=a.columns,this.columns instanceof d.Collection||(this.columns=new A(this.columns)),this.row=new k.HeaderRow({columns:this.columns,collection:this.collection})},render:function(){return this.$el.append(this.row.render().$el),this.delegateEvents(),this},remove:function(){return this.row.remove.apply(this.row,arguments),d.View.prototype.remove.apply(this,arguments)}}),F=k.Body=d.View.extend({tagName:"tbody",initialize:function(a){k.requireOptions(a,["columns","collection"]),this.columns=a.columns,this.columns instanceof d.Collection||(this.columns=new A(this.columns)),this.row=a.row||B,this.rows=this.collection.map(function(a){var b=new this.row({columns:this.columns,model:a});return b},this),this.emptyText=a.emptyText,this._unshiftEmptyRowMayBe();var b=this.collection;this.listenTo(b,"add",this.insertRow),this.listenTo(b,"remove",this.removeRow),this.listenTo(b,"sort",this.refresh),this.listenTo(b,"reset",this.refresh),this.listenTo(b,"backgrid:edited",this.moveToNextCell)},_unshiftEmptyRowMayBe:function(){0===this.rows.length&&null!=this.emptyText&&this.rows.unshift(new C({emptyText:this.emptyText,columns:this.columns}))},insertRow:function(a,b,e){if(this.rows[0]instanceof C&&this.rows.pop().remove(),!(b instanceof d.Collection||e))return this.collection.add(a,e=b),void 0;e=c.extend({render:!0},e||{});var f=new this.row({columns:this.columns,model:a}),g=b.indexOf(a);this.rows.splice(g,0,f);var h=this.$el,i=h.children(),j=f.render().$el;e.render&&(g>=i.length?h.append(j):i.eq(g).before(j))},removeRow:function(a,b,d){return d?((c.isUndefined(d.render)||d.render)&&this.rows[d.index].remove(),this.rows.splice(d.index,1),this._unshiftEmptyRowMayBe(),void 0):(this.collection.remove(a,d=b),this._unshiftEmptyRowMayBe(),void 0)},refresh:function(){for(var a=0;this.rows.length>a;a++)this.rows[a].remove();return this.rows=this.collection.map(function(a){var b=new this.row({columns:this.columns,model:a});return b},this),this._unshiftEmptyRowMayBe(),this.render(),d.trigger("backgrid:refresh",this),this},render:function(){this.$el.empty();for(var a=document.createDocumentFragment(),b=0;this.rows.length>b;b++){var c=this.rows[b];a.appendChild(c.render().el)}return this.el.appendChild(a),this.delegateEvents(),this},remove:function(){for(var a=0;this.rows.length>a;a++){var b=this.rows[a];b.remove.apply(b,arguments)}return d.View.prototype.remove.apply(this,arguments)},moveToNextCell:function(a,b,c){var d=this.collection.indexOf(a),e=this.columns.indexOf(b);if(c.moveUp()||c.moveDown()||c.moveLeft()||c.moveRight()||c.save()){var f=this.columns.length,g=f*this.collection.length;if(c.moveUp()||c.moveDown()){var h=this.rows[d+(c.moveUp()?-1:1)];h&&h.cells[e].enterEditMode()}else if(c.moveLeft()||c.moveRight())for(var i=c.moveRight(),j=d*f+e+(i?1:-1);j>=0&&g>j;i?j++:j--){var k=~~(j/f),l=j-k*f,m=this.rows[k].cells[l];if(m.column.get("renderable")&&m.column.get("editable")){m.enterEditMode();break}}}this.rows[d].cells[e].exitEditMode()}});k.Footer=d.View.extend({tagName:"tfoot",initialize:function(a){k.requireOptions(a,["columns","collection"]),this.parent=a.parent,this.columns=a.columns,this.columns instanceof d.Collection||(this.columns=new k.Columns(this.columns))}}),k.Grid=d.View.extend({tagName:"table",className:"backgrid",header:E,body:F,footer:null,initialize:function(a){k.requireOptions(a,["columns","collection"]),a.columns instanceof d.Collection||(a.columns=new A(a.columns)),this.columns=a.columns;var b=c.omit(a,["el","id","attributes","className","tagName","events"]);this.header=a.header||this.header,this.header=new this.header(b),this.body=a.body||this.body,this.body=new this.body(b),this.footer=a.footer||this.footer,this.footer&&(this.footer=new this.footer(b)),this.listenTo(this.columns,"reset",function(){this.header=new(this.header.remove().constructor)(b),this.body=new(this.body.remove().constructor)(b),this.footer&&(this.footer=new(this.footer.remove().constructor)(b)),this.render()})},insertRow:function(a,b,c){return this.body.insertRow(a,b,c)},removeRow:function(a,b,c){return this.body.removeRow(a,b,c)},insertColumn:function(a,b){return b=b||{render:!0},this.columns.add(a,b),this},removeColumn:function(a,b){return this.columns.remove(a,b),this},render:function(){return this.$el.empty(),this.$el.append(this.header.render().$el),this.footer&&this.$el.append(this.footer.render().$el),this.$el.append(this.body.render().$el),this.delegateEvents(),this.trigger("backgrid:rendered",this),this},remove:function(){return this.header.remove.apply(this.header,arguments),this.body.remove.apply(this.body,arguments),this.footer&&this.footer.remove.apply(this.footer,arguments),d.View.prototype.remove.apply(this,arguments)}})}(this,jQuery,_,Backbone),d3.parcoords=function(a){function b(a,b){b.strokeStyle=d3.functor(k.color)(a),b.beginPath(),k.dimensions.map(function(c,d){0==d?b.moveTo(e(c),s[c](a[c])):b.lineTo(e(c),s[c](a[c]))}),b.stroke()}function c(a,b){b.clearRect(-1,-1,o()+2,p()+2),b.beginPath(),a.forEach(function(a){k.dimensions.map(function(c,d){0==d?b.moveTo(e(c),s[c](a[c])):b.lineTo(e(c),s[c](a[c]))})}),b.stroke()}function d(a){return!s[a].brush.empty()}function e(a){var b=t[a];return null==b?r(a):b}function f(){var a=k.dimensions.filter(d),b=a.map(function(a){return s[a].brush.extent()}),c={number:function(a,c,d){return b[d][0]<=a[c]&&a[c]<=b[d][1]},string:function(a,c,d){return b[d][0]<=s[c](a[c])&&s[c](a[c])<=b[d][1]}};return k.data.filter(function(b){return a.every(function(a,d){return c[k.types[a]](b,a,d)})})}function g(a){return b(a,v.foreground)}function h(a){return b(a,v.highlight)}function i(a,b,c){d3.keys(b).forEach(function(d){a[d]=function(e){if(!arguments.length)return b[d];var f=b[d];return b[d]=e,x[d].call(m,{value:e,previous:f}),c[d].call(m,{value:e,previous:f}),a}})}function j(a,b){for(key in b)a[key]=b[key];return a}var k={data:[],dimensions:[],types:{},brushed:!1,mode:"default",rate:20,width:600,height:300,margin:{top:24,right:0,bottom:12,left:0},color:"#069",composite:"source-over",alpha:.7};j(k,a);var l,m=function(a){return a=m.selection=d3.select(a),k.width=a[0][0].clientWidth,k.height=a[0][0].clientHeight,["shadows","marks","foreground","highlight"].forEach(function(b){w[b]=a.append("canvas").attr("class",b)[0][0],v[b]=w[b].getContext("2d")}),m.svg=a.append("svg").attr("width",k.width).attr("height",k.height).append("svg:g").attr("transform","translate("+k.margin.left+","+k.margin.top+")"),m},n=d3.dispatch.apply(this,["render","resize","highlight","brush"].concat(d3.keys(k))),o=function(){return k.width-k.margin.right-k.margin.left},p=function(){return k.height-k.margin.top-k.margin.bottom},q={brushable:!1,reorderable:!1,axes:!1,interactive:!1,shadows:!1,debug:!1},r=d3.scale.ordinal(),s={},t={},u=(d3.svg.line(),d3.svg.axis().orient("left").ticks(5)),v={},w={},x=d3.dispatch.apply(this,d3.keys(k)).on("composite",function(a){v.foreground.globalCompositeOperation=a.value}).on("alpha",function(a){v.foreground.globalAlpha=a.value}).on("width",function(){m.resize()}).on("height",function(){m.resize()}).on("margin",function(){m.resize()}).on("rate",function(a){y.rate(a.value)}).on("data",function(){q.shadows&&c(k.data,v.shadows)}).on("dimensions",function(){r.domain(k.dimensions),q.interactive&&m.render().updateAxes()});m.toString=function(){return"Parallel Coordinates: "+k.dimensions.length+" dimensions ("+d3.keys(k.data[0]).length+" total) , "+k.data.length+" rows"},m.state=k,m.flags=q,i(m,k,n),d3.rebind(m,n,"on"),d3.rebind(m,u,"ticks","orient","tickValues","tickSubdivide","tickSize","tickPadding","tickFormat"),m.autoscale=function(){var a={number:function(a){return d3.scale.linear().domain(d3.extent(k.data,function(b){return+b[a]})).range([p()+1,1])},string:function(a){return d3.scale.ordinal().domain(k.data.map(function(b){return b[a]})).rangePoints([p()+1,1])}};return k.dimensions.forEach(function(b){s[b]=a[k.types[b]](b)}),m.dimensions(m.dimensions().filter(function(a){var b=s[a].domain().length;return"string"==k.types[a]&&(b>60||2>b)?!1:!0})),r.rangePoints([0,o()],1),m.selection.selectAll("canvas").style("margin-top",k.margin.top+"px").style("margin-left",k.margin.left+"px").attr("width",o()+2).attr("height",p()+2),v.foreground.strokeStyle=k.color,v.foreground.lineWidth=1.4,v.foreground.globalCompositeOperation=k.composite,v.foreground.globalAlpha=k.alpha,v.highlight.lineWidth=3,v.shadows.strokeStyle="#dadada",this},m.detectDimensions=function(){return m.types(d3.parcoords.detectDimensionTypes(k.data)),m.dimensions(d3.keys(m.types())),this},m.render=function(){return k.dimensions.length||m.detectDimensions(),k.dimensions[0]in s||m.autoscale(),m.render[k.mode](),n.render.call(this),this},m.render.default=function(){m.clear("foreground"),k.brushed?k.brushed.forEach(g):k.data.forEach(g)
};var y=d3.renderQueue(g).rate(50).clear(function(){m.clear("foreground")});return m.render.queue=function(){k.brushed?y(k.brushed):y(k.data)},m.shadows=function(){return q.shadows=!0,k.data.length>0&&c(k.data,v.shadows),this},m.axisDots=function(){var a=m.ctx.marks;return a.globalAlpha=d3.min([1/Math.pow(data.length,.5),1]),k.data.forEach(function(b){k.dimensions.map(function(c){a.fillRect(e(c)-.75,s[c](b[c])-.75,1.5,1.5)})}),this},m.clear=function(a){return v[a].clearRect(0,0,o()+2,p()+2),this},m.createAxes=function(){return l&&m.removeAxes(),l=m.svg.selectAll(".dimension").data(k.dimensions,function(a){return a}).enter().append("svg:g").attr("class","dimension").attr("transform",function(a){return"translate("+r(a)+")"}),l.append("svg:g").attr("class","axis").attr("transform","translate(0,0)").each(function(a){d3.select(this).call(u.scale(s[a]))}).append("svg:text").attr({"text-anchor":"middle",y:0,transform:"translate(0,-12)",x:0,"class":"label"}).text(String),q.axes=!0,this},m.removeAxes=function(){return l.remove(),this},m.updateAxes=function(){var a=m.svg.selectAll(".dimension").data(k.dimensions,function(a){return a});return a.enter().append("svg:g").attr("class","dimension").attr("transform",function(a){return"translate("+e(a)+")"}).style("opacity",0).append("svg:g").attr("class","axis").attr("transform","translate(0,0)").each(function(a){d3.select(this).call(u.scale(s[a]))}).append("svg:text").attr({"text-anchor":"middle",y:0,transform:"translate(0,-12)",x:0,"class":"label"}).text(String),a.exit().remove(),l=m.svg.selectAll(".dimension"),l.transition().duration(1100).attr("transform",function(a){return"translate("+e(a)+")"}).style("opacity",1),q.shadows&&c(k.data,v.shadows),this},m.brushable=function(){return l||m.createAxes(),l.append("svg:g").attr("class","brush").each(function(a){d3.select(this).call(s[a].brush=d3.svg.brush().y(s[a]).on("brush",m.brush))}).selectAll("rect").style("visibility",null).attr("x",-15).attr("width",30),q.brushable=!0,this},m.reorderable=function(){return l||m.createAxes(),l.style("cursor","move").call(d3.behavior.drag().on("dragstart",function(a){t[a]=this.__origin__=r(a)}).on("drag",function(a){t[a]=Math.min(o(),Math.max(0,this.__origin__+=d3.event.dx)),k.dimensions.sort(function(a,b){return e(a)-e(b)}),r.domain(k.dimensions),m.render(),l.attr("transform",function(a){return"translate("+e(a)+")"})}).on("dragend",function(a){delete this.__origin__,delete t[a],d3.select(this).transition().attr("transform","translate("+r(a)+")"),m.render()})),q.reorderable=!0,this},m.interactive=function(){return q.interactive=!0,this},m.brush=function(){k.brushed=f(),n.brush.call(m,k.brushed),m.render()},m.xscale=r,m.yscale=s,m.ctx=v,m.canvas=w,m.g=function(){return l},m.brushReset=function(a){return s[a].brush.clear()(m.g().filter(function(b){return a==b})),this},m.resize=function(){return m.selection.select("svg").attr("width",k.width).attr("height",k.height),m.svg.attr("transform","translate("+k.margin.left+","+k.margin.top+")"),m.autoscale(),l&&m.createAxes().brushable(),n.resize.call(this,{width:k.width,height:k.height,margin:k.margin}),this},m.highlight=function(a){return m.clear("highlight"),d3.select(w.foreground).classed("faded",!0),a.forEach(h),n.highlight.call(this,a),this},m.unhighlight=function(){return m.clear("highlight"),d3.select(w.foreground).classed("faded",!1),this},m},d3.parcoords.version="0.1.7",d3.parcoords.quantitative=function(a){return d3.keys(a[0]).filter(function(b){var c=a[0][b];return parseFloat(c)==c&&null!=c})},d3.parcoords.toType=function(a){return{}.toString.call(a).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},d3.parcoords.toTypeCoerceNumbers=function(a){return parseFloat(a)==a&&null!=a?"number":d3.parcoords.toType(a)},d3.parcoords.detectDimensionTypes=function(a){var b={};return d3.keys(a[0]).forEach(function(c){b[c]=d3.parcoords.toTypeCoerceNumbers(a[0][c])}),b},d3.parcoords.adjacent_pairs=function(a){for(var b=[],c=0;c<a.length-1;c++)b.push([a[c],a[c+1]]);return b},d3.parcoords.intersection=function(a,b,c,d){return{x:((a.x*b.y-a.y*b.x)*(c.x-d.x)-(a.x-b.x)*(c.x*d.y-c.y*d.x))/((a.x-b.x)*(c.y-d.y)-(a.y-b.y)*(c.x-d.x)),y:((a.x*b.y-a.y*b.x)*(c.y-d.y)-(a.y-b.y)*(c.x*d.y-c.y*d.x))/((a.x-b.x)*(c.y-d.y)-(a.y-b.y)*(c.x-d.x))}},d3.renderQueue=function(a){var b=[],c=10,d=function(){},e=0,f=function(a){a&&f.data(a),f.invalidate(),d(),f.render()};return f.render=function(){function d(){if(!g)return!1;if(e>b.length)return!1;var f=b.slice(e,e+c);e+=c,f.map(a),d3.timer(d)}e=0;var g=!0;f.invalidate=function(){g=!1},d()},f.data=function(a){return f.invalidate(),b=a.slice(0),f},f.rate=function(a){return arguments.length?(c=a,f):c},f.remaining=function(){return b.length-e},f.clear=function(a){return arguments.length?(d=a,f):(d(),f)},f.invalidate=function(){},f};var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(a){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=a.URL||a.webkitURL||a,e=b.createElementNS("http://www.w3.org/1999/xhtml","a"),f="download"in e,g=function(c){var d=b.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)},h=a.webkitRequestFileSystem,i=a.requestFileSystem||h||a.mozRequestFileSystem,j=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},k="application/octet-stream",l=0,m=[],n=function(){for(var a=m.length;a--;){var b=m[a];"string"==typeof b?d.revokeObjectURL(b):b.remove()}m.length=0},o=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){j(f)}}},p=function(b,d){var j,n,p,q=this,r=b.type,s=!1,t=function(){var a=c().createObjectURL(b);return m.push(a),a},u=function(){o(q,"writestart progress write writeend".split(" "))},v=function(){(s||!j)&&(j=t(b)),n&&(n.location.href=j),q.readyState=q.DONE,u()},w=function(a){return function(){return q.readyState!==q.DONE?a.apply(this,arguments):void 0}},x={create:!0,exclusive:!1};return q.readyState=q.INIT,d||(d="download"),f?(j=t(b),e.href=j,e.download=d,g(e),q.readyState=q.DONE,u(),void 0):(a.chrome&&r&&r!==k&&(p=b.slice||b.webkitSlice,b=p.call(b,0,b.size,k),s=!0),h&&"download"!==d&&(d+=".download"),n=r===k||h?a:a.open(),i?(l+=b.size,i(a.TEMPORARY,l,w(function(a){a.root.getDirectory("saved",x,w(function(a){var c=function(){a.getFile(d,x,w(function(a){a.createWriter(w(function(c){c.onwriteend=function(b){n.location.href=a.toURL(),m.push(a),q.readyState=q.DONE,o(q,"writeend",b)},c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&v()},"writestart progress write abort".split(" ").forEach(function(a){c["on"+a]=q["on"+a]}),c.write(b),q.abort=function(){c.abort(),q.readyState=q.DONE},q.readyState=q.WRITING}),v)}),v)};a.getFile(d,{create:!1},w(function(a){a.remove(),c()}),w(function(a){a.code===a.NOT_FOUND_ERR?c():v()}))}),v)}),v),void 0):(v(),void 0))},q=p.prototype,r=function(a,b){return new p(a,b)};return q.abort=function(){var a=this;a.readyState=a.DONE,o(a,"abort")},q.readyState=q.INIT=0,q.WRITING=1,q.DONE=2,q.error=q.onwritestart=q.onprogress=q.onwrite=q.onabort=q.onerror=q.onwriteend=null,a.addEventListener("unload",n,!1),r}(self);this.Handlebars={},function(a){a.VERSION="1.0.0-rc.3",a.COMPILER_REVISION=2,a.REVISION_CHANGES={1:"<= 1.0.rc.2",2:">= 1.0.0-rc.3"},a.helpers={},a.partials={},a.registerHelper=function(a,b,c){c&&(b.not=c),this.helpers[a]=b},a.registerPartial=function(a,b){this.partials[a]=b},a.registerHelper("helperMissing",function(a){if(2===arguments.length)return void 0;throw new Error("Could not find property '"+a+"'")});var b=Object.prototype.toString,c="[object Function]";a.registerHelper("blockHelperMissing",function(d,e){var f=e.inverse||function(){},g=e.fn,h=b.call(d);return h===c&&(d=d.call(this)),d===!0?g(this):d===!1||null==d?f(this):"[object Array]"===h?d.length>0?a.helpers.each(d,e):f(this):g(d)}),a.K=function(){},a.createFrame=Object.create||function(b){a.K.prototype=b;var c=new a.K;return a.K.prototype=null,c},a.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(b,c){if(a.logger.level<=b){var d=a.logger.methodMap[b];"undefined"!=typeof console&&console[d]&&console[d].call(console,c)}}},a.log=function(b,c){a.logger.log(b,c)},a.registerHelper("each",function(b,c){var d,e=c.fn,f=c.inverse,g=0,h="";if(c.data&&(d=a.createFrame(c.data)),b&&"object"==typeof b)if(b instanceof Array)for(var i=b.length;i>g;g++)d&&(d.index=g),h+=e(b[g],{data:d});else for(var j in b)b.hasOwnProperty(j)&&(d&&(d.key=j),h+=e(b[j],{data:d}),g++);return 0===g&&(h=f(this)),h}),a.registerHelper("if",function(d,e){var f=b.call(d);return f===c&&(d=d.call(this)),!d||a.Utils.isEmpty(d)?e.inverse(this):e.fn(this)}),a.registerHelper("unless",function(b,c){var d=c.fn,e=c.inverse;return c.fn=e,c.inverse=d,a.helpers["if"].call(this,b,c)}),a.registerHelper("with",function(a,b){return b.fn(a)}),a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,b)})}(this.Handlebars);var handlebars=function(){function a(){this.yy={}}var b={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,simpleInverse:6,statements:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,partialName:25,params:26,hash:27,DATA:28,param:29,STRING:30,INTEGER:31,BOOLEAN:32,hashSegments:33,hashSegment:34,ID:35,EQUALS:36,PARTIAL_NAME:37,pathSegments:38,SEP:39,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"DATA",30:"STRING",31:"INTEGER",32:"BOOLEAN",35:"ID",36:"EQUALS",37:"PARTIAL_NAME",39:"SEP"},productions_:[0,[3,2],[4,2],[4,3],[4,2],[4,1],[4,1],[4,0],[7,1],[7,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[6,2],[17,3],[17,2],[17,2],[17,1],[17,1],[26,2],[26,1],[29,1],[29,1],[29,1],[29,1],[29,1],[27,1],[33,2],[33,1],[34,3],[34,3],[34,3],[34,3],[34,3],[25,1],[21,1],[38,3],[38,1]],performAction:function(a,b,c,d,e,f){var g=f.length-1;switch(e){case 1:return f[g-1];case 2:this.$=new d.ProgramNode([],f[g]);break;case 3:this.$=new d.ProgramNode(f[g-2],f[g]);break;case 4:this.$=new d.ProgramNode(f[g-1],[]);break;case 5:this.$=new d.ProgramNode(f[g]);break;case 6:this.$=new d.ProgramNode([],[]);break;case 7:this.$=new d.ProgramNode([]);break;case 8:this.$=[f[g]];break;case 9:f[g-1].push(f[g]),this.$=f[g-1];break;case 10:this.$=new d.BlockNode(f[g-2],f[g-1].inverse,f[g-1],f[g]);break;case 11:this.$=new d.BlockNode(f[g-2],f[g-1],f[g-1].inverse,f[g]);break;case 12:this.$=f[g];break;case 13:this.$=f[g];break;case 14:this.$=new d.ContentNode(f[g]);break;case 15:this.$=new d.CommentNode(f[g]);break;case 16:this.$=new d.MustacheNode(f[g-1][0],f[g-1][1]);break;case 17:this.$=new d.MustacheNode(f[g-1][0],f[g-1][1]);break;case 18:this.$=f[g-1];break;case 19:this.$=new d.MustacheNode(f[g-1][0],f[g-1][1]);break;case 20:this.$=new d.MustacheNode(f[g-1][0],f[g-1][1],!0);break;case 21:this.$=new d.PartialNode(f[g-1]);break;case 22:this.$=new d.PartialNode(f[g-2],f[g-1]);break;case 23:break;case 24:this.$=[[f[g-2]].concat(f[g-1]),f[g]];break;case 25:this.$=[[f[g-1]].concat(f[g]),null];break;case 26:this.$=[[f[g-1]],f[g]];break;case 27:this.$=[[f[g]],null];break;case 28:this.$=[[new d.DataNode(f[g])],null];break;case 29:f[g-1].push(f[g]),this.$=f[g-1];break;case 30:this.$=[f[g]];break;case 31:this.$=f[g];break;case 32:this.$=new d.StringNode(f[g]);break;case 33:this.$=new d.IntegerNode(f[g]);break;case 34:this.$=new d.BooleanNode(f[g]);break;case 35:this.$=new d.DataNode(f[g]);break;case 36:this.$=new d.HashNode(f[g]);break;case 37:f[g-1].push(f[g]),this.$=f[g-1];break;case 38:this.$=[f[g]];break;case 39:this.$=[f[g-2],f[g]];break;case 40:this.$=[f[g-2],new d.StringNode(f[g])];break;case 41:this.$=[f[g-2],new d.IntegerNode(f[g])];break;case 42:this.$=[f[g-2],new d.BooleanNode(f[g])];break;case 43:this.$=[f[g-2],new d.DataNode(f[g])];break;case 44:this.$=new d.PartialNameNode(f[g]);break;case 45:this.$=new d.IdNode(f[g]);break;case 46:f[g-2].push(f[g]),this.$=f[g-2];break;case 47:this.$=[f[g]]}},table:[{3:1,4:2,5:[2,7],6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],22:[1,14],23:[1,15],24:[1,16]},{1:[3]},{5:[1,17]},{5:[2,6],7:18,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,6],22:[1,14],23:[1,15],24:[1,16]},{5:[2,5],6:20,8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,5],22:[1,14],23:[1,15],24:[1,16]},{17:23,18:[1,22],21:24,28:[1,25],35:[1,27],38:26},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{4:28,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],24:[1,16]},{4:29,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],24:[1,16]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{17:30,21:24,28:[1,25],35:[1,27],38:26},{17:31,21:24,28:[1,25],35:[1,27],38:26},{17:32,21:24,28:[1,25],35:[1,27],38:26},{25:33,37:[1,34]},{1:[2,1]},{5:[2,2],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,2],22:[1,14],23:[1,15],24:[1,16]},{17:23,21:24,28:[1,25],35:[1,27],38:26},{5:[2,4],7:35,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,4],22:[1,14],23:[1,15],24:[1,16]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,23],14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],24:[2,23]},{18:[1,36]},{18:[2,27],21:41,26:37,27:38,28:[1,45],29:39,30:[1,42],31:[1,43],32:[1,44],33:40,34:46,35:[1,47],38:26},{18:[2,28]},{18:[2,45],28:[2,45],30:[2,45],31:[2,45],32:[2,45],35:[2,45],39:[1,48]},{18:[2,47],28:[2,47],30:[2,47],31:[2,47],32:[2,47],35:[2,47],39:[2,47]},{10:49,20:[1,50]},{10:51,20:[1,50]},{18:[1,52]},{18:[1,53]},{18:[1,54]},{18:[1,55],21:56,35:[1,27],38:26},{18:[2,44],35:[2,44]},{5:[2,3],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,3],22:[1,14],23:[1,15],24:[1,16]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{18:[2,25],21:41,27:57,28:[1,45],29:58,30:[1,42],31:[1,43],32:[1,44],33:40,34:46,35:[1,47],38:26},{18:[2,26]},{18:[2,30],28:[2,30],30:[2,30],31:[2,30],32:[2,30],35:[2,30]},{18:[2,36],34:59,35:[1,60]},{18:[2,31],28:[2,31],30:[2,31],31:[2,31],32:[2,31],35:[2,31]},{18:[2,32],28:[2,32],30:[2,32],31:[2,32],32:[2,32],35:[2,32]},{18:[2,33],28:[2,33],30:[2,33],31:[2,33],32:[2,33],35:[2,33]},{18:[2,34],28:[2,34],30:[2,34],31:[2,34],32:[2,34],35:[2,34]},{18:[2,35],28:[2,35],30:[2,35],31:[2,35],32:[2,35],35:[2,35]},{18:[2,38],35:[2,38]},{18:[2,47],28:[2,47],30:[2,47],31:[2,47],32:[2,47],35:[2,47],36:[1,61],39:[2,47]},{35:[1,62]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{21:63,35:[1,27],38:26},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],24:[2,21]},{18:[1,64]},{18:[2,24]},{18:[2,29],28:[2,29],30:[2,29],31:[2,29],32:[2,29],35:[2,29]},{18:[2,37],35:[2,37]},{36:[1,61]},{21:65,28:[1,69],30:[1,66],31:[1,67],32:[1,68],35:[1,27],38:26},{18:[2,46],28:[2,46],30:[2,46],31:[2,46],32:[2,46],35:[2,46],39:[2,46]},{18:[1,70]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],24:[2,22]},{18:[2,39],35:[2,39]},{18:[2,40],35:[2,40]},{18:[2,41],35:[2,41]},{18:[2,42],35:[2,42]},{18:[2,43],35:[2,43]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]}],defaultActions:{17:[2,1],25:[2,28],38:[2,26],57:[2,24]},parseError:function(a){throw new Error(a)},parse:function(a){function b(){var a;return a=c.lexer.lex()||1,"number"!=typeof a&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0;this.lexer.setInput(a),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var l=this.lexer.yylloc;f.push(l);var m=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var n,o,p,q,r,s,t,u,v,w={};;){if(p=d[d.length-1],this.defaultActions[p]?q=this.defaultActions[p]:((null===n||"undefined"==typeof n)&&(n=b()),q=g[p]&&g[p][n]),"undefined"==typeof q||!q.length||!q[0]){var x="";if(!k){v=[];for(s in g[p])this.terminals_[s]&&s>2&&v.push("'"+this.terminals_[s]+"'");x=this.lexer.showPosition?"Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+v.join(", ")+", got '"+(this.terminals_[n]||n)+"'":"Parse error on line "+(i+1)+": Unexpected "+(1==n?"end of input":"'"+(this.terminals_[n]||n)+"'"),this.parseError(x,{text:this.lexer.match,token:this.terminals_[n]||n,line:this.lexer.yylineno,loc:l,expected:v})}}if(q[0]instanceof Array&&q.length>1)throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+n);switch(q[0]){case 1:d.push(n),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(q[1]),n=null,o?(n=o,o=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,l=this.lexer.yylloc,k>0&&k--);break;case 2:if(t=this.productions_[q[1]][1],w.$=e[e.length-t],w._$={first_line:f[f.length-(t||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(t||1)].first_column,last_column:f[f.length-1].last_column},m&&(w._$.range=[f[f.length-(t||1)].range[0],f[f.length-1].range[1]]),r=this.performAction.call(w,h,j,i,this.yy,q[1],e,f),"undefined"!=typeof r)return r;t&&(d=d.slice(0,2*-1*t),e=e.slice(0,-1*t),f=f.slice(0,-1*t)),d.push(this.productions_[q[1]][0]),e.push(w.$),f.push(w._$),u=g[d[d.length-2]][d[d.length-1]],d.push(u);break;case 3:return!0}}return!0}},c=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parser)throw new Error(a);this.yy.parser.parseError(a,b)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a;var b=a.match(/(?:\r\n?|\n).*/g);return b?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-b-1),this.offset-=b;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-b},this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]),this},more:function(){return this._more=!0,this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=new Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d,e;this._more||(this.yytext="",this.match="");for(var f=this._currentRules(),g=0;g<f.length&&(c=this._input.match(this.rules[f[g]]),!c||b&&!(c[0].length>b[0].length)||(b=c,d=g,this.options.flex));g++);return b?(e=b[0].match(/(?:\r\n?|\n).*/g),e&&(this.yylineno+=e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:e?e[e.length-1].length-e[e.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,f[d],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),a?a:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return"undefined"!=typeof a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(a){this.begin(a)}};return a.options={},a.performAction=function(a,b,c,d){switch(c){case 0:if("\\"!==b.yytext.slice(-1)&&this.begin("mu"),"\\"===b.yytext.slice(-1)&&(b.yytext=b.yytext.substr(0,b.yyleng-1),this.begin("emu")),b.yytext)return 14;break;case 1:return 14;case 2:return"\\"!==b.yytext.slice(-1)&&this.popState(),"\\"===b.yytext.slice(-1)&&(b.yytext=b.yytext.substr(0,b.yyleng-1)),14;case 3:return b.yytext=b.yytext.substr(0,b.yyleng-4),this.popState(),15;case 4:return this.begin("par"),24;case 5:return 16;case 6:return 20;case 7:return 19;case 8:return 19;case 9:return 23;case 10:return 23;case 11:this.popState(),this.begin("com");break;case 12:return b.yytext=b.yytext.substr(3,b.yyleng-5),this.popState(),15;case 13:return 22;case 14:return 36;case 15:return 35;case 16:return 35;case 17:return 39;case 18:break;case 19:return this.popState(),18;case 20:return this.popState(),18;case 21:return b.yytext=b.yytext.substr(1,b.yyleng-2).replace(/\\"/g,'"'),30;case 22:return b.yytext=b.yytext.substr(1,b.yyleng-2).replace(/\\'/g,"'"),30;case 23:return b.yytext=b.yytext.substr(1),28;case 24:return 32;case 25:return 32;case 26:return 31;case 27:return 35;case 28:return b.yytext=b.yytext.substr(1,b.yyleng-2),35;case 29:return"INVALID";case 30:break;case 31:return this.popState(),37;case 32:return 5}},a.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[} ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@[a-zA-Z]+)/,/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:[0-9]+(?=[}\s]))/,/^(?:[a-zA-Z0-9_$-]+(?=[=}\s\/.]))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:\s+)/,/^(?:[a-zA-Z0-9_$-/]+)/,/^(?:$)/],a.conditions={mu:{rules:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,32],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[3],inclusive:!1},par:{rules:[30,31],inclusive:!1},INITIAL:{rules:[0,1,32],inclusive:!0}},a}();return b.lexer=c,a.prototype=b,b.Parser=a,new a}();Handlebars.Parser=handlebars,Handlebars.parse=function(a){return a.constructor===Handlebars.AST.ProgramNode?a:(Handlebars.Parser.yy=Handlebars.AST,Handlebars.Parser.parse(a))},Handlebars.print=function(a){return(new Handlebars.PrintVisitor).accept(a)},function(){Handlebars.AST={},Handlebars.AST.ProgramNode=function(a,b){this.type="program",this.statements=a,b&&(this.inverse=new Handlebars.AST.ProgramNode(b))},Handlebars.AST.MustacheNode=function(a,b,c){this.type="mustache",this.escaped=!c,this.hash=b;var d=this.id=a[0],e=this.params=a.slice(1),f=this.eligibleHelper=d.isSimple;this.isHelper=f&&(e.length||b)},Handlebars.AST.PartialNode=function(a,b){this.type="partial",this.partialName=a,this.context=b};var a=function(a,b){if(a.original!==b.original)throw new Handlebars.Exception(a.original+" doesn't match "+b.original)};Handlebars.AST.BlockNode=function(b,c,d,e){a(b.id,e),this.type="block",this.mustache=b,this.program=c,this.inverse=d,this.inverse&&!this.program&&(this.isInverse=!0)},Handlebars.AST.ContentNode=function(a){this.type="content",this.string=a},Handlebars.AST.HashNode=function(a){this.type="hash",this.pairs=a},Handlebars.AST.IdNode=function(a){this.type="ID",this.original=a.join(".");for(var b=[],c=0,d=0,e=a.length;e>d;d++){var f=a[d];if(".."===f||"."===f||"this"===f){if(b.length>0)throw new Handlebars.Exception("Invalid path: "+this.original);".."===f?c++:this.isScoped=!0}else b.push(f)}this.parts=b,this.string=b.join("."),this.depth=c,this.isSimple=1===a.length&&!this.isScoped&&0===c,this.stringModeValue=this.string},Handlebars.AST.PartialNameNode=function(a){this.type="PARTIAL_NAME",this.name=a},Handlebars.AST.DataNode=function(a){this.type="DATA",this.id=a},Handlebars.AST.StringNode=function(a){this.type="STRING",this.string=a,this.stringModeValue=a},Handlebars.AST.IntegerNode=function(a){this.type="INTEGER",this.integer=a,this.stringModeValue=Number(a)},Handlebars.AST.BooleanNode=function(a){this.type="BOOLEAN",this.bool=a,this.stringModeValue="true"===a},Handlebars.AST.CommentNode=function(a){this.type="comment",this.comment=a}}();var errorProps=["description","fileName","lineNumber","message","name","number","stack"];if(Handlebars.Exception=function(){for(var a=Error.prototype.constructor.apply(this,arguments),b=0;b<errorProps.length;b++)this[errorProps[b]]=a[errorProps[b]]},Handlebars.Exception.prototype=new Error,Handlebars.SafeString=function(a){this.string=a},Handlebars.SafeString.prototype.toString=function(){return this.string.toString()},function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},b=/[&<>"'`]/g,c=/[&<>"'`]/,d=function(b){return a[b]||"&amp;"};Handlebars.Utils={escapeExpression:function(a){return a instanceof Handlebars.SafeString?a.toString():null==a||a===!1?"":c.test(a)?a.replace(b,d):a},isEmpty:function(a){return a||0===a?"[object Array]"===Object.prototype.toString.call(a)&&0===a.length?!0:!1:!0}}}(),Handlebars.Compiler=function(){},Handlebars.JavaScriptCompiler=function(){},function(a,b){a.prototype={compiler:a,disassemble:function(){for(var a,b,c,d=this.opcodes,e=[],f=0,g=d.length;g>f;f++)if(a=d[f],"DECLARE"===a.opcode)e.push("DECLARE "+a.name+"="+a.value);else{b=[];for(var h=0;h<a.args.length;h++)c=a.args[h],"string"==typeof c&&(c='"'+c.replace("\n","\\n")+'"'),b.push(c);e.push(a.opcode+" "+b.join(" "))}return e.join("\n")},equals:function(a){var b=this.opcodes.length;if(a.opcodes.length!==b)return!1;for(var c=0;b>c;c++){var d=this.opcodes[c],e=a.opcodes[c];if(d.opcode!==e.opcode||d.args.length!==e.args.length)return!1;for(var f=0;f<d.args.length;f++)if(d.args[f]!==e.args[f])return!1}return!0},guid:0,compile:function(a,b){this.children=[],this.depths={list:[]},this.options=b;var c=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},c)for(var d in c)this.options.knownHelpers[d]=c[d];return this.program(a)},accept:function(a){return this[a.type](a)},program:function(a){var b,c=a.statements;this.opcodes=[];for(var d=0,e=c.length;e>d;d++)b=c[d],this[b.type](b);return this.isSimple=1===e,this.depths.list=this.depths.list.sort(function(a,b){return a-b}),this},compileProgram:function(a){var b,c=(new this.compiler).compile(a,this.options),d=this.guid++;this.usePartial=this.usePartial||c.usePartial,this.children[d]=c;for(var e=0,f=c.depths.list.length;f>e;e++)b=c.depths.list[e],2>b||this.addDepth(b-1);return d},block:function(a){var b=a.mustache,c=a.program,d=a.inverse;c&&(c=this.compileProgram(c)),d&&(d=this.compileProgram(d));var e=this.classifyMustache(b);"helper"===e?this.helperMustache(b,c,d):"simple"===e?(this.simpleMustache(b),this.opcode("pushProgram",c),this.opcode("pushProgram",d),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousMustache(b,c,d),this.opcode("pushProgram",c),this.opcode("pushProgram",d),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(a){var b,c,d=a.pairs;this.opcode("pushHash");for(var e=0,f=d.length;f>e;e++)b=d[e],c=b[1],this.options.stringParams?this.opcode("pushStringParam",c.stringModeValue,c.type):this.accept(c),this.opcode("assignToHash",b[0]);this.opcode("popHash")},partial:function(a){var b=a.partialName;this.usePartial=!0,a.context?this.ID(a.context):this.opcode("push","depth0"),this.opcode("invokePartial",b.name),this.opcode("append")},content:function(a){this.opcode("appendContent",a.string)},mustache:function(a){var b=this.options,c=this.classifyMustache(a);"simple"===c?this.simpleMustache(a):"helper"===c?this.helperMustache(a):this.ambiguousMustache(a),a.escaped&&!b.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(a,b,c){var d=a.id,e=d.parts[0],f=null!=b||null!=c;this.opcode("getContext",d.depth),this.opcode("pushProgram",b),this.opcode("pushProgram",c),this.opcode("invokeAmbiguous",e,f)},simpleMustache:function(a){var b=a.id;"DATA"===b.type?this.DATA(b):b.parts.length?this.ID(b):(this.addDepth(b.depth),this.opcode("getContext",b.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(a,b,c){var d=this.setupFullMustacheParams(a,b,c),e=a.id.parts[0];if(this.options.knownHelpers[e])this.opcode("invokeKnownHelper",d.length,e);else{if(this.knownHelpersOnly)throw new Error("You specified knownHelpersOnly, but used the unknown helper "+e);this.opcode("invokeHelper",d.length,e)}},ID:function(a){this.addDepth(a.depth),this.opcode("getContext",a.depth);var b=a.parts[0];b?this.opcode("lookupOnContext",a.parts[0]):this.opcode("pushContext");for(var c=1,d=a.parts.length;d>c;c++)this.opcode("lookup",a.parts[c])},DATA:function(a){this.options.data=!0,this.opcode("lookupData",a.id)},STRING:function(a){this.opcode("pushString",a.string)},INTEGER:function(a){this.opcode("pushLiteral",a.integer)},BOOLEAN:function(a){this.opcode("pushLiteral",a.bool)},comment:function(){},opcode:function(a){this.opcodes.push({opcode:a,args:[].slice.call(arguments,1)})},declare:function(a,b){this.opcodes.push({opcode:"DECLARE",name:a,value:b})},addDepth:function(a){if(isNaN(a))throw new Error("EWOT");0!==a&&(this.depths[a]||(this.depths[a]=!0,this.depths.list.push(a)))},classifyMustache:function(a){var b=a.isHelper,c=a.eligibleHelper,d=this.options;if(c&&!b){var e=a.id.parts[0];d.knownHelpers[e]?b=!0:d.knownHelpersOnly&&(c=!1)}return b?"helper":c?"ambiguous":"simple"},pushParams:function(a){for(var b,c=a.length;c--;)b=a[c],this.options.stringParams?(b.depth&&this.addDepth(b.depth),this.opcode("getContext",b.depth||0),this.opcode("pushStringParam",b.stringModeValue,b.type)):this[b.type](b)},setupMustacheParams:function(a){var b=a.params;return this.pushParams(b),a.hash?this.hash(a.hash):this.opcode("emptyHash"),b},setupFullMustacheParams:function(a,b,c){var d=a.params;return this.pushParams(d),this.opcode("pushProgram",b),this.opcode("pushProgram",c),a.hash?this.hash(a.hash):this.opcode("emptyHash"),d
}};var c=function(a){this.value=a};b.prototype={nameLookup:function(a,c){return/^[0-9]+$/.test(c)?a+"["+c+"]":b.isValidJavaScriptVariableName(c)?a+"."+c:a+"['"+c+"']"},appendToBuffer:function(a){return this.environment.isSimple?"return "+a+";":{appendToBuffer:!0,content:a,toString:function(){return"buffer += "+a+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(a,b,c,d){this.environment=a,this.options=b||{},Handlebars.log(Handlebars.logger.DEBUG,this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!c,this.context=c||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.inlineStack=[],this.compileChildren(a,b);var e,f=a.opcodes;for(this.i=0,g=f.length;this.i<g;this.i++)e=f[this.i],"DECLARE"===e.opcode?this[e.name]=e.value:this[e.opcode].apply(this,e.args);return this.createFunctionContext(d)},nextOpcode:function(){var a=this.environment.opcodes;return a[this.i+1]},eat:function(){this.i=this.i+1},preamble:function(){var a=[];if(this.isChild)a.push("");else{var b=this.namespace,c="helpers = helpers || "+b+".helpers;";this.environment.usePartial&&(c=c+" partials = partials || "+b+".partials;"),this.options.data&&(c+=" data = data || {};"),a.push(c)}this.environment.isSimple?a.push(""):a.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=a},createFunctionContext:function(a){var b=this.stackVars.concat(this.registers.list);if(b.length>0&&(this.source[1]=this.source[1]+", "+b.join(", ")),!this.isChild)for(var c in this.context.aliases)this.source[1]=this.source[1]+", "+c+"="+this.context.aliases[c];this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");for(var d=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],e=0,f=this.environment.depths.list.length;f>e;e++)d.push("depth"+this.environment.depths.list[e]);var g=this.mergeSource();if(!this.isChild){var h=Handlebars.COMPILER_REVISION,i=Handlebars.REVISION_CHANGES[h];g="this.compilerInfo = ["+h+",'"+i+"'];\n"+g}if(a)return d.push(g),Function.apply(this,d);var j="function "+(this.name||"")+"("+d.join(",")+") {\n  "+g+"}";return Handlebars.log(Handlebars.logger.DEBUG,j+"\n\n"),j},mergeSource:function(){for(var a,b="",c=0,d=this.source.length;d>c;c++){var e=this.source[c];e.appendToBuffer?a=a?a+"\n    + "+e.content:e.content:(a&&(b+="buffer += "+a+";\n  ",a=void 0),b+=e+"\n  ")}return b},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var a=["depth0"];this.setupParams(0,a),this.replaceStack(function(b){return a.splice(1,0,b),"blockHelperMissing.call("+a.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var a=["depth0"];this.setupParams(0,a);var b=this.topStack();a.splice(1,0,b),a[a.length-1]="options",this.source.push("if (!"+this.lastHelper+") { "+b+" = blockHelperMissing.call("+a.join(", ")+"); }")},appendContent:function(a){this.source.push(this.appendToBuffer(this.quotedString(a)))},append:function(){this.flushInline();var a=this.popStack();this.source.push("if("+a+" || "+a+" === 0) { "+this.appendToBuffer(a)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(a){this.lastContext!==a&&(this.lastContext=a)},lookupOnContext:function(a){this.push(this.nameLookup("depth"+this.lastContext,a,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(a){return"typeof "+a+" === functionType ? "+a+".apply(depth0) : "+a})},lookup:function(a){this.replaceStack(function(b){return b+" == null || "+b+" === false ? "+b+" : "+this.nameLookup(b,a,"context")})},lookupData:function(a){this.push(this.nameLookup("data",a,"data"))},pushStringParam:function(a,b){this.pushStackLiteral("depth"+this.lastContext),this.pushString(b),"string"==typeof a?this.pushString(a):this.pushStackLiteral(a)},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&this.register("hashTypes","{}")},pushHash:function(){this.hash={values:[],types:[]}},popHash:function(){var a=this.hash;this.hash=void 0,this.options.stringParams&&this.register("hashTypes","{"+a.types.join(",")+"}"),this.push("{\n    "+a.values.join(",\n    ")+"\n  }")},pushString:function(a){this.pushStackLiteral(this.quotedString(a))},push:function(a){return this.inlineStack.push(a),a},pushLiteral:function(a){this.pushStackLiteral(a)},pushProgram:function(a){null!=a?this.pushStackLiteral(this.programExpression(a)):this.pushStackLiteral(null)},invokeHelper:function(a,b){this.context.aliases.helperMissing="helpers.helperMissing";var c=this.lastHelper=this.setupHelper(a,b,!0);this.push(c.name),this.replaceStack(function(a){return a+" ? "+a+".call("+c.callParams+") "+": helperMissing.call("+c.helperMissingParams+")"})},invokeKnownHelper:function(a,b){var c=this.setupHelper(a,b);this.push(c.name+".call("+c.callParams+")")},invokeAmbiguous:function(a,b){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var c=this.setupHelper(0,a,b),d=this.lastHelper=this.nameLookup("helpers",a,"helper"),e=this.nameLookup("depth"+this.lastContext,a,"context"),f=this.nextStack();this.source.push("if ("+f+" = "+d+") { "+f+" = "+f+".call("+c.callParams+"); }"),this.source.push("else { "+f+" = "+e+"; "+f+" = typeof "+f+" === functionType ? "+f+".apply(depth0) : "+f+"; }")},invokePartial:function(a){var b=[this.nameLookup("partials",a,"partial"),"'"+a+"'",this.popStack(),"helpers","partials"];this.options.data&&b.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+b.join(", ")+")")},assignToHash:function(a){var b,c=this.popStack();this.options.stringParams&&(b=this.popStack(),this.popStack());var d=this.hash;b&&d.types.push("'"+a+"': "+b),d.values.push("'"+a+"': ("+c+")")},compiler:b,compileChildren:function(a,b){for(var c,d,e=a.children,f=0,g=e.length;g>f;f++){c=e[f],d=new this.compiler;var h=this.matchExistingProgram(c);null==h?(this.context.programs.push(""),h=this.context.programs.length,c.index=h,c.name="program"+h,this.context.programs[h]=d.compile(c,b,this.context),this.context.environments[h]=c):(c.index=h,c.name="program"+h)}},matchExistingProgram:function(a){for(var b=0,c=this.context.environments.length;c>b;b++){var d=this.context.environments[b];if(d&&d.equals(a))return b}},programExpression:function(a){if(this.context.aliases.self="this",null==a)return"self.noop";for(var b,c=this.environment.children[a],d=c.depths.list,e=[c.index,c.name,"data"],f=0,g=d.length;g>f;f++)b=d[f],1===b?e.push("depth0"):e.push("depth"+(b-1));return 0===d.length?"self.program("+e.join(", ")+")":(e.shift(),"self.programWithDepth("+e.join(", ")+")")},register:function(a,b){this.useRegister(a),this.source.push(a+" = "+b+";")},useRegister:function(a){this.registers[a]||(this.registers[a]=!0,this.registers.list.push(a))},pushStackLiteral:function(a){return this.push(new c(a))},pushStack:function(a){this.flushInline();var b=this.incrStack();return a&&this.source.push(b+" = "+a+";"),this.compileStack.push(b),b},replaceStack:function(a){var b,d="",e=this.isInline();if(e){var f=this.popStack(!0);if(f instanceof c)b=f.value;else{var g=this.stackSlot?this.topStackName():this.incrStack();d="("+this.push(g)+" = "+f+"),",b=this.topStack()}}else b=this.topStack();var h=a.call(this,b);return e?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+d+h+")")):(/^stack/.test(b)||(b=this.nextStack()),this.source.push(b+" = ("+d+h+");")),b},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var a=this.inlineStack;if(a.length){this.inlineStack=[];for(var b=0,d=a.length;d>b;b++){var e=a[b];e instanceof c?this.compileStack.push(e):this.pushStack(e)}}},isInline:function(){return this.inlineStack.length},popStack:function(a){var b=this.isInline(),d=(b?this.inlineStack:this.compileStack).pop();return!a&&d instanceof c?d.value:(b||this.stackSlot--,d)},topStack:function(a){var b=this.isInline()?this.inlineStack:this.compileStack,d=b[b.length-1];return!a&&d instanceof c?d.value:d},quotedString:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'},setupHelper:function(a,b,c){var d=[];this.setupParams(a,d,c);var e=this.nameLookup("helpers",b,"helper");return{params:d,name:e,callParams:["depth0"].concat(d).join(", "),helperMissingParams:c&&["depth0",this.quotedString(b)].concat(d).join(", ")}},setupParams:function(a,b,c){var d,e,f,g=[],h=[],i=[];g.push("hash:"+this.popStack()),e=this.popStack(),f=this.popStack(),(f||e)&&(f||(this.context.aliases.self="this",f="self.noop"),e||(this.context.aliases.self="this",e="self.noop"),g.push("inverse:"+e),g.push("fn:"+f));for(var j=0;a>j;j++)d=this.popStack(),b.push(d),this.options.stringParams&&(i.push(this.popStack()),h.push(this.popStack()));return this.options.stringParams&&(g.push("contexts:["+h.join(",")+"]"),g.push("types:["+i.join(",")+"]"),g.push("hashTypes:hashTypes")),this.options.data&&g.push("data:data"),g="{"+g.join(",")+"}",c?(this.register("options",g),b.push("options")):b.push(g),b.join(", ")}};for(var d="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),e=b.RESERVED_WORDS={},f=0,g=d.length;g>f;f++)e[d[f]]=!0;b.isValidJavaScriptVariableName=function(a){return!b.RESERVED_WORDS[a]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(a)?!0:!1}}(Handlebars.Compiler,Handlebars.JavaScriptCompiler),Handlebars.precompile=function(a,b){if(!a||"string"!=typeof a&&a.constructor!==Handlebars.AST.ProgramNode)throw new Handlebars.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+a);b=b||{},"data"in b||(b.data=!0);var c=Handlebars.parse(a),d=(new Handlebars.Compiler).compile(c,b);return(new Handlebars.JavaScriptCompiler).compile(d,b)},Handlebars.compile=function(a,b){function c(){var c=Handlebars.parse(a),d=(new Handlebars.Compiler).compile(c,b),e=(new Handlebars.JavaScriptCompiler).compile(d,b,void 0,!0);return Handlebars.template(e)}if(!a||"string"!=typeof a&&a.constructor!==Handlebars.AST.ProgramNode)throw new Handlebars.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+a);b=b||{},"data"in b||(b.data=!0);var d;return function(a,b){return d||(d=c()),d.call(this,a,b)}},Handlebars.VM={template:function(a){var b={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(a,b,c){var d=this.programs[a];return c?Handlebars.VM.program(b,c):d?d:d=this.programs[a]=Handlebars.VM.program(b)},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop,compilerInfo:null};return function(c,d){d=d||{};var e=a.call(b,Handlebars,c,d.helpers,d.partials,d.data),f=b.compilerInfo||[],g=f[0]||1,h=Handlebars.COMPILER_REVISION;if(g!==h){if(h>g){var i=Handlebars.REVISION_CHANGES[h],j=Handlebars.REVISION_CHANGES[g];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+j+")."}throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+f[1]+")."}return e}},programWithDepth:function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(d,e){return e=e||{},a.apply(this,[d,e.data||b].concat(c))}},program:function(a,b){return function(c,d){return d=d||{},a(c,d.data||b)}},noop:function(){return""},invokePartial:function(a,b,c,d,e,f){var g={helpers:d,partials:e,data:f};if(void 0===a)throw new Handlebars.Exception("The partial "+b+" could not be found");if(a instanceof Function)return a(c,g);if(Handlebars.compile)return e[b]=Handlebars.compile(a,{data:void 0!==f}),e[b](c,g);throw new Handlebars.Exception("The partial "+b+" could not be compiled when running in runtime-only mode")}},Handlebars.template=Handlebars.VM.template,function(a,b){"object"==typeof exports?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a)}(this,function(a){function b(a){this._targetElement=a,this._options={nextLabel:"Next &rarr;",prevLabel:"&larr; Back",skipLabel:"Skip",doneLabel:"Done",tooltipPosition:"bottom",exitOnEsc:!0,exitOnOverlayClick:!0,showStepNumbers:!0}}function c(){"undefined"!=typeof this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,this._targetElement),"undefined"==typeof this._currentStep?this._currentStep=0:++this._currentStep,this._introItems.length<=this._currentStep?("function"==typeof this._introCompleteCallback&&this._introCompleteCallback.call(this),e.call(this,this._targetElement)):h.call(this,this._introItems[this._currentStep])}function d(){return 0===this._currentStep?!1:("undefined"!=typeof this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,this._targetElement),h.call(this,this._introItems[--this._currentStep]),void 0)}function e(a){var b=a.querySelector(".introjs-overlay");if(b.style.opacity=0,setTimeout(function(){b.parentNode&&b.parentNode.removeChild(b)},500),(a=a.querySelector(".introjs-helperLayer"))&&a.parentNode.removeChild(a),(a=document.querySelector(".introjs-showElement"))&&(a.className=a.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,"")),(a=document.querySelectorAll(".introjs-fixParent"))&&0<a.length)for(var c=a.length-1;c>=0;c--)a[c].className=a[c].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");window.removeEventListener?window.removeEventListener("keydown",this._onKeyDown,!0):document.detachEvent&&document.detachEvent("onkeydown",this._onKeyDown),this._currentStep=void 0}function f(a,b,c){if(b.style.top=null,b.style.right=null,b.style.bottom=null,b.style.left=null,this._introItems[this._currentStep])switch(this._introItems[this._currentStep].position){case"top":b.style.left="15px",b.style.top="-"+(k(b).height+10)+"px",c.className="introjs-arrow bottom";break;case"right":b.style.left=k(a).width+20+"px",c.className="introjs-arrow left";break;case"left":b.style.top="15px",b.style.right=k(a).width+20+"px",c.className="introjs-arrow right";break;default:b.style.bottom="-"+(k(b).height+10)+"px",c.className="introjs-arrow top"}}function g(a){if(a&&this._introItems[this._currentStep]){var b=k(this._introItems[this._currentStep].element);a.setAttribute("style","width: "+(b.width+10)+"px; height:"+(b.height+10)+"px; top:"+(b.top-5)+"px;left: "+(b.left-5)+"px;")}}function h(a){var b;"undefined"!=typeof this._introChangeCallback&&this._introChangeCallback.call(this,a.element);var h=this,j=document.querySelector(".introjs-helperLayer");if(k(a.element),null!=j){var l=j.querySelector(".introjs-helperNumberLayer"),m=j.querySelector(".introjs-tooltiptext"),n=j.querySelector(".introjs-arrow"),o=j.querySelector(".introjs-tooltip"),p=j.querySelector(".introjs-skipbutton");b=j.querySelector(".introjs-prevbutton");var q=j.querySelector(".introjs-nextbutton");if(o.style.opacity=0,g.call(h,j),(j=document.querySelectorAll(".introjs-fixParent"))&&0<j.length)for(var r=j.length-1;r>=0;r--)j[r].className=j[r].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");j=document.querySelector(".introjs-showElement"),j.className=j.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,""),h._lastShowElementTimer&&clearTimeout(h._lastShowElementTimer),h._lastShowElementTimer=setTimeout(function(){null!=l&&(l.innerHTML=a.step),m.innerHTML=a.intro,f.call(h,a.element,o,n),o.style.opacity=1},350)}else{p=document.createElement("div"),j=document.createElement("div"),r=document.createElement("div"),p.className="introjs-helperLayer",g.call(h,p),this._targetElement.appendChild(p),j.className="introjs-arrow",r.className="introjs-tooltip",r.innerHTML='<div class="introjs-tooltiptext">'+a.intro+'</div><div class="introjs-tooltipbuttons"></div>',this._options.showStepNumbers&&(b=document.createElement("span"),b.className="introjs-helperNumberLayer",b.innerHTML=a.step,p.appendChild(b)),r.appendChild(j),p.appendChild(r),q=document.createElement("a"),q.onclick=function(){h._introItems.length-1!=h._currentStep&&c.call(h)},q.href="javascript:void(0);",q.innerHTML=this._options.nextLabel,b=document.createElement("a"),b.onclick=function(){0!=h._currentStep&&d.call(h)},b.href="javascript:void(0);",b.innerHTML=this._options.prevLabel,p=document.createElement("a"),p.className="introjs-button introjs-skipbutton",p.href="javascript:void(0);",p.innerHTML=this._options.skipLabel,p.onclick=function(){h._introItems.length-1==h._currentStep&&"function"==typeof h._introCompleteCallback&&h._introCompleteCallback.call(h),h._introItems.length-1!=h._currentStep&&"function"==typeof h._introExitCallback&&h._introExitCallback.call(h),e.call(h,h._targetElement)};var s=r.querySelector(".introjs-tooltipbuttons");s.appendChild(p),s.appendChild(b),s.appendChild(q),f.call(h,a.element,r,j)}for(0==this._currentStep?(b.className="introjs-button introjs-prevbutton introjs-disabled",q.className="introjs-button introjs-nextbutton",p.innerHTML=this._options.skipLabel):this._introItems.length-1==this._currentStep?(p.innerHTML=this._options.doneLabel,b.className="introjs-button introjs-prevbutton",q.className="introjs-button introjs-nextbutton introjs-disabled"):(b.className="introjs-button introjs-prevbutton",q.className="introjs-button introjs-nextbutton",p.innerHTML=this._options.skipLabel),q.focus(),a.element.className+=" introjs-showElement",p=i(a.element,"position"),"absolute"!==p&&"relative"!==p&&(a.element.className+=" introjs-relativePosition"),p=a.element.parentNode;null!=p&&"body"!==p.tagName.toLowerCase();)b=i(p,"z-index"),/[0-9]+/.test(b)&&(p.className+=" introjs-fixParent"),p=p.parentNode;p=a.element.getBoundingClientRect(),0<=p.top&&0<=p.left&&p.bottom+80<=window.innerHeight&&p.right<=window.innerWidth||(b=a.element.getBoundingClientRect(),p=b.bottom-(b.bottom-b.top),q=b.bottom,b=void 0!=window.innerWidth?window.innerHeight:document.documentElement.clientHeight,b=q-b,0>p?window.scrollBy(0,p-30):window.scrollBy(0,b+100))}function i(a,b){var c="";return a.currentStyle?c=a.currentStyle[b]:document.defaultView&&document.defaultView.getComputedStyle&&(c=document.defaultView.getComputedStyle(a,null).getPropertyValue(b)),c.toLowerCase?c.toLowerCase():c}function j(a){var b=document.createElement("div"),c="",d=this;if(b.className="introjs-overlay","body"===a.tagName.toLowerCase())c+="top: 0;bottom: 0; left: 0;right: 0;position: fixed;",b.setAttribute("style",c);else{var f=k(a);f&&(c+="width: "+f.width+"px; height:"+f.height+"px; top:"+f.top+"px;left: "+f.left+"px;",b.setAttribute("style",c))}return a.appendChild(b),b.onclick=function(){1==d._options.exitOnOverlayClick&&e.call(d,a),void 0!=d._introExitCallback&&d._introExitCallback.call(d)},setTimeout(function(){c+="opacity: .8;",b.setAttribute("style",c)},10),!0}function k(a){var b={};b.width=a.offsetWidth,b.height=a.offsetHeight;for(var c=0,d=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)c+=a.offsetLeft,d+=a.offsetTop,a=a.offsetParent;return b.top=d,b.left=c,b}var l=function(a){if("object"==typeof a)return new b(a);if("string"==typeof a){if(a=document.querySelector(a))return new b(a);throw Error("There is no element with given selector.")}return new b(document.body)};return l.version="0.4.0",l.fn=b.prototype={clone:function(){return new b(this)},setOption:function(a,b){return this._options[a]=b,this},setOptions:function(a){var b,c=this._options,d={};for(b in c)d[b]=c[b];for(b in a)d[b]=a[b];return this._options=d,this},start:function(){a:{var a=this._targetElement,b=[],f=this;if(this._options.steps)for(var h=[],i=0,h=this._options.steps.length;h>i;i++){var k=this._options.steps[i];k.step=i+1,k.element=document.querySelector(k.element),b.push(k)}else{if(h=a.querySelectorAll("*[data-intro]"),1>h.length)break a;for(i=0,k=h.length;k>i;i++){var l=h[i];b.push({element:l,intro:l.getAttribute("data-intro"),step:parseInt(l.getAttribute("data-step"),10),position:l.getAttribute("data-position")||this._options.tooltipPosition})}}b.sort(function(a,b){return a.step-b.step}),f._introItems=b,j.call(f,a)&&(c.call(f),a.querySelector(".introjs-skipbutton"),a.querySelector(".introjs-nextbutton"),f._onKeyDown=function(b){27===b.keyCode&&1==f._options.exitOnEsc?(e.call(f,a),void 0!=f._introExitCallback&&f._introExitCallback.call(f)):37===b.keyCode?d.call(f):(39===b.keyCode||13===b.keyCode)&&(c.call(f),b.preventDefault?b.preventDefault():b.returnValue=!1)},f._onResize=function(){g.call(f,document.querySelector(".introjs-helperLayer"))},window.addEventListener?(window.addEventListener("keydown",f._onKeyDown,!0),window.addEventListener("resize",f._onResize,!0)):document.attachEvent&&(document.attachEvent("onkeydown",f._onKeyDown),document.attachEvent("onresize",f._onResize)))}return this},goToStep:function(a){return this._currentStep=a-2,"undefined"!=typeof this._introItems&&c.call(this),this},exit:function(){e.call(this,this._targetElement)},onbeforechange:function(a){if("function"!=typeof a)throw Error("Provided callback for onbeforechange was not a function");return this._introBeforeChangeCallback=a,this},onchange:function(a){if("function"!=typeof a)throw Error("Provided callback for onchange was not a function.");return this._introChangeCallback=a,this},oncomplete:function(a){if("function"!=typeof a)throw Error("Provided callback for oncomplete was not a function.");return this._introCompleteCallback=a,this},onexit:function(a){if("function"!=typeof a)throw Error("Provided callback for onexit was not a function.");return this._introExitCallback=a,this}},a.introJs=l}),function(){function a(){var a={};return a.FRAMERATE=30,a.MAX_VIRTUAL_PIXELS=3e4,a.init=function(b){var c=0;a.UniqueId=function(){return c++,"canvg"+c},a.Definitions={},a.Styles={},a.Animations=[],a.Images=[],a.ctx=b,a.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(a,b){this.viewPorts.push({width:a,height:b})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(a){return null!=a&&"number"==typeof a?a:"x"==a?this.width():"y"==a?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},a.init(),a.ImagesLoaded=function(){for(var b=0;b<a.Images.length;b++)if(!a.Images[b].loaded)return!1;return!0},a.trim=function(a){return a.replace(/^\s+|\s+$/g,"")},a.compressSpaces=function(a){return a.replace(/[\s\r\t\n]+/gm," ")},a.ajax=function(a){var b;return b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b?(b.open("GET",a,!1),b.send(null),b.responseText):null},a.parseXml=function(a){if(window.DOMParser){var b=new DOMParser;return b.parseFromString(a,"text/xml")}a=a.replace(/<!DOCTYPE svg[^>]*>/,"");var c=new ActiveXObject("Microsoft.XMLDOM");return c.async="false",c.loadXML(a),c},a.Property=function(a,b){this.name=a,this.value=b},a.Property.prototype.getValue=function(){return this.value},a.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},a.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var a=parseFloat(this.value);return(this.value+"").match(/%$/)&&(a/=100),a},a.Property.prototype.valueOrDefault=function(a){return this.hasValue()?this.value:a},a.Property.prototype.numValueOrDefault=function(a){return this.hasValue()?this.numValue():a},a.Property.prototype.addOpacity=function(b){var c=this.value;if(null!=b&&""!=b&&"string"==typeof this.value){var d=new RGBColor(this.value);d.ok&&(c="rgba("+d.r+", "+d.g+", "+d.b+", "+b+")")}return new a.Property(this.name,c)},a.Property.prototype.getDefinition=function(){var b=this.value.match(/#([^\)']+)/);return b&&(b=b[1]),b||(b=this.value),a.Definitions[b]},a.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},a.Property.prototype.getFillStyleDefinition=function(b,c){var d=this.getDefinition();if(null!=d&&d.createGradient)return d.createGradient(a.ctx,b,c);if(null!=d&&d.createPattern){if(d.getHrefAttribute().hasValue()){var e=d.attribute("patternTransform");d=d.getHrefAttribute().getDefinition(),e.hasValue()&&(d.attribute("patternTransform",!0).value=e.value)}return d.createPattern(a.ctx,b)}return null},a.Property.prototype.getDPI=function(){return 96},a.Property.prototype.getEM=function(b){var c=12,d=new a.Property("fontSize",a.Font.Parse(a.ctx.font).fontSize);return d.hasValue()&&(c=d.toPixels(b)),c},a.Property.prototype.getUnits=function(){var a=this.value+"";return a.replace(/[0-9\.\-]/g,"")},a.Property.prototype.toPixels=function(b,c){if(!this.hasValue())return 0;var d=this.value+"";if(d.match(/em$/))return this.numValue()*this.getEM(b);if(d.match(/ex$/))return this.numValue()*this.getEM(b)/2;if(d.match(/px$/))return this.numValue();if(d.match(/pt$/))return this.numValue()*this.getDPI(b)*(1/72);if(d.match(/pc$/))return 15*this.numValue();if(d.match(/cm$/))return this.numValue()*this.getDPI(b)/2.54;if(d.match(/mm$/))return this.numValue()*this.getDPI(b)/25.4;if(d.match(/in$/))return this.numValue()*this.getDPI(b);if(d.match(/%$/))return this.numValue()*a.ViewPort.ComputeSize(b);var e=this.numValue();return c&&1>e?e*a.ViewPort.ComputeSize(b):e},a.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var a=this.value+"";return a.match(/s$/)?1e3*this.numValue():a.match(/ms$/)?this.numValue():this.numValue()},a.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var a=this.value+"";return a.match(/deg$/)?this.numValue()*(Math.PI/180):a.match(/grad$/)?this.numValue()*(Math.PI/200):a.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)},a.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(b,c,d,e,f,g){var h=null!=g?this.Parse(g):this.CreateFont("","","","","",a.ctx.font);return{fontFamily:f||h.fontFamily,fontSize:e||h.fontSize,fontStyle:b||h.fontStyle,fontWeight:d||h.fontWeight,fontVariant:c||h.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var b=this;this.Parse=function(c){for(var d={},e=a.trim(a.compressSpaces(c||"")).split(" "),f={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},g="",h=0;h<e.length;h++)f.fontStyle||-1==b.Styles.indexOf(e[h])?f.fontVariant||-1==b.Variants.indexOf(e[h])?f.fontWeight||-1==b.Weights.indexOf(e[h])?f.fontSize?"inherit"!=e[h]&&(g+=e[h]):("inherit"!=e[h]&&(d.fontSize=e[h].split("/")[0]),f.fontStyle=f.fontVariant=f.fontWeight=f.fontSize=!0):("inherit"!=e[h]&&(d.fontWeight=e[h]),f.fontStyle=f.fontVariant=f.fontWeight=!0):("inherit"!=e[h]&&(d.fontVariant=e[h]),f.fontStyle=f.fontVariant=!0):("inherit"!=e[h]&&(d.fontStyle=e[h]),f.fontStyle=!0);return""!=g&&(d.fontFamily=g),d}},a.ToNumberArray=function(b){for(var c=a.trim(a.compressSpaces((b||"").replace(/,/g," "))).split(" "),d=0;d<c.length;d++)c[d]=parseFloat(c[d]);return c},a.Point=function(a,b){this.x=a,this.y=b},a.Point.prototype.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},a.Point.prototype.applyTransform=function(a){var b=this.x*a[0]+this.y*a[2]+a[4],c=this.x*a[1]+this.y*a[3]+a[5];this.x=b,this.y=c},a.CreatePoint=function(b){var c=a.ToNumberArray(b);return new a.Point(c[0],c[1])},a.CreatePath=function(b){for(var c=a.ToNumberArray(b),d=[],e=0;e<c.length;e+=2)d.push(new a.Point(c[e],c[e+1]));return d},a.BoundingBox=function(a,b,c,d){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(a,b){null!=a&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=a,this.x2=a),a<this.x1&&(this.x1=a),a>this.x2&&(this.x2=a)),null!=b&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=b,this.y2=b),b<this.y1&&(this.y1=b),b>this.y2&&(this.y2=b))},this.addX=function(a){this.addPoint(a,null)},this.addY=function(a){this.addPoint(null,a)},this.addBoundingBox=function(a){this.addPoint(a.x1,a.y1),this.addPoint(a.x2,a.y2)},this.addQuadraticCurve=function(a,b,c,d,e,f){var g=a+2/3*(c-a),h=b+2/3*(d-b),i=g+1/3*(e-a),j=h+1/3*(f-b);this.addBezierCurve(a,b,g,i,h,j,e,f)},this.addBezierCurve=function(a,b,c,d,e,f,g,h){var j=[a,b],k=[c,d],l=[e,f],m=[g,h];for(this.addPoint(j[0],j[1]),this.addPoint(m[0],m[1]),i=0;1>=i;i++){var n=function(a){return Math.pow(1-a,3)*j[i]+3*Math.pow(1-a,2)*a*k[i]+3*(1-a)*Math.pow(a,2)*l[i]+Math.pow(a,3)*m[i]},o=6*j[i]-12*k[i]+6*l[i],p=-3*j[i]+9*k[i]-9*l[i]+3*m[i],q=3*k[i]-3*j[i];if(0!=p){var r=Math.pow(o,2)-4*q*p;if(!(0>r)){var s=(-o+Math.sqrt(r))/(2*p);s>0&&1>s&&(0==i&&this.addX(n(s)),1==i&&this.addY(n(s)));var t=(-o-Math.sqrt(r))/(2*p);t>0&&1>t&&(0==i&&this.addX(n(t)),1==i&&this.addY(n(t)))}}else{if(0==o)continue;var u=-q/o;u>0&&1>u&&(0==i&&this.addX(n(u)),1==i&&this.addY(n(u)))}}},this.isPointInBox=function(a,b){return this.x1<=a&&a<=this.x2&&this.y1<=b&&b<=this.y2},this.addPoint(a,b),this.addPoint(c,d)},a.Transform=function(b){var c=this;this.Type={},this.Type.translate=function(b){this.p=a.CreatePoint(b),this.apply=function(a){a.translate(this.p.x||0,this.p.y||0)},this.unapply=function(a){a.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(a){a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(b){var c=a.ToNumberArray(b);this.angle=new a.Property("angle",c[0]),this.cx=c[1]||0,this.cy=c[2]||0,this.apply=function(a){a.translate(this.cx,this.cy),a.rotate(this.angle.toRadians()),a.translate(-this.cx,-this.cy)},this.unapply=function(a){a.translate(this.cx,this.cy),a.rotate(-1*this.angle.toRadians()),a.translate(-this.cx,-this.cy)},this.applyToPoint=function(a){var b=this.angle.toRadians();a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),a.applyTransform([Math.cos(b),Math.sin(b),-Math.sin(b),Math.cos(b),0,0]),a.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(b){this.p=a.CreatePoint(b),this.apply=function(a){a.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(a){a.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(a){a.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(b){this.m=a.ToNumberArray(b),this.apply=function(a){a.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.applyToPoint=function(a){a.applyTransform(this.m)}},this.Type.SkewBase=function(b){this.base=c.Type.matrix,this.base(b),this.angle=new a.Property("angle",b)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(a){this.base=c.Type.SkewBase,this.base(a),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(a){this.base=c.Type.SkewBase,this.base(a),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]
},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].apply(a)},this.unapply=function(a){for(var b=this.transforms.length-1;b>=0;b--)this.transforms[b].unapply(a)},this.applyToPoint=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].applyToPoint(a)};for(var d=a.trim(a.compressSpaces(b)).replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),e=0;e<d.length;e++){var f=a.trim(d[e].split("(")[0]),g=d[e].split("(")[1].replace(")",""),h=new this.Type[f](g);h.type=f,this.transforms.push(h)}},a.AspectRatio=function(b,c,d,e,f,g,h,i,j,k){c=a.compressSpaces(c),c=c.replace(/^defer\s/,"");var l=c.split(" ")[0]||"xMidYMid",m=c.split(" ")[1]||"meet",n=d/e,o=f/g,p=Math.min(n,o),q=Math.max(n,o);"meet"==m&&(e*=p,g*=p),"slice"==m&&(e*=q,g*=q),j=new a.Property("refX",j),k=new a.Property("refY",k),j.hasValue()&&k.hasValue()?b.translate(-p*j.toPixels("x"),-p*k.toPixels("y")):(l.match(/^xMid/)&&("meet"==m&&p==o||"slice"==m&&q==o)&&b.translate(d/2-e/2,0),l.match(/YMid$/)&&("meet"==m&&p==n||"slice"==m&&q==n)&&b.translate(0,f/2-g/2),l.match(/^xMax/)&&("meet"==m&&p==o||"slice"==m&&q==o)&&b.translate(d-e,0),l.match(/YMax$/)&&("meet"==m&&p==n||"slice"==m&&q==n)&&b.translate(0,f-g)),"none"==l?b.scale(n,o):"meet"==m?b.scale(p,p):"slice"==m&&b.scale(q,q),b.translate(null==h?0:-h,null==i?0:-i)},a.Element={},a.EmptyProperty=new a.Property("EMPTY",""),a.Element.ElementBase=function(b){if(this.attributes={},this.styles={},this.children=[],this.attribute=function(b,c){var d=this.attributes[b];return null!=d?d:(1==c&&(d=new a.Property(b,""),this.attributes[b]=d),d||a.EmptyProperty)},this.getHrefAttribute=function(){for(var b in this.attributes)if(b.match(/:href$/))return this.attributes[b];return a.EmptyProperty},this.style=function(b,c){var d=this.styles[b];if(null!=d)return d;var e=this.attribute(b);if(null!=e&&e.hasValue())return this.styles[b]=e,e;var f=this.parent;if(null!=f){var g=f.style(b);if(null!=g&&g.hasValue())return g}return 1==c&&(d=new a.Property(b,""),this.styles[b]=d),d||a.EmptyProperty},this.render=function(a){if("none"!=this.style("display").value&&"hidden"!=this.attribute("visibility").value){if(a.save(),this.attribute("mask").hasValue()){var b=this.attribute("mask").getDefinition();null!=b&&b.apply(a,this)}else if(this.style("filter").hasValue()){var c=this.style("filter").getDefinition();null!=c&&c.apply(a,this)}else this.setContext(a),this.renderChildren(a),this.clearContext(a);a.restore()}},this.setContext=function(){},this.clearContext=function(){},this.renderChildren=function(a){for(var b=0;b<this.children.length;b++)this.children[b].render(a)},this.addChild=function(b,c){var d=b;c&&(d=a.CreateElement(b)),d.parent=this,this.children.push(d)},null!=b&&1==b.nodeType){for(var c=0;c<b.childNodes.length;c++){var d=b.childNodes[c];if(1==d.nodeType&&this.addChild(d,!0),this.captureTextNodes&&3==d.nodeType){var e=d.nodeValue||d.text||"";""!=a.trim(a.compressSpaces(e))&&this.addChild(new a.Element.tspan(d),!1)}}for(var c=0;c<b.attributes.length;c++){var f=b.attributes[c];this.attributes[f.nodeName]=new a.Property(f.nodeName,f.nodeValue)}var g=a.Styles[b.nodeName];if(null!=g)for(var h in g)this.styles[h]=g[h];if(this.attribute("class").hasValue())for(var i=a.compressSpaces(this.attribute("class").value).split(" "),j=0;j<i.length;j++){if(g=a.Styles["."+i[j]],null!=g)for(var h in g)this.styles[h]=g[h];if(g=a.Styles[b.nodeName+"."+i[j]],null!=g)for(var h in g)this.styles[h]=g[h]}if(this.attribute("id").hasValue()){var g=a.Styles["#"+this.attribute("id").value];if(null!=g)for(var h in g)this.styles[h]=g[h]}if(this.attribute("style").hasValue())for(var g=this.attribute("style").value.split(";"),c=0;c<g.length;c++)if(""!=a.trim(g[c])){var k=g[c].split(":"),h=a.trim(k[0]),l=a.trim(k[1]);this.styles[h]=new a.Property(h,l)}this.attribute("id").hasValue()&&null==a.Definitions[this.attribute("id").value]&&(a.Definitions[this.attribute("id").value]=this)}},a.Element.RenderedElementBase=function(b){this.base=a.Element.ElementBase,this.base(b),this.setContext=function(b){if(this.style("fill").isUrlDefinition()){var c=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=c&&(b.fillStyle=c)}else if(this.style("fill").hasValue()){var d=this.style("fill");"currentColor"==d.value&&(d.value=this.style("color").value),b.fillStyle="none"==d.value?"rgba(0,0,0,0)":d.value}if(this.style("fill-opacity").hasValue()){var d=new a.Property("fill",b.fillStyle);d=d.addOpacity(this.style("fill-opacity").value),b.fillStyle=d.value}if(this.style("stroke").isUrlDefinition()){var c=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));null!=c&&(b.strokeStyle=c)}else if(this.style("stroke").hasValue()){var e=this.style("stroke");"currentColor"==e.value&&(e.value=this.style("color").value),b.strokeStyle="none"==e.value?"rgba(0,0,0,0)":e.value}if(this.style("stroke-opacity").hasValue()){var e=new a.Property("stroke",b.strokeStyle);e=e.addOpacity(this.style("stroke-opacity").value),b.strokeStyle=e.value}if(this.style("stroke-width").hasValue()){var f=this.style("stroke-width").toPixels();b.lineWidth=0==f?.001:f}if(this.style("stroke-linecap").hasValue()&&(b.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(b.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(b.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()){var g=a.ToNumberArray(this.style("stroke-dasharray").value);"undefined"!=typeof b.setLineDash?b.setLineDash(g):"undefined"!=typeof b.webkitLineDash?b.webkitLineDash=g:"undefined"!=typeof b.mozDash&&(b.mozDash=g);var h=this.style("stroke-dashoffset").numValueOrDefault(1);"undefined"!=typeof b.lineDashOffset?b.lineDashOffset=h:"undefined"!=typeof b.webkitLineDashOffset?b.webkitLineDashOffset=h:"undefined"!=typeof b.mozDashOffset&&(b.mozDashOffset=h)}if("undefined"!=typeof b.font&&(b.font=a.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.attribute("transform").hasValue()){var i=new a.Transform(this.attribute("transform").value);i.apply(b)}if(this.attribute("clip-path").hasValue()){var j=this.attribute("clip-path").getDefinition();null!=j&&j.apply(b)}this.style("opacity").hasValue()&&(b.globalAlpha=this.style("opacity").numValue())}},a.Element.RenderedElementBase.prototype=new a.Element.ElementBase,a.Element.PathElementBase=function(b){this.base=a.Element.RenderedElementBase,this.base(b),this.path=function(b){return null!=b&&b.beginPath(),new a.BoundingBox},this.renderChildren=function(b){this.path(b),a.Mouse.checkPath(this,b),""!=b.fillStyle&&(this.attribute("fill-rule").hasValue()?b.fill(this.attribute("fill-rule").value):b.fill()),""!=b.strokeStyle&&b.stroke();var c=this.getMarkers();if(null!=c){if(this.style("marker-start").isUrlDefinition()){var d=this.style("marker-start").getDefinition();d.render(b,c[0][0],c[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var d=this.style("marker-mid").getDefinition(),e=1;e<c.length-1;e++)d.render(b,c[e][0],c[e][1]);if(this.style("marker-end").isUrlDefinition()){var d=this.style("marker-end").getDefinition();d.render(b,c[c.length-1][0],c[c.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},a.Element.PathElementBase.prototype=new a.Element.RenderedElementBase,a.Element.svg=function(b){this.base=a.Element.RenderedElementBase,this.base(b),this.baseClearContext=this.clearContext,this.clearContext=function(b){this.baseClearContext(b),a.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(b){b.strokeStyle="rgba(0,0,0,0)",b.lineCap="butt",b.lineJoin="miter",b.miterLimit=4,this.baseSetContext(b),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),b.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var c=a.ViewPort.width(),d=a.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),"undefined"==typeof this.root){c=this.attribute("width").toPixels("x"),d=this.attribute("height").toPixels("y");var e=0,f=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(e=-this.attribute("refX").toPixels("x"),f=-this.attribute("refY").toPixels("y")),b.beginPath(),b.moveTo(e,f),b.lineTo(c,f),b.lineTo(c,d),b.lineTo(e,d),b.closePath(),b.clip()}if(a.ViewPort.SetCurrent(c,d),this.attribute("viewBox").hasValue()){var g=a.ToNumberArray(this.attribute("viewBox").value),h=g[0],i=g[1];c=g[2],d=g[3],a.AspectRatio(b,this.attribute("preserveAspectRatio").value,a.ViewPort.width(),c,a.ViewPort.height(),d,h,i,this.attribute("refX").value,this.attribute("refY").value),a.ViewPort.RemoveCurrent(),a.ViewPort.SetCurrent(g[2],g[3])}}},a.Element.svg.prototype=new a.Element.RenderedElementBase,a.Element.rect=function(b){this.base=a.Element.PathElementBase,this.base(b),this.path=function(b){var c=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),e=this.attribute("width").toPixels("x"),f=this.attribute("height").toPixels("y"),g=this.attribute("rx").toPixels("x"),h=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(h=g),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(g=h),g=Math.min(g,e/2),h=Math.min(h,f/2),null!=b&&(b.beginPath(),b.moveTo(c+g,d),b.lineTo(c+e-g,d),b.quadraticCurveTo(c+e,d,c+e,d+h),b.lineTo(c+e,d+f-h),b.quadraticCurveTo(c+e,d+f,c+e-g,d+f),b.lineTo(c+g,d+f),b.quadraticCurveTo(c,d+f,c,d+f-h),b.lineTo(c,d+h),b.quadraticCurveTo(c,d,c+g,d),b.closePath()),new a.BoundingBox(c,d,c+e,d+f)}},a.Element.rect.prototype=new a.Element.PathElementBase,a.Element.circle=function(b){this.base=a.Element.PathElementBase,this.base(b),this.path=function(b){var c=this.attribute("cx").toPixels("x"),d=this.attribute("cy").toPixels("y"),e=this.attribute("r").toPixels();return null!=b&&(b.beginPath(),b.arc(c,d,e,0,2*Math.PI,!0),b.closePath()),new a.BoundingBox(c-e,d-e,c+e,d+e)}},a.Element.circle.prototype=new a.Element.PathElementBase,a.Element.ellipse=function(b){this.base=a.Element.PathElementBase,this.base(b),this.path=function(b){var c=4*((Math.sqrt(2)-1)/3),d=this.attribute("rx").toPixels("x"),e=this.attribute("ry").toPixels("y"),f=this.attribute("cx").toPixels("x"),g=this.attribute("cy").toPixels("y");return null!=b&&(b.beginPath(),b.moveTo(f,g-e),b.bezierCurveTo(f+c*d,g-e,f+d,g-c*e,f+d,g),b.bezierCurveTo(f+d,g+c*e,f+c*d,g+e,f,g+e),b.bezierCurveTo(f-c*d,g+e,f-d,g+c*e,f-d,g),b.bezierCurveTo(f-d,g-c*e,f-c*d,g-e,f,g-e),b.closePath()),new a.BoundingBox(f-d,g-e,f+d,g+e)}},a.Element.ellipse.prototype=new a.Element.PathElementBase,a.Element.line=function(b){this.base=a.Element.PathElementBase,this.base(b),this.getPoints=function(){return[new a.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new a.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(b){var c=this.getPoints();return null!=b&&(b.beginPath(),b.moveTo(c[0].x,c[0].y),b.lineTo(c[1].x,c[1].y)),new a.BoundingBox(c[0].x,c[0].y,c[1].x,c[1].y)},this.getMarkers=function(){var a=this.getPoints(),b=a[0].angleTo(a[1]);return[[a[0],b],[a[1],b]]}},a.Element.line.prototype=new a.Element.PathElementBase,a.Element.polyline=function(b){this.base=a.Element.PathElementBase,this.base(b),this.points=a.CreatePath(this.attribute("points").value),this.path=function(b){var c=new a.BoundingBox(this.points[0].x,this.points[0].y);null!=b&&(b.beginPath(),b.moveTo(this.points[0].x,this.points[0].y));for(var d=1;d<this.points.length;d++)c.addPoint(this.points[d].x,this.points[d].y),null!=b&&b.lineTo(this.points[d].x,this.points[d].y);return c},this.getMarkers=function(){for(var a=[],b=0;b<this.points.length-1;b++)a.push([this.points[b],this.points[b].angleTo(this.points[b+1])]);return a.push([this.points[this.points.length-1],a[a.length-1][1]]),a}},a.Element.polyline.prototype=new a.Element.PathElementBase,a.Element.polygon=function(b){this.base=a.Element.polyline,this.base(b),this.basePath=this.path,this.path=function(a){var b=this.basePath(a);return null!=a&&(a.lineTo(this.points[0].x,this.points[0].y),a.closePath()),b}},a.Element.polygon.prototype=new a.Element.polyline,a.Element.path=function(b){this.base=a.Element.PathElementBase,this.base(b);var c=this.attribute("d").value;c=c.replace(/,/gm," "),c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2"),c=c.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),c=c.replace(/([0-9])([+\-])/gm,"$1 $2"),c=c.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),c=c.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),c=a.compressSpaces(c),c=a.trim(c),this.PathParser=new function(b){this.tokens=b.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new a.Point(0,0),this.control=new a.Point(0,0),this.current=new a.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var b=new a.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(b)},this.getAsControlPoint=function(){var a=this.getPoint();return this.control=a,a},this.getAsCurrentPoint=function(){var a=this.getPoint();return this.current=a,a},this.getReflectedControlPoint=function(){if("c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase())return this.current;var b=new a.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return b},this.makeAbsolute=function(a){return this.isRelativeCommand()&&(a.x+=this.current.x,a.y+=this.current.y),a},this.addMarker=function(a,b,c){null!=c&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(c)),this.addMarkerAngle(a,null==b?null:b.angleTo(a))},this.addMarkerAngle=function(a,b){this.points.push(a),this.angles.push(b)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var a=0;a<this.angles.length;a++)if(null==this.angles[a])for(var b=a+1;b<this.angles.length;b++)if(null!=this.angles[b]){this.angles[a]=this.angles[b];break}return this.angles}}(c),this.path=function(b){var c=this.PathParser;c.reset();var d=new a.BoundingBox;for(null!=b&&b.beginPath();!c.isEnd();)switch(c.nextCommand(),c.command){case"M":case"m":var e=c.getAsCurrentPoint();for(c.addMarker(e),d.addPoint(e.x,e.y),null!=b&&b.moveTo(e.x,e.y),c.start=c.current;!c.isCommandOrEnd();){var e=c.getAsCurrentPoint();c.addMarker(e,c.start),d.addPoint(e.x,e.y),null!=b&&b.lineTo(e.x,e.y)}break;case"L":case"l":for(;!c.isCommandOrEnd();){var f=c.current,e=c.getAsCurrentPoint();c.addMarker(e,f),d.addPoint(e.x,e.y),null!=b&&b.lineTo(e.x,e.y)}break;case"H":case"h":for(;!c.isCommandOrEnd();){var g=new a.Point((c.isRelativeCommand()?c.current.x:0)+c.getScalar(),c.current.y);c.addMarker(g,c.current),c.current=g,d.addPoint(c.current.x,c.current.y),null!=b&&b.lineTo(c.current.x,c.current.y)}break;case"V":case"v":for(;!c.isCommandOrEnd();){var g=new a.Point(c.current.x,(c.isRelativeCommand()?c.current.y:0)+c.getScalar());c.addMarker(g,c.current),c.current=g,d.addPoint(c.current.x,c.current.y),null!=b&&b.lineTo(c.current.x,c.current.y)}break;case"C":case"c":for(;!c.isCommandOrEnd();){var h=c.current,i=c.getPoint(),j=c.getAsControlPoint(),k=c.getAsCurrentPoint();c.addMarker(k,j,i),d.addBezierCurve(h.x,h.y,i.x,i.y,j.x,j.y,k.x,k.y),null!=b&&b.bezierCurveTo(i.x,i.y,j.x,j.y,k.x,k.y)}break;case"S":case"s":for(;!c.isCommandOrEnd();){var h=c.current,i=c.getReflectedControlPoint(),j=c.getAsControlPoint(),k=c.getAsCurrentPoint();c.addMarker(k,j,i),d.addBezierCurve(h.x,h.y,i.x,i.y,j.x,j.y,k.x,k.y),null!=b&&b.bezierCurveTo(i.x,i.y,j.x,j.y,k.x,k.y)}break;case"Q":case"q":for(;!c.isCommandOrEnd();){var h=c.current,j=c.getAsControlPoint(),k=c.getAsCurrentPoint();c.addMarker(k,j,j),d.addQuadraticCurve(h.x,h.y,j.x,j.y,k.x,k.y),null!=b&&b.quadraticCurveTo(j.x,j.y,k.x,k.y)}break;case"T":case"t":for(;!c.isCommandOrEnd();){var h=c.current,j=c.getReflectedControlPoint();c.control=j;var k=c.getAsCurrentPoint();c.addMarker(k,j,j),d.addQuadraticCurve(h.x,h.y,j.x,j.y,k.x,k.y),null!=b&&b.quadraticCurveTo(j.x,j.y,k.x,k.y)}break;case"A":case"a":for(;!c.isCommandOrEnd();){var h=c.current,l=c.getScalar(),m=c.getScalar(),n=c.getScalar()*(Math.PI/180),o=c.getScalar(),p=c.getScalar(),k=c.getAsCurrentPoint(),q=new a.Point(Math.cos(n)*(h.x-k.x)/2+Math.sin(n)*(h.y-k.y)/2,-Math.sin(n)*(h.x-k.x)/2+Math.cos(n)*(h.y-k.y)/2),r=Math.pow(q.x,2)/Math.pow(l,2)+Math.pow(q.y,2)/Math.pow(m,2);r>1&&(l*=Math.sqrt(r),m*=Math.sqrt(r));var s=(o==p?-1:1)*Math.sqrt((Math.pow(l,2)*Math.pow(m,2)-Math.pow(l,2)*Math.pow(q.y,2)-Math.pow(m,2)*Math.pow(q.x,2))/(Math.pow(l,2)*Math.pow(q.y,2)+Math.pow(m,2)*Math.pow(q.x,2)));isNaN(s)&&(s=0);var t=new a.Point(s*l*q.y/m,s*-m*q.x/l),u=new a.Point((h.x+k.x)/2+Math.cos(n)*t.x-Math.sin(n)*t.y,(h.y+k.y)/2+Math.sin(n)*t.x+Math.cos(n)*t.y),v=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))},w=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(v(a)*v(b))},x=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(w(a,b))},y=x([1,0],[(q.x-t.x)/l,(q.y-t.y)/m]),z=[(q.x-t.x)/l,(q.y-t.y)/m],A=[(-q.x-t.x)/l,(-q.y-t.y)/m],B=x(z,A);w(z,A)<=-1&&(B=Math.PI),w(z,A)>=1&&(B=0);var C=1-p?1:-1,D=y+C*(B/2),E=new a.Point(u.x+l*Math.cos(D),u.y+m*Math.sin(D));if(c.addMarkerAngle(E,D-C*Math.PI/2),c.addMarkerAngle(k,D-C*Math.PI),d.addPoint(k.x,k.y),null!=b){var w=l>m?l:m,F=l>m?1:l/m,G=l>m?m/l:1;b.translate(u.x,u.y),b.rotate(n),b.scale(F,G),b.arc(0,0,w,y,y+B,1-p),b.scale(1/F,1/G),b.rotate(-n),b.translate(-u.x,-u.y)}}break;case"Z":case"z":null!=b&&b.closePath(),c.current=c.start}return d},this.getMarkers=function(){for(var a=this.PathParser.getMarkerPoints(),b=this.PathParser.getMarkerAngles(),c=[],d=0;d<a.length;d++)c.push([a[d],b[d]]);return c}},a.Element.path.prototype=new a.Element.PathElementBase,a.Element.pattern=function(b){this.base=a.Element.ElementBase,this.base(b),this.createPattern=function(b){var c=this.attribute("width").toPixels("x",!0),d=this.attribute("height").toPixels("y",!0),e=new a.Element.svg;e.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value),e.attributes.width=new a.Property("width",c+"px"),e.attributes.height=new a.Property("height",d+"px"),e.attributes.transform=new a.Property("transform",this.attribute("patternTransform").value),e.children=this.children;var f=document.createElement("canvas");f.width=c,f.height=d;var g=f.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&g.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var h=-1;1>=h;h++)for(var i=-1;1>=i;i++)g.save(),g.translate(h*f.width,i*f.height),e.render(g),g.restore();var j=b.createPattern(f,"repeat");return j}},a.Element.pattern.prototype=new a.Element.ElementBase,a.Element.marker=function(b){this.base=a.Element.ElementBase,this.base(b),this.baseRender=this.render,this.render=function(b,c,d){b.translate(c.x,c.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&b.rotate(d),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&b.scale(b.lineWidth,b.lineWidth),b.save();var e=new a.Element.svg;e.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value),e.attributes.refX=new a.Property("refX",this.attribute("refX").value),e.attributes.refY=new a.Property("refY",this.attribute("refY").value),e.attributes.width=new a.Property("width",this.attribute("markerWidth").value),e.attributes.height=new a.Property("height",this.attribute("markerHeight").value),e.attributes.fill=new a.Property("fill",this.attribute("fill").valueOrDefault("black")),e.attributes.stroke=new a.Property("stroke",this.attribute("stroke").valueOrDefault("none")),e.children=this.children,e.render(b),b.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&b.scale(1/b.lineWidth,1/b.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&b.rotate(-d),b.translate(-c.x,-c.y)}},a.Element.marker.prototype=new a.Element.ElementBase,a.Element.defs=function(b){this.base=a.Element.ElementBase,this.base(b),this.render=function(){}},a.Element.defs.prototype=new a.Element.ElementBase,a.Element.GradientBase=function(b){this.base=a.Element.ElementBase,this.base(b),this.gradientUnits=this.attribute("gradientUnits").valueOrDefault("objectBoundingBox"),this.stops=[];for(var c=0;c<this.children.length;c++){var d=this.children[c];"stop"==d.type&&this.stops.push(d)}this.getGradient=function(){},this.createGradient=function(b,c,d){var e=this;this.getHrefAttribute().hasValue()&&(e=this.getHrefAttribute().getDefinition());var f=function(b){if(d.hasValue()){var c=new a.Property("color",b);return c.addOpacity(d.value).value}return b},g=this.getGradient(b,c);if(null==g)return f(e.stops[e.stops.length-1].color);for(var h=0;h<e.stops.length;h++)g.addColorStop(e.stops[h].offset,f(e.stops[h].color));if(this.attribute("gradientTransform").hasValue()){var i=a.ViewPort.viewPorts[0],j=new a.Element.rect;j.attributes.x=new a.Property("x",-a.MAX_VIRTUAL_PIXELS/3),j.attributes.y=new a.Property("y",-a.MAX_VIRTUAL_PIXELS/3),j.attributes.width=new a.Property("width",a.MAX_VIRTUAL_PIXELS),j.attributes.height=new a.Property("height",a.MAX_VIRTUAL_PIXELS);var k=new a.Element.g;k.attributes.transform=new a.Property("transform",this.attribute("gradientTransform").value),k.children=[j];var l=new a.Element.svg;l.attributes.x=new a.Property("x",0),l.attributes.y=new a.Property("y",0),l.attributes.width=new a.Property("width",i.width),l.attributes.height=new a.Property("height",i.height),l.children=[k];var m=document.createElement("canvas");m.width=i.width,m.height=i.height;var n=m.getContext("2d");return n.fillStyle=g,l.render(n),n.createPattern(m,"no-repeat")}return g}},a.Element.GradientBase.prototype=new a.Element.ElementBase,a.Element.linearGradient=function(b){this.base=a.Element.GradientBase,this.base(b),this.getGradient=function(a,b){var c=b.getBoundingBox();this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var d="objectBoundingBox"==this.gradientUnits?c.x()+c.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),e="objectBoundingBox"==this.gradientUnits?c.y()+c.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),f="objectBoundingBox"==this.gradientUnits?c.x()+c.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),g="objectBoundingBox"==this.gradientUnits?c.y()+c.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return d==f&&e==g?null:a.createLinearGradient(d,e,f,g)}},a.Element.linearGradient.prototype=new a.Element.GradientBase,a.Element.radialGradient=function(b){this.base=a.Element.GradientBase,this.base(b),this.getGradient=function(a,b){var c=b.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var d="objectBoundingBox"==this.gradientUnits?c.x()+c.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),e="objectBoundingBox"==this.gradientUnits?c.y()+c.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),f=d,g=e;this.attribute("fx").hasValue()&&(f="objectBoundingBox"==this.gradientUnits?c.x()+c.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(g="objectBoundingBox"==this.gradientUnits?c.y()+c.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var h="objectBoundingBox"==this.gradientUnits?(c.width()+c.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return a.createRadialGradient(f,g,0,d,e,h)}},a.Element.radialGradient.prototype=new a.Element.GradientBase,a.Element.stop=function(b){this.base=a.Element.ElementBase,this.base(b),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var c=this.style("stop-color");this.style("stop-opacity").hasValue()&&(c=c.addOpacity(this.style("stop-opacity").value)),this.color=c.value},a.Element.stop.prototype=new a.Element.ElementBase,a.Element.AnimateBase=function(b){this.base=a.Element.ElementBase,this.base(b),a.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var a=this.attribute("attributeType").value,b=this.attribute("attributeName").value;return"CSS"==a?this.parent.style(b,!0):this.parent.attribute(b,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(a){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"!=this.attribute("repeatCount").value&&"indefinite"!=this.attribute("repeatDur").value)return"remove"!=this.attribute("fill").valueOrDefault("remove")||this.removed?!1:(this.removed=!0,this.getProperty().value=this.initialValue,!0);this.duration=0}this.duration=this.duration+a;var b=!1;if(this.begin<this.duration){var c=this.calcValue();if(this.attribute("type").hasValue()){var d=this.attribute("type").value;c=d+"("+c+")"}this.getProperty().value=c,b=!0}return b},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var b={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var c=b.progress*(this.values.value.length-1),d=Math.floor(c),e=Math.ceil(c);b.from=new a.Property("from",parseFloat(this.values.value[d])),b.to=new a.Property("to",parseFloat(this.values.value[e])),b.progress=(c-d)/(e-d)}else b.from=this.from,b.to=this.to;return b}},a.Element.AnimateBase.prototype=new a.Element.ElementBase,a.Element.animate=function(b){this.base=a.Element.AnimateBase,this.base(b),this.calcValue=function(){var a=this.progress(),b=a.from.numValue()+(a.to.numValue()-a.from.numValue())*a.progress;return b+this.initialUnits}},a.Element.animate.prototype=new a.Element.AnimateBase,a.Element.animateColor=function(b){this.base=a.Element.AnimateBase,this.base(b),this.calcValue=function(){var a=this.progress(),b=new RGBColor(a.from.value),c=new RGBColor(a.to.value);if(b.ok&&c.ok){var d=b.r+(c.r-b.r)*a.progress,e=b.g+(c.g-b.g)*a.progress,f=b.b+(c.b-b.b)*a.progress;return"rgb("+parseInt(d,10)+","+parseInt(e,10)+","+parseInt(f,10)+")"}return this.attribute("from").value}},a.Element.animateColor.prototype=new a.Element.AnimateBase,a.Element.animateTransform=function(b){this.base=a.Element.AnimateBase,this.base(b),this.calcValue=function(){for(var b=this.progress(),c=a.ToNumberArray(b.from.value),d=a.ToNumberArray(b.to.value),e="",f=0;f<c.length;f++)e+=c[f]+(d[f]-c[f])*b.progress+" ";return e}},a.Element.animateTransform.prototype=new a.Element.animate,a.Element.font=function(b){this.base=a.Element.ElementBase,this.base(b),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var c=0;c<this.children.length;c++){var d=this.children[c];"font-face"==d.type?(this.fontFace=d,d.style("font-family").hasValue()&&(a.Definitions[d.style("font-family").value]=this)):"missing-glyph"==d.type?this.missingGlyph=d:"glyph"==d.type&&(""!=d.arabicForm?(this.isRTL=!0,this.isArabic=!0,"undefined"==typeof this.glyphs[d.unicode]&&(this.glyphs[d.unicode]=[]),this.glyphs[d.unicode][d.arabicForm]=d):this.glyphs[d.unicode]=d)}},a.Element.font.prototype=new a.Element.ElementBase,a.Element.fontface=function(b){this.base=a.Element.ElementBase,this.base(b),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},a.Element.fontface.prototype=new a.Element.ElementBase,a.Element.missingglyph=function(b){this.base=a.Element.path,this.base(b),this.horizAdvX=0},a.Element.missingglyph.prototype=new a.Element.path,a.Element.glyph=function(b){this.base=a.Element.path,this.base(b),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},a.Element.glyph.prototype=new a.Element.path,a.Element.text=function(b){this.captureTextNodes=!0,this.base=a.Element.RenderedElementBase,this.base(b),this.baseSetContext=this.setContext,this.setContext=function(a){this.baseSetContext(a),this.style("dominant-baseline").hasValue()&&(a.textBaseline=this.style("dominant-baseline").value),this.style("alignment-baseline").hasValue()&&(a.textBaseline=this.style("alignment-baseline").value)},this.getBoundingBox=function(){return new a.BoundingBox(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"),0,0)},this.renderChildren=function(a){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.x+=this.getAnchorDelta(a,this,0);for(var b=0;b<this.children.length;b++)this.renderChild(a,this,b)};var c=this.style("text-anchor").valueOrDefault("start");this.getAnchorDelta=function(a,b,d){if("start"!=c){for(var e=0,f=d;f<b.children.length;f++){var g=b.children[f];if(f>d&&g.attribute("x").hasValue())break;e+=g.measureTextRecursive(a)}return-1*("end"==c?e:e/2)}return 0},this.renderChild=function(a,b,c){var d=b.children[c];d.attribute("x").hasValue()?d.x=d.attribute("x").toPixels("x")+this.getAnchorDelta(a,b,c):(this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),d.attribute("dx").hasValue()&&(this.x+=d.attribute("dx").toPixels("x")),d.x=this.x),this.x=d.x+d.measureText(a),d.attribute("y").hasValue()?d.y=d.attribute("y").toPixels("y"):(this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),d.attribute("dy").hasValue()&&(this.y+=d.attribute("dy").toPixels("y")),d.y=this.y),this.y=d.y,d.render(a);for(var c=0;c<d.children.length;c++)this.renderChild(a,d,c)}},a.Element.text.prototype=new a.Element.RenderedElementBase,a.Element.TextElementBase=function(b){this.base=a.Element.RenderedElementBase,this.base(b),this.getGlyph=function(a,b,c){var d=b[c],e=null;if(a.isArabic){var f="isolated";(0==c||" "==b[c-1])&&c<b.length-2&&" "!=b[c+1]&&(f="terminal"),c>0&&" "!=b[c-1]&&c<b.length-2&&" "!=b[c+1]&&(f="medial"),c>0&&" "!=b[c-1]&&(c==b.length-1||" "==b[c+1])&&(f="initial"),"undefined"!=typeof a.glyphs[d]&&(e=a.glyphs[d][f],null==e&&"glyph"==a.glyphs[d].type&&(e=a.glyphs[d]))}else e=a.glyphs[d];return null==e&&(e=a.missingGlyph),e
},this.renderChildren=function(b){var c=this.parent.style("font-family").getDefinition();if(null==c)""!=b.fillStyle&&b.fillText(a.compressSpaces(this.getText()),this.x,this.y),""!=b.strokeStyle&&b.strokeText(a.compressSpaces(this.getText()),this.x,this.y);else{var d=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize),e=this.parent.style("font-style").valueOrDefault(a.Font.Parse(a.ctx.font).fontStyle),f=this.getText();c.isRTL&&(f=f.split("").reverse().join(""));for(var g=a.ToNumberArray(this.parent.attribute("dx").value),h=0;h<f.length;h++){var i=this.getGlyph(c,f,h),j=d/c.fontFace.unitsPerEm;b.translate(this.x,this.y),b.scale(j,-j);var k=b.lineWidth;b.lineWidth=b.lineWidth*c.fontFace.unitsPerEm/d,"italic"==e&&b.transform(1,0,.4,1,0,0),i.render(b),"italic"==e&&b.transform(1,0,-.4,1,0,0),b.lineWidth=k,b.scale(1/j,-1/j),b.translate(-this.x,-this.y),this.x+=d*(i.horizAdvX||c.horizAdvX)/c.fontFace.unitsPerEm,"undefined"==typeof g[h]||isNaN(g[h])||(this.x+=g[h])}}},this.getText=function(){},this.measureTextRecursive=function(a){for(var b=this.measureText(a),c=0;c<this.children.length;c++)b+=this.children[c].measureTextRecursive(a);return b},this.measureText=function(b){var c=this.parent.style("font-family").getDefinition();if(null!=c){var d=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize),e=0,f=this.getText();c.isRTL&&(f=f.split("").reverse().join(""));for(var g=a.ToNumberArray(this.parent.attribute("dx").value),h=0;h<f.length;h++){var i=this.getGlyph(c,f,h);e+=(i.horizAdvX||c.horizAdvX)*d/c.fontFace.unitsPerEm,"undefined"==typeof g[h]||isNaN(g[h])||(e+=g[h])}return e}var j=a.compressSpaces(this.getText());if(!b.measureText)return 10*j.length;b.save(),this.setContext(b);var k=b.measureText(j).width;return b.restore(),k}},a.Element.TextElementBase.prototype=new a.Element.RenderedElementBase,a.Element.tspan=function(b){this.captureTextNodes=!0,this.base=a.Element.TextElementBase,this.base(b),this.text=b.nodeValue||b.text||"",this.getText=function(){return this.text}},a.Element.tspan.prototype=new a.Element.TextElementBase,a.Element.tref=function(b){this.base=a.Element.TextElementBase,this.base(b),this.getText=function(){var a=this.getHrefAttribute().getDefinition();return null!=a?a.children[0].getText():void 0}},a.Element.tref.prototype=new a.Element.TextElementBase,a.Element.a=function(b){this.base=a.Element.TextElementBase,this.base(b),this.hasText=!0;for(var c=0;c<b.childNodes.length;c++)3!=b.childNodes[c].nodeType&&(this.hasText=!1);this.text=this.hasText?b.childNodes[0].nodeValue:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(b){if(this.hasText){this.baseRenderChildren(b);var c=new a.Property("fontSize",a.Font.Parse(a.ctx.font).fontSize);a.Mouse.checkBoundingBox(this,new a.BoundingBox(this.x,this.y-c.toPixels("y"),this.x+this.measureText(b),this.y))}else{var d=new a.Element.g;d.children=this.children,d.parent=this,d.render(b)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){a.ctx.canvas.style.cursor="pointer"}},a.Element.a.prototype=new a.Element.TextElementBase,a.Element.image=function(b){this.base=a.Element.RenderedElementBase,this.base(b);var c=this.getHrefAttribute().value,d=c.match(/\.svg$/);if(a.Images.push(this),this.loaded=!1,d)this.img=a.ajax(c),this.loaded=!0;else{this.img=document.createElement("img");var e=this;this.img.onload=function(){e.loaded=!0},this.img.onerror=function(){"undefined"!=typeof console&&(console.log('ERROR: image "'+c+'" not found'),e.loaded=!0)},this.img.src=c}this.renderChildren=function(b){var c=this.attribute("x").toPixels("x"),e=this.attribute("y").toPixels("y"),f=this.attribute("width").toPixels("x"),g=this.attribute("height").toPixels("y");0!=f&&0!=g&&(b.save(),d?b.drawSvg(this.img,c,e,f,g):(b.translate(c,e),a.AspectRatio(b,this.attribute("preserveAspectRatio").value,f,this.img.width,g,this.img.height,0,0),b.drawImage(this.img,0,0)),b.restore())},this.getBoundingBox=function(){var b=this.attribute("x").toPixels("x"),c=this.attribute("y").toPixels("y"),d=this.attribute("width").toPixels("x"),e=this.attribute("height").toPixels("y");return new a.BoundingBox(b,c,b+d,c+e)}},a.Element.image.prototype=new a.Element.RenderedElementBase,a.Element.g=function(b){this.base=a.Element.RenderedElementBase,this.base(b),this.getBoundingBox=function(){for(var b=new a.BoundingBox,c=0;c<this.children.length;c++)b.addBoundingBox(this.children[c].getBoundingBox());return b}},a.Element.g.prototype=new a.Element.RenderedElementBase,a.Element.symbol=function(b){this.base=a.Element.RenderedElementBase,this.base(b),this.baseSetContext=this.setContext,this.setContext=function(b){if(this.baseSetContext(b),this.attribute("viewBox").hasValue()){var c=a.ToNumberArray(this.attribute("viewBox").value),d=c[0],e=c[1];width=c[2],height=c[3],a.AspectRatio(b,this.attribute("preserveAspectRatio").value,this.attribute("width").toPixels("x"),width,this.attribute("height").toPixels("y"),height,d,e),a.ViewPort.SetCurrent(c[2],c[3])}}},a.Element.symbol.prototype=new a.Element.RenderedElementBase,a.Element.style=function(b){this.base=a.Element.ElementBase,this.base(b);for(var c="",d=0;d<b.childNodes.length;d++)c+=b.childNodes[d].nodeValue;c=c.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),c=a.compressSpaces(c);for(var e=c.split("}"),d=0;d<e.length;d++)if(""!=a.trim(e[d]))for(var f=e[d].split("{"),g=f[0].split(","),h=f[1].split(";"),i=0;i<g.length;i++){var j=a.trim(g[i]);if(""!=j){for(var k={},l=0;l<h.length;l++){var m=h[l].indexOf(":"),n=h[l].substr(0,m),o=h[l].substr(m+1,h[l].length-m);null!=n&&null!=o&&(k[a.trim(n)]=new a.Property(a.trim(n),a.trim(o)))}if(a.Styles[j]=k,"@font-face"==j)for(var p=k["font-family"].value.replace(/"/g,""),q=k.src.value.split(","),r=0;r<q.length;r++)if(q[r].indexOf('format("svg")')>0)for(var s=q[r].indexOf("url"),t=q[r].indexOf(")",s),u=q[r].substr(s+5,t-s-6),v=a.parseXml(a.ajax(u)),w=v.getElementsByTagName("font"),x=0;x<w.length;x++){var y=a.CreateElement(w[x]);a.Definitions[p]=y}}}},a.Element.style.prototype=new a.Element.ElementBase,a.Element.use=function(b){this.base=a.Element.RenderedElementBase,this.base(b),this.baseSetContext=this.setContext,this.setContext=function(a){this.baseSetContext(a),this.attribute("x").hasValue()&&a.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&a.translate(0,this.attribute("y").toPixels("y"))},this.getDefinition=function(){var a=this.getHrefAttribute().getDefinition();return this.attribute("width").hasValue()&&(a.attribute("width",!0).value=this.attribute("width").value),this.attribute("height").hasValue()&&(a.attribute("height",!0).value=this.attribute("height").value),a},this.path=function(a){var b=this.getDefinition();null!=b&&b.path(a)},this.getBoundingBox=function(){var a=this.getDefinition();return null!=a?a.getBoundingBox():void 0},this.renderChildren=function(a){var b=this.getDefinition();if(null!=b){var c=b.parent;b.parent=null,b.render(a),b.parent=c}}},a.Element.use.prototype=new a.Element.RenderedElementBase,a.Element.mask=function(b){this.base=a.Element.ElementBase,this.base(b),this.apply=function(b,c){var d=this.attribute("x").toPixels("x"),e=this.attribute("y").toPixels("y"),f=this.attribute("width").toPixels("x"),g=this.attribute("height").toPixels("y");if(0==f&&0==g){for(var h=new a.BoundingBox,i=0;i<this.children.length;i++)h.addBoundingBox(this.children[i].getBoundingBox());var d=Math.floor(h.x1),e=Math.floor(h.y1),f=Math.floor(h.width()),g=Math.floor(h.height())}var j=c.attribute("mask").value;c.attribute("mask").value="";var k=document.createElement("canvas");k.width=d+f,k.height=e+g;var l=k.getContext("2d");this.renderChildren(l);var m=document.createElement("canvas");m.width=d+f,m.height=e+g;var n=m.getContext("2d");c.render(n),n.globalCompositeOperation="destination-in",n.fillStyle=l.createPattern(k,"no-repeat"),n.fillRect(0,0,d+f,e+g),b.fillStyle=n.createPattern(m,"no-repeat"),b.fillRect(0,0,d+f,e+g),c.attribute("mask").value=j},this.render=function(){}},a.Element.mask.prototype=new a.Element.ElementBase,a.Element.clipPath=function(b){this.base=a.Element.ElementBase,this.base(b),this.apply=function(b){for(var c=0;c<this.children.length;c++){var d=this.children[c];if("undefined"!=typeof d.path){var e=null;d.attribute("transform").hasValue()&&(e=new a.Transform(d.attribute("transform").value),e.apply(b)),d.path(b),b.clip(),e&&e.unapply(b)}}},this.render=function(){}},a.Element.clipPath.prototype=new a.Element.ElementBase,a.Element.filter=function(b){this.base=a.Element.ElementBase,this.base(b),this.apply=function(a,b){var c=b.getBoundingBox(),d=Math.floor(c.x1),e=Math.floor(c.y1),f=Math.floor(c.width()),g=Math.floor(c.height()),h=b.style("filter").value;b.style("filter").value="";for(var i=0,j=0,k=0;k<this.children.length;k++){var l=this.children[k].extraFilterDistance||0;i=Math.max(i,l),j=Math.max(j,l)}var m=document.createElement("canvas");m.width=f+2*i,m.height=g+2*j;var n=m.getContext("2d");n.translate(-d+i,-e+j),b.render(n);for(var k=0;k<this.children.length;k++)this.children[k].apply(n,0,0,f+2*i,g+2*j);a.drawImage(m,0,0,f+2*i,g+2*j,d-i,e-j,f+2*i,g+2*j),b.style("filter",!0).value=h},this.render=function(){}},a.Element.filter.prototype=new a.Element.ElementBase,a.Element.feMorphology=function(b){this.base=a.Element.ElementBase,this.base(b),this.apply=function(){}},a.Element.feMorphology.prototype=new a.Element.ElementBase,a.Element.feColorMatrix=function(b){function c(a,b,c,d,e,f){return a[4*c*d+4*b+f]}function d(a,b,c,d,e,f,g){a[4*c*d+4*b+f]=g}this.base=a.Element.ElementBase,this.base(b),this.apply=function(a,b,e,f,g){for(var h=a.getImageData(0,0,f,g),e=0;g>e;e++)for(var b=0;f>b;b++){var i=c(h.data,b,e,f,g,0),j=c(h.data,b,e,f,g,1),k=c(h.data,b,e,f,g,2),l=(i+j+k)/3;d(h.data,b,e,f,g,0,l),d(h.data,b,e,f,g,1,l),d(h.data,b,e,f,g,2,l)}a.clearRect(0,0,f,g),a.putImageData(h,0,0)}},a.Element.feColorMatrix.prototype=new a.Element.ElementBase,a.Element.feGaussianBlur=function(b){this.base=a.Element.ElementBase,this.base(b),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(b,c,d,e,f){return"undefined"==typeof stackBlurCanvasRGBA?("undefined"!=typeof console&&console.log("ERROR: StackBlur.js must be included for blur to work"),void 0):(b.canvas.id=a.UniqueId(),b.canvas.style.display="none",document.body.appendChild(b.canvas),stackBlurCanvasRGBA(b.canvas.id,c,d,e,f,this.blurRadius),document.body.removeChild(b.canvas),void 0)}},a.Element.feGaussianBlur.prototype=new a.Element.ElementBase,a.Element.title=function(){},a.Element.title.prototype=new a.Element.ElementBase,a.Element.desc=function(){},a.Element.desc.prototype=new a.Element.ElementBase,a.Element.MISSING=function(a){"undefined"!=typeof console&&console.log("ERROR: Element '"+a.nodeName+"' not yet implemented.")},a.Element.MISSING.prototype=new a.Element.ElementBase,a.CreateElement=function(b){var c=b.nodeName.replace(/^[^:]+:/,"");c=c.replace(/\-/g,"");var d=null;return d="undefined"!=typeof a.Element[c]?new a.Element[c](b):new a.Element.MISSING(b),d.type=b.nodeName,d},a.load=function(b,c){a.loadXml(b,a.ajax(c))},a.loadXml=function(b,c){a.loadXmlDoc(b,a.parseXml(c))},a.loadXmlDoc=function(b,c){a.init(b);var d=function(a){for(var c=b.canvas;c;)a.x-=c.offsetLeft,a.y-=c.offsetTop,c=c.offsetParent;return window.scrollX&&(a.x+=window.scrollX),window.scrollY&&(a.y+=window.scrollY),a};1!=a.opts.ignoreMouse&&(b.canvas.onclick=function(b){var c=d(new a.Point(null!=b?b.clientX:event.clientX,null!=b?b.clientY:event.clientY));a.Mouse.onclick(c.x,c.y)},b.canvas.onmousemove=function(b){var c=d(new a.Point(null!=b?b.clientX:event.clientX,null!=b?b.clientY:event.clientY));a.Mouse.onmousemove(c.x,c.y)});var e=a.CreateElement(c.documentElement);e.root=!0;var f=!0,g=function(){a.ViewPort.Clear(),b.canvas.parentNode&&a.ViewPort.SetCurrent(b.canvas.parentNode.clientWidth,b.canvas.parentNode.clientHeight),1!=a.opts.ignoreDimensions&&(e.style("width").hasValue()&&(b.canvas.width=e.style("width").toPixels("x"),b.canvas.style.width=b.canvas.width+"px"),e.style("height").hasValue()&&(b.canvas.height=e.style("height").toPixels("y"),b.canvas.style.height=b.canvas.height+"px"));var d=b.canvas.clientWidth||b.canvas.width,g=b.canvas.clientHeight||b.canvas.height;if(1==a.opts.ignoreDimensions&&e.style("width").hasValue()&&e.style("height").hasValue()&&(d=e.style("width").toPixels("x"),g=e.style("height").toPixels("y")),a.ViewPort.SetCurrent(d,g),null!=a.opts.offsetX&&(e.attribute("x",!0).value=a.opts.offsetX),null!=a.opts.offsetY&&(e.attribute("y",!0).value=a.opts.offsetY),null!=a.opts.scaleWidth&&null!=a.opts.scaleHeight){var h=1,i=1,j=a.ToNumberArray(e.attribute("viewBox").value);e.attribute("width").hasValue()?h=e.attribute("width").toPixels("x")/a.opts.scaleWidth:isNaN(j[2])||(h=j[2]/a.opts.scaleWidth),e.attribute("height").hasValue()?i=e.attribute("height").toPixels("y")/a.opts.scaleHeight:isNaN(j[3])||(i=j[3]/a.opts.scaleHeight),e.attribute("width",!0).value=a.opts.scaleWidth,e.attribute("height",!0).value=a.opts.scaleHeight,e.attribute("viewBox",!0).value="0 0 "+d*h+" "+g*i,e.attribute("preserveAspectRatio",!0).value="none"}1!=a.opts.ignoreClear&&b.clearRect(0,0,d,g),e.render(b),f&&(f=!1,"function"==typeof a.opts.renderCallback&&a.opts.renderCallback(c))},h=!0;a.ImagesLoaded()&&(h=!1,g()),a.intervalID=setInterval(function(){var b=!1;if(h&&a.ImagesLoaded()&&(h=!1,b=!0),1!=a.opts.ignoreMouse&&(b|=a.Mouse.hasEvents()),1!=a.opts.ignoreAnimation)for(var c=0;c<a.Animations.length;c++)b|=a.Animations[c].update(1e3/a.FRAMERATE);"function"==typeof a.opts.forceRedraw&&1==a.opts.forceRedraw()&&(b=!0),b&&(g(),a.Mouse.runEvents())},1e3/a.FRAMERATE)},a.stop=function(){a.intervalID&&clearInterval(a.intervalID)},a.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(a,b){this.events.push({type:"onclick",x:a,y:b,run:function(a){a.onclick&&a.onclick()}})},this.onmousemove=function(a,b){this.events.push({type:"onmousemove",x:a,y:b,run:function(a){a.onmousemove&&a.onmousemove()}})},this.eventElements=[],this.checkPath=function(a,b){for(var c=0;c<this.events.length;c++){var d=this.events[c];b.isPointInPath&&b.isPointInPath(d.x,d.y)&&(this.eventElements[c]=a)}},this.checkBoundingBox=function(a,b){for(var c=0;c<this.events.length;c++){var d=this.events[c];b.isPointInBox(d.x,d.y)&&(this.eventElements[c]=a)}},this.runEvents=function(){a.ctx.canvas.style.cursor="";for(var b=0;b<this.events.length;b++)for(var c=this.events[b],d=this.eventElements[b];d;)c.run(d),d=d.parent;this.events=[],this.eventElements=[]}},a}this.canvg=function(b,c,d){if(null!=b||null!=c||null!=d){d=d||{},"string"==typeof b&&(b=document.getElementById(b)),null!=b.svg&&b.svg.stop();var e=a();(1!=b.childNodes.length||"OBJECT"!=b.childNodes[0].nodeName)&&(b.svg=e),e.opts=d;var f=b.getContext("2d");"undefined"!=typeof c.documentElement?e.loadXmlDoc(f,c):"<"==c.substr(0,1)?e.loadXml(f,c):e.load(f,c)}else for(var g=document.getElementsByTagName("svg"),h=0;h<g.length;h++){var i=g[h],j=document.createElement("canvas");j.width=i.clientWidth,j.height=i.clientHeight,i.parentNode.insertBefore(j,i),i.parentNode.removeChild(i);var k=document.createElement("div");k.appendChild(i),canvg(j,k.innerHTML)}}}(),"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(a,b,c,d,e){canvg(this.canvas,a,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:b,offsetY:c,scaleWidth:d,scaleHeight:e})}),"function"!=typeof Blob||"undefined"==typeof URL)if("function"==typeof Blob&&"undefined"!=typeof webkitURL)var URL=webkitURL;else var Blob=function(a){"use strict";var b=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder||function(a){var b=function(a){return Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1]},c=function(){this.data=[]},d=function(a,b,c){this.data=a,this.size=a.length,this.type=b,this.encoding=c},e=c.prototype,f=d.prototype,g=a.FileReaderSync,h=function(a){this.code=this[this.name=a]},i="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),j=i.length,k=a.URL||a.webkitURL||a,l=k.createObjectURL,m=k.revokeObjectURL,n=k,o=a.btoa,p=a.atob,q=!1,r=function(a){q=!a},s=a.ArrayBuffer,t=a.Uint8Array;for(d.fake=f.fake=!0;j--;)h.prototype[i[j]]=j+1;try{t&&r.apply(0,new t(1))}catch(u){}return k.createObjectURL||(n=a.URL={}),n.createObjectURL=function(a){var b,c=a.type;return null===c&&(c="application/octet-stream"),a instanceof d?(b="data:"+c,"base64"===a.encoding?b+";base64,"+a.data:"URI"===a.encoding?b+","+decodeURIComponent(a.data):o?b+";base64,"+o(a.data):b+","+encodeURIComponent(a.data)):l?l.call(k,a):void 0},n.revokeObjectURL=function(a){"data:"!==a.substring(0,5)&&m&&m.call(k,a)},e.append=function(a){var c=this.data;if(t&&(a instanceof s||a instanceof t))if(q)c.push(String.fromCharCode.apply(String,new t(a)));else for(var e="",f=new t(a),i=0,j=f.length;j>i;i++)e+=String.fromCharCode(f[i]);else if("Blob"===b(a)||"File"===b(a)){if(!g)throw new h("NOT_READABLE_ERR");var k=new g;c.push(k.readAsBinaryString(a))}else a instanceof d?"base64"===a.encoding&&p?c.push(p(a.data)):"URI"===a.encoding?c.push(decodeURIComponent(a.data)):"raw"===a.encoding&&c.push(a.data):("string"!=typeof a&&(a+=""),c.push(unescape(encodeURIComponent(a))))},e.getBlob=function(a){return arguments.length||(a=null),new d(this.data.join(""),a,"raw")},e.toString=function(){return"[object BlobBuilder]"},f.slice=function(a,b,c){var e=arguments.length;return 3>e&&(c=null),new d(this.data.slice(a,e>1?b:this.data.length),c,this.encoding)},f.toString=function(){return"[object Blob]"},c}(a);return function(a,c){var d=c?c.type||"":"",e=new b;if(a)for(var f=0,g=a.length;g>f;f++)e.append(a[f]);return e.getBlob(d)}}(self);!function(a){"use strict";var b,c=a.Uint8Array,d=a.HTMLCanvasElement,e=/\s*;\s*base64\s*(?:;|$)/i,f=function(a){for(var d,e,f,g=a.length,h=new c(0|3*(g/4)),i=0,j=0,k=[0,0],l=0,m=0;g--;)e=a.charCodeAt(i++),d=b[e-43],255!==d&&d!==f&&(k[1]=k[0],k[0]=e,m=m<<6|d,l++,4===l&&(h[j++]=m>>>16,61!==k[1]&&(h[j++]=m>>>8),61!==k[0]&&(h[j++]=m),l=0));return h};c&&(b=new c([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),d&&!d.prototype.toBlob&&(d.prototype.toBlob=function(a,b){if(b||(b="image/png"),this.mozGetAsFile)return a(this.mozGetAsFile("canvas",b)),void 0;var d,g=Array.prototype.slice.call(arguments,1),h=this.toDataURL.apply(this,g),i=h.indexOf(","),j=h.substring(i+1),k=e.test(h.substring(0,i));Blob.fake?(d=new Blob,d.encoding=k?"base64":"URI",d.data=j,d.size=j.length):c&&(d=k?new Blob([f(j)],{type:b}):new Blob([decodeURIComponent(j)],{type:b})),a(d)})}(self),CMapPertTypeAlias=function(a){switch(a){case"trt_cp":return{name:"Small Molecule Compound",acronym:"SMC"};case"trt_sh":return{name:"Knock Down",acronym:"KD"};case"trt_oe":return{name:"Over Expression",acronym:"OE"};default:return{name:a,acronym:a}}},CellCountModel=Backbone.Model.extend({defaults:{pert_count:0,pert_types:[{}],last_update:(new Date).getTime()},initialize:function(){this.fetch("")},fetch:function(a,b){var c="http://api.lincscloud.org/a2/siginfo?callback=?",d="http://api.lincscloud.org/a2/pertinfo?callback=?",e="http://api.lincscloud.org/a2/cellinfo?callback=?";"multi"===b&&(a='["'+a.split(":").join('","')+'"]',pert_params={q:'{"pert_iname":{"$in":'+a+"}}",d:"cell_id"}),("single"===b||void 0===b)&&(pert_params={q:'{"pert_iname":{"$regex":"'+a+'","$options":"i"}}',d:"cell_id"}),"cell"===b&&(pert_params={q:'{"cell_id":"'+a+'"}',f:'{"cell_id":1}',l:1});var f,g=this,h=(new Date).getTime();"cell"===b?$.getJSON(c,pert_params,function(b){if(0===b)f=0,g.set({pert_count:f,pert_types:[{}],last_update:h});else{f=b.length,'["'+b.join('","')+'"]';var c={q:'{"cell_id":"'+a+'"}',g:"cell_type"};$.getJSON(e,c,function(a){g.set({pert_count:f,pert_types:a,last_update:h})})}}):$.getJSON(d,pert_params,function(a){if(0===a)f=0,g.set({pert_count:f,pert_types:[{}],last_update:h});else{f=a.length;var b='["'+a.join('","')+'"]',c={q:'{"cell_id":{"$in":'+b+"}}",g:"cell_type"};$.getJSON(e,c,function(a){g.set({pert_count:f,pert_types:a,last_update:h})})}})}}),PertCellBreakdownModel=Backbone.Model.extend({defaults:{filter:"",tree_object:{children:[]}},initialize:function(){this.fetch("")},fetch:function(a,b){var c="http://api.lincscloud.org/a2/pertinfo?callback=?",d={};"multi"===b&&(a='["'+a.split(":").join('","')+'"]',d={q:"{"+this.get("filter")+'"pert_iname":{"$in":'+a+"}}",g:"cell_id"}),("single"===b||void 0===b)&&(d={q:"{"+this.get("filter")+'"pert_iname":{"$regex":"'+a+'","$options":"i"}}',g:"cell_id"}),"cell"===b&&(d={q:"{"+this.get("filter")+'"pert_iname":{"$regex":""}}',g:"cell_id"});var e=this;$.getJSON(c,d,function(c){children=0===c?[]:c,"cell"===b&&(children=_.filter(children,function(b){return b._id==a}));var d=(new Date).getTime();e.set({tree_object:{name:"root",children:children},last_update:d})})}}),PertCountModel=Backbone.Model.extend({defaults:{type_string:'["trt_sh","trt_oe"]',pert_count:0,pert_types:[{}],last_update:(new Date).getTime()},initialize:function(){this.fetch("")},fetch:function(a,b){var c="http://api.lincscloud.org/a2/pertinfo?callback=?",d={};"multi"===b&&(a='["'+a.split(":").join('","')+'"]',d={q:'{"pert_type":{"$in":'+this.get("type_string")+'},"pert_iname":{"$in":'+a+"}}",c:!0}),("single"===b||void 0===b)&&(d={q:'{"pert_type":{"$in":'+this.get("type_string")+'},"pert_iname":{"$regex":"'+a+'","$options":"i"}}',c:!0}),"cell"===b&&(d={q:'{"pert_type":{"$in":'+this.get("type_string")+'},"pert_iname":{"$regex":"","$options":"i"},"cell_id":"'+a+'"}',c:!0});var e,f=this;$.getJSON(c,d,function(a){e=0===a?0:a.count;var b=(new Date).getTime();f.set({pert_count:e,pert_types:[{}],last_update:b})})}}),PertDetailModel=Backbone.Model.extend({defaults:{short_description:"",long_description:"",gene_wiki_link:""},initialize:function(){this.fetch("")},fetch:function(a){var b,c,d="http://api.lincscloud.org/a2/pertinfo?callback=?",e=e={q:'{"pert_iname":{"$regex":"'+a+'", "$options":"i"}}',l:1},f=this;$.getJSON(d,e,function(d){0==d||""==a?(b=void 0,c=void 0,f.trigger("PertDetailModel:ModelIsNull")):(b=d[0].pert_iname,void 0!==d[0].gene_title&&(c=d[0].gene_title,f.set({gene_wiki_link:"http://en.wikipedia.org/wiki/"+b+"_(gene)"})),void 0!==d[0].pubchem_cid&&(c="PubChem ID: "+d[0].pubchem_cid,f.set({gene_wiki_link:""})),f.trigger("PertDetailModel:ModelIsNotNull"));var e=(new Date).getTime();f.set({short_description:b,long_description:c,last_update:e}),f.set(d[0])})}}),PertModel=Backbone.Model.extend({initialize:function(){this.cid=this.get("pert_id");var a=this.get("pert_type");switch(a){case"trt_cp":this.set({pert_type_label:'<span class="label" style="background-color: #E69F00">SMC</span>'});break;case"trt_oe":this.set({pert_type_label:'<span class="label" style="background-color: #D55E00">OE</span>'});break;case"trt_sh":this.set({pert_type_label:'<span class="label" style="background-color: #56B4E9">KD</span>'});break;default:this.set({pert_type_label:'<span class="label">'+a+"</span>"})}}}),SummlyResultModel=Backbone.Model.extend({defaults:{query:"",target:"",summly_score:-666,summly_rank:-666,specificity:-666,cell_line_scores:{}},initialize:function(){this.cid=this.get("target");var a=this.get("pert_type");switch(a){case"trt_cp":this.set({pert_type_label:'<span class="label" style="background-color: #E69F00">SMC</span>'});break;case"trt_oe":this.set({pert_type_label:'<span class="label" style="background-color: #D55E00">OE</span>'});break;case"trt_sh":this.set({pert_type_label:'<span class="label" style="background-color: #56B4E9">KD</span>'});break;default:this.set({pert_type_label:'<span class="label">'+a+"</span>"})}}}),TickModel=Backbone.Model.extend({defaults:{title:"",data_object:{}}}),BubbleView=Backbone.View.extend({initialize:function(){this.fg_color=void 0!==this.options.fg_color?this.options.fg_color:"#1b9e77",this.span_class=void 0!==this.options.span_class?this.options.span_class:"span4",this.listenTo(this.model,"change",this.render),this.compile_template(),this.width=$("#"+this.div_string).outerWidth(),this.height=$("#"+this.div_string).outerHeight(),this.vis=d3.select("#"+this.div_string).append("svg").attr("width",this.width).attr("height",this.height),this.render();var a=this;$(window).resize(function(){a.render()})},compile_template:function(a){void 0===a&&(this.div_string="d3_target"+Math.round(1e6*Math.random()),a='<div id="'+this.div_string+'" class="'+this.span_class+'" style="height:300px"></div>');var b=Handlebars.compile(a);this.template_string=a,this.compiled_template=b,this.$el.append(b())},render:function(){function a(){b.nodes.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).attr("r",function(a){return b.data_scale(a.count)})}var b=this;this.width=$("#"+this.div_string).outerWidth(),this.height=$("#"+this.div_string).outerHeight(),this.vis.transition().duration(1).attr("width",this.width);var c=this.model.get("tree_object").children,d=_.min(_.pluck(c,"count")),e=_.max(_.pluck(c,"count"));this.data_scale=d3.scale.linear().domain([d,e]).range([5,30]);var f=d3.layout.force().nodes(c).size([this.width,this.height]).on("tick",a).charge(function(a){return-Math.pow(b.data_scale(a.count),1.4)}).start();this.vis.selectAll("circle").data(f.nodes()).exit().remove(),this.vis.selectAll("circle").data(f.nodes()).enter().append("circle").attr("class",this.div_string+"_circle").attr("fill",this.fg_color).attr("cx",300*Math.random()).attr("cy",300*Math.random()).attr("stroke","white").attr("r",function(a){return Math.sqrt(b.data_scale(a.count)/Math.PI)}),this.nodes=this.vis.selectAll("circle"),this.nodes.call(f.drag())}}),CMapFooterView=Backbone.View.extend({initialize:function(){this.organization=void 0!==this.options.organization?this.options.organization:"Broad Institute",this.terms_url=void 0!==this.options.terms_url?this.options.terms_url:"http://lincscloud.org/terms-and-conditions/",this.logo=void 0!==this.options.logo?this.options.logo:["http://coreyflynn.github.io/Bellhop/img/broad_logo_small.png","http://coreyflynn.github.io/Bellhop/img/cmap_logo_small.png"],this.logo_url=void 0!==this.options.logo_url?this.options.logo_url:["http://www.broadinstitute.org/","http://lincscloud.org/"],this.template=void 0!==this.options.template?this.options.template:"../templates/CMapFooter.handlebars",this.compile_template(),this.render()},compile_template:function(){var a=this;$.ajax({url:this.template,dataType:"html",success:function(b){a.compiled_template=Handlebars.compile(b);for(var c=[],d=0;d<a.logo.length;d++)c.push({logo:a.logo[d],url:a.logo_url[d]});a.$el.append(a.compiled_template({organization:a.organization,terms_url:a.terms_url,logo_objects:c,year:(new Date).getFullYear()}))}})}}),CMapHeaderView=Backbone.View.extend({initialize:function(){this.title=void 0!==this.options.title?this.options.title:"",this.subtitle=void 0!==this.options.subtitle?this.options.subtitle:"",this.template=void 0!==this.options.template?this.options.template:"",this.compile_template(),this.render()},compile_template:function(){var a=this;$.ajax({url:this.template,dataType:"html",success:function(b){a.compiled_template=Handlebars.compile(b),a.$el.append(a.compiled_template({title:a.title,subtitle:a.subtitle}))}})}}),FlatTreeMapView=Backbone.View.extend({initialize:function(){this.bg_color=void 0!==this.options.bg_color?this.options.bg_color:"#d9d9d9",this.well_color=void 0!==this.options.well_color?this.options.well_color:"#bdbdbd",this.fg_color=void 0!==this.options.fg_color?this.options.fg_color:"#1b9e77",this.span_class=void 0!==this.options.span_class?this.options.span_class:"span4",this.listenTo(this.model,"change",this.update_vis),this.compile_template(),this.width=$("#"+this.div_string).outerWidth(),this.height=$("#"+this.div_string).outerHeight(),this.top_svg=d3.select("#"+this.div_string).append("svg").attr("width",this.width).attr("height",this.height),this.vis=this.top_svg.append("g"),this.vis_overlay=this.top_svg.append("g"),this.render();var a=this;$(window).resize(function(){a.render()})},compile_template:function(a){void 0===a&&(this.div_string="d3_target"+Math.round(1e6*Math.random()),a='<div id="'+this.div_string+'" class="'+this.span_class+'" style="height:300px"></div>');var b=Handlebars.compile(a);this.template_string=a,this.compiled_template=b,this.$el.append(b())},render:function(){var a=this;this.width=$("#"+this.div_string).outerWidth(),this.height=$("#"+this.div_string).outerHeight(),this.top_svg.transition().duration(1).attr("width",this.width),this.treemap=d3.layout.treemap().size([this.width,this.height]).sticky(!1).round(!0).sort(function(a,b){return a.count-b.count}).value(function(a){return a.count}),this.data=this.model.get("tree_object"),void 0===this.data.children[0]?this.vis.transition().duration(1).attr("opacity",0):this.vis.transition().duration(500).attr("opacity",1),this.min_count=_.min(_.pluck(this.data.children,"count")),this.max_count=_.max(_.pluck(this.data.children,"count")),this.opacity_map=d3.scale.linear().domain([this.min_count,this.max_count,this.max_count+1]).range([.5,1,0]),this.vis.data([this.data]).selectAll("rect").data([]).exit().remove(),this.vis.data([this.data]).selectAll("rect").data(this.treemap.nodes).enter().append("rect").attr("class",this.div_string+"_cell").attr("fill",this.fg_color).attr("opacity",function(b){return a.opacity_map(b.value)}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("width",function(a){return a.dx}).attr("height",function(a){return a.dy}).attr("stroke","white").attr("stroke-width",2),this.draw_text(),this.vis_overlay.data([this.data]).selectAll("rect").data([]).exit().remove(),this.vis_overlay.data([this.data]).selectAll("rect").data(this.treemap.nodes).enter().append("rect").attr("class",this.div_string+"_cell").attr("fill",this.fg_color).attr("opacity",0).attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("width",function(a){return a.dx}).attr("height",function(a){return a.dy}).attr("count",function(a){return a.count}).attr("_id",function(a){return a._id}).on("mousemove",function(){a.fadeIn_popover(d3.mouse(this),d3.select(d3.event.target))}).on("mouseout",function(){a.fadeOut_popover()}),this.top_svg.selectAll("."+this.div_string+"tooltips").data([]).exit().remove(),this.popover=this.top_svg.append("foreignObject").attr("class",this.div_string+"tooltips").attr("x",0).attr("y",0).attr("opacity",0).attr("width",600).attr("height",100).append("xhtml:div").html('<span class="label '+this.div_string+'sig_id_label"></span>').append("xhtml:div").html('<span class="label label-inverse  '+this.div_string+'pert_desc_label"></span>'),this.top_svg.selectAll("."+this.div_string+"png_export").data([]).exit().remove(),this.top_svg.selectAll("."+this.div_string+"png_export").data([1]).enter().append("text").attr("class",this.div_string+"png_export").attr("x",10).attr("y",this.height-10).attr("opacity",.25).style("cursor","pointer").text("png").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1)}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25)}).on("click",function(){a.savePng()})},update_vis:function(){var a=this;this.data=this.model.get("tree_object"),void 0===this.data.children[0]?this.vis.transition().duration(1).attr("opacity",0):this.vis.transition().duration(500).attr("opacity",1),this.min_count=_.min(_.pluck(this.data.children,"count")),this.max_count=_.max(_.pluck(this.data.children,"count")),this.opacity_map=d3.scale.linear().domain([this.min_count,this.max_count,this.max_count+1]).range([.5,1,0]),this.vis.data([this.data]).selectAll("rect").data(this.treemap.nodes).enter().append("rect").attr("class",this.div_string+"_cell").attr("fill",this.fg_color).attr("opacity",function(b){return a.opacity_map(b.value)
}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("width",function(a){return a.dx}).attr("height",function(a){return a.dy}).attr("stroke","white").attr("stroke-width",2),this.vis_overlay.data([this.data]).selectAll("rect").data(this.treemap.nodes).enter().append("rect").attr("class",this.div_string+"_cell").attr("fill",this.fg_color).attr("opacity",0).attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("count",function(a){return a.count}).attr("_id",function(a){return a._id}).attr("width",function(a){return a.dx}).attr("height",function(a){return a.dy}).on("mousemove",function(){a.fadeIn_popover(d3.mouse(this),d3.select(d3.event.target))}).on("mouseout",function(){a.fadeOut_popover()}),this.vis.data([this.data]).selectAll("rect").transition().ease("cubic out").duration(500).attr("opacity",function(b){return a.opacity_map(b.value)}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("width",function(a){return a.dx}).attr("height",function(a){return a.dy}),this.vis_overlay.data([this.data]).selectAll("rect").transition().ease("cubic out").duration(500).attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("width",function(a){return a.dx}).attr("height",function(a){return a.dy}),this.vis.data([this.data]).selectAll("rect").data(this.treemap.nodes).exit().remove(),this.vis_overlay.data([this.data]).selectAll("rect").data(this.treemap.nodes).exit().remove(),this.clear_text(),setTimeout(function(){a.draw_text()},500)},fadeIn_popover:function(a,b){a[0]>this.width/2?d3.select("."+this.div_string+"tooltips").attr("x",a[0]-60):d3.select("."+this.div_string+"tooltips").attr("x",a[0]),a[1]>this.height/2?d3.select("."+this.div_string+"tooltips").attr("y",a[1]-50):d3.select("."+this.div_string+"tooltips").attr("y",a[1]+20),d3.select("."+this.div_string+"sig_id_label").text(b.attr("_id")),d3.select("."+this.div_string+"pert_desc_label").text(b.attr("count")),d3.select("."+this.div_string+"tooltips").attr("opacity",1)},fadeOut_popover:function(){d3.select("."+this.div_string+"tooltips").attr("opacity",0)},clear_text:function(){this.vis.data([this.data]).selectAll("text.name").data([]).exit().remove(),this.vis.data([this.data]).selectAll("text.count").data([]).exit().remove()},draw_text:function(){this.vis.data([this.data]).selectAll("text.name").data([]).exit().remove(),this.vis.data([this.data]).selectAll("text.name").data(this.treemap.nodes).enter().append("text").attr("class","name").text(function(a){return a.dy<20||a.dx<80?null:a.children?null:a._id}).attr("text-anchor","middle").attr("x",function(a){return a.x+a.dx/2}).attr("y",function(a){return a.y+a.dy/2}).attr("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").attr("font-weight","normal").attr("font-size","12pt").attr("fill","white").attr("opacity",0).transition().duration(500).attr("opacity",1),this.vis.data([this.data]).selectAll("text.count").data([]).exit().remove(),this.vis.data([this.data]).selectAll("text.count").data(this.treemap.nodes).enter().append("text").attr("class","name").text(function(a){return a.dy<40||a.dx<80?null:a.children?null:a.count}).attr("text-anchor","middle").attr("x",function(a){return a.x+a.dx/2}).attr("y",function(a){return a.y+a.dy/2+20}).attr("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").attr("font-weight","normal").attr("font-size","12pt").attr("fill","black").attr("opacity",0).transition().duration(500).attr("opacity",1)},savePng:function(){var a=this.top_svg.attr("width"),b=this.top_svg.attr("height"),c='<canvas id="tmpCanvas" width="'+a+'px" height="'+b+'px"></canvas>';$("body").append(c);var d=this.top_svg.selectAll("."+this.div_string+"png_export").data([1]),e=d.attr("opacity");d.attr("opacity",0);var f=this.top_svg.node().parentNode.innerHTML;canvg(document.getElementById("tmpCanvas"),"<svg>"+f+"</svg>",{ignoreMouse:!0,ignoreAnimation:!0});var g=$("#tmpCanvas")[0],h="cmapTreeMap"+(new Date).getTime()+".png";g.toBlob&&g.toBlob(function(a){saveAs(a,h)}),$("#tmpCanvas").remove(),d.attr("opacity",e)}}),GridView=Backbone.View.extend({initialize:function(){var a=this;this.search_val="",this.search_type="single",this.span_class=void 0!==this.options.span_class?this.options.span_class:"span12",this.template=void 0!==this.options.template?this.options.template:"../templates/CMapBaseGrid.handlebars",this.collection=void 0!==this.options.collection?this.options.collection:new PertCollection,this.columns=void 0!==this.options.columns?this.options.columns:[{name:"pert_iname",label:"Reagent Name",cell:"string",editable:!1},{name:"pert_type_label",label:"Pert Type",cell:HTMLCell,editable:!1},{name:"num_inst",label:"Experiments",cell:"integer",editable:!1}],this.compile_template();var b=Backgrid.Row.extend({events:{click:"onClick"},onClick:function(){Backbone.trigger("grid:RowClick",this.model),$(".cmap-active-grid-row").removeClass("cmap-active-grid-row"),this.$el.addClass("cmap-active-grid-row")}});this.grid=new Backgrid.Grid({row:b,columns:this.columns,collection:this.collection}),$("#"+this.div_string).append(this.grid.render().$el),$("#"+this.div_string,this.el).scroll(function(){a.checkscroll()}),$("#"+this.div_string+"_download",this.el).click(function(){a.download_table()})},checkscroll:function(){var a=100,b=$("#"+this.div_string).scrollTop()+$("#"+this.div_string).height()+a;!this.collection.isLoading&&b>$("#"+this.div_string)[0].scrollHeight&&(this.collection.skip+=30,this.update_collection())},replace_collection:function(a,b){this.search_val=void 0!==a?a:this.search_val,this.search_type=void 0!==b?b:this.search_type,$("#"+this.div_string).show(),$("#"+this.div_string).animate({opacity:1},500),this.collection.reset(),this.collection.skip=0,this.collection.getData(this.search_val,this.search_type),this.resize_div(),this.listenToOnce(this.collection,"add",function(){this.trigger("grid:ReplaceCollection")})},update_collection:function(a,b){this.search_val=void 0!==a?a:this.search_val,this.search_type=void 0!==b?b:this.search_type,$("#"+this.div_string).show(),$("#"+this.div_string).animate({opacity:1},500),this.collection.getData(this.search_val,this.search_type),this.resize_div()},clear_collection:function(){var a=this;this.collection.skip=0,$("#"+this.div_string).animate({opacity:0},500),window.setTimeout(function(){a.collection.reset(),$("#"+this.div_string).hide()},500)},resize_div:function(){var a=this,b=30*a.collection.length+40;300>b&&setTimeout(function(){var b=30*a.collection.length+40,b=b>300?300:b;$("#"+a.div_string).stop(),$("#"+a.div_string).animate({height:b},500)},500)},compile_template:function(){this.div_string="backgrid_target"+Math.round(1e6*Math.random()),this.raw_template=$.ajax({url:this.template,dataType:"html",async:!1}).responseText,this.compiled_template=Handlebars.compile(this.raw_template),this.$el.append(this.compiled_template({div_string:this.div_string,span_class:this.span_class}))},download_table:function(){var a=this;$("#"+this.div_string+"_download",this.el).html('<font color="#0072B2"><i class="icon-refresh icon-spin"></i> exporting</font>');var b=this.collection.url,c={q:this.collection.q_param,l:0,s:this.collection.s_param},d=_.pluck(this.columns,"label").join("	"),e=_.pluck(this.columns,"name");$.getJSON(b,c,function(b){var c=[d];b.forEach(function(a){var b=[];e.forEach(function(c){"pert_type_label"==c?b.push(CMapPertTypeAlias(a.pert_type).acronym):b.push(a[c])}),line_string=b.join("	"),c.push(line_string)});var f=c.join("\n"),g=new Blob([f],{type:"text/plain;charset=utf-8"}),h=(new Date).getTime();saveAs(g,"CMapSummaryTable"+h+".txt"),$("#"+a.div_string+"_download",a.el).html('<font color="#0072B2"><i class="icon-share"></i> export table</font>')})},hide:function(a){var b=this;this.$el.animate({opacity:0},a),setTimeout(function(){b.$el.hide()},a)},show:function(a){this.$el.show(),this.$el.animate({opacity:1},a)}}),HTMLFormatter=Backgrid.HTMLFormatter=function(){},HTMLFormatter.prototype=new Backgrid.CellFormatter,_.extend(HTMLFormatter.prototype,{fromRaw:function(a){return _.isUndefined(a)||_.isNull(a)?"":a}}),HTMLCell=Backgrid.HTMLCell=Backgrid.Cell.extend({className:"html-cell",formatter:new HTMLFormatter,render:function(){return this.$el.html(this.formatter.fromRaw(this.model.get(this.column.get("name")))),this}}),PertCountView=Backbone.View.extend({initialize:function(){this.bg_color=void 0!==this.options.bg_color?this.options.bg_color:"#ffffff",this.well_color=void 0!==this.options.well_color?this.options.well_color:"#bdbdbd",this.fg_color=void 0!==this.options.fg_color?this.options.fg_color:"#1b9e77",this.span_class=void 0!==this.options.span_class?this.options.span_class:"span4",this.static_text=void 0!==this.options.static_text?this.options.static_text:"Reagents",this.categories=void 0!==this.options.categories?this.options.categories:[],this.category_ids=_.pluck(this.categories,"_id"),this.max_category_count=_.max(_.pluck(this.categories,"count")),this.listenTo(this.model,"change",this.render),this.compile_template(),this.width=$("#"+this.div_string).outerWidth(),this.height=$("#"+this.div_string).outerHeight(),this.vis=d3.select("#"+this.div_string).append("svg").attr("width",this.width).attr("height",this.height),this.redraw();var a=this;$(window).resize(function(){a.redraw()})},compile_template:function(a){void 0===a&&(this.div_string="d3_target"+Math.round(1e6*Math.random()),a='<div id="'+this.div_string+'" class="'+this.span_class+'" style="height:180px"></div>');var b=Handlebars.compile(a);this.template_string=a,this.compiled_template=b,this.$el.append(b())},redraw:function(){this.init_panel(),this.render()},init_panel:function(){var a=this;this.width=$("#"+this.div_string).outerWidth(),this.height=$("#"+this.div_string).outerHeight(),this.vis.transition().duration(1).attr("width",this.width),this.vis.selectAll(".bg_panel").data([]).exit().remove(),this.vis.selectAll(".bg_panel").data([1]).enter().append("rect").attr("class","bg_panel").attr("height",this.height).attr("width",this.width).attr("fill",this.bg_color),this.vis.selectAll(".static_text").data([]).exit().remove(),this.vis.selectAll(".static_text").data([1]).enter().append("text").attr("class","static_text").attr("x",10).attr("y",14).attr("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").attr("font-weight","bold").attr("font-size","13pt").attr("fill",this.fg_color).text(this.static_text.toUpperCase());var b=this.model.get("pert_count");void 0===b&&(b=0);var c=this.vis.selectAll(".pert_count").data([]).exit().remove();c=this.vis.selectAll(".pert_count").data([1]).enter().append("text").attr("class","pert_count").attr("x",10).attr("y",55).attr("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").attr("font-weight","bold").attr("font-size","36pt").text(b),this.category_rect_selection=this.vis.selectAll(".category_rect_well"),this.category_rect_selection.data([]).exit().remove(),this.category_rect_selection.data(this.categories).enter().append("rect").attr("class","category_rect_well").attr("x",10).attr("y",function(a,b){return 35*b+80}).attr("height",10).attr("width",function(){return a.width-20}).attr("fill",this.well_color),this.category_rect_selection=this.vis.selectAll(".category_rect"),this.category_rect_selection.data([]).exit().remove(),this.category_rect_selection.data(this.categories).enter().append("rect").attr("class","category_rect").attr("x",10).attr("y",function(a,b){return 35*b+80}).attr("height",10).attr("width",function(b){return(a.width-20)*(b.count/a.max_category_count)}).attr("fill",this.fg_color),this.vis.selectAll(".category_name").data([]).exit().remove(),this.vis.selectAll(".category_name").data(this.categories).enter().append("text").attr("class","category_name").attr("x",10).attr("y",function(a,b){return 35*b+105}).attr("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").attr("font-weight","normal").attr("font-size","12pt").text(function(a){return a._id}),this.vis.selectAll(".category_value").data([]).exit().remove(),this.vis.selectAll(".category_value").data(this.categories).enter().append("text").attr("class","category_value").attr("x",this.width-10).attr("y",function(a,b){return 35*b+105}).attr("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").attr("font-weight","normal").attr("font-size","12pt").attr("text-anchor","end").text("xhtml:div").text(function(a){return a.count.toFixed(0)})},render:function(){var a=this;this.width=$("#"+this.div_string).outerWidth(),this.height=$("#"+this.div_string).outerHeight();var b=this.model.get("pert_count");void 0===b&&(b=0),this.vis.selectAll(".pert_count").data([1]).transition().duration(500).tween("text",function(){var a=d3.interpolate(this.textContent,b);return function(b){this.textContent=Math.round(a(b))}}),b=this.model.get("pert_count"),this.pert_types=this.model.get("pert_types"),this.pert_types=_.filter(this.pert_types,function(b){return-1!=a.category_ids.indexOf(b._id)}),this.categories.forEach(function(b,c){var d=_.pluck(a.pert_types,"_id"),e=d.indexOf(b._id);a.categories[c].count=-1!=e?a.pert_types[e].count:1e-5}),this.max_category_count=_.max(_.pluck(this.categories,"count")),this.max_category_count=this.max_category_count<1?1:this.max_category_count;var c=this.vis.selectAll(".category_rect").data(this.categories);c.transition().duration(500).attr("width",function(b){return(a.width-20)*(b.count/a.max_category_count)}),this.vis.selectAll(".category_value").data(this.categories).transition().duration(500).tween("text",function(a,b){var c=a.count.toFixed(0),b=d3.interpolate(this.textContent,c);return function(a){this.textContent=Math.round(b(a))}})}}),PertDetailView=Backbone.View.extend({initialize:function(){this.bg_color=void 0!==this.options.bg_color?this.options.bg_color:"#ffffff",this.listenTo(this.model,"change",this.render),this.compile_template(),this.width=$("#"+this.div_string).outerWidth(),this.height=$("#"+this.div_string).outerHeight(),this.vis=d3.select("#"+this.div_string).append("svg").attr("width",this.width).attr("height",this.height),this.redraw();var a=this;$(window).resize(function(){a.redraw()})},compile_template:function(a){void 0===a&&(this.div_string="d3_target"+Math.round(1e6*Math.random()),a='<div id="'+this.div_string+'" class="'+this.span_class+'" style="height:120px"></div>');var b=Handlebars.compile(a);this.template_string=a,this.compiled_template=b,this.$el.append(b())},redraw:function(){this.init_view(),this.render()},init_view:function(){var a=this;this.width=$("#"+this.div_string).outerWidth(),this.height=$("#"+this.div_string).outerHeight(),this.vis.attr("width",this.width),this.vis.selectAll(".bg_panel").data([]).exit().remove(),this.vis.selectAll(".bg_panel").data([1]).enter().append("rect").attr("class","bg_panel").attr("height",this.height).attr("width",this.width).attr("fill",this.bg_color),this.vis.selectAll(".index_text_icon").data([]).exit().remove(),this.vis.selectAll(".index_text_icon").data([1]).enter().append("foreignObject").attr("class","index_text_icon").attr("x",10).attr("y",0).attr("height",20).attr("width",20).append("xhtml:div").attr("id",this.div_id+"_index_text").style("background-color",this.bg_color).html('<p class="cmap-subhead-text"><font color="#56B4E9"><i class="icon-map-marker"></i></font><p>'),this.vis.selectAll(".index_text").data([]).exit().remove(),this.vis.selectAll(".index_text").data([1]).enter().append("text").attr("class","index_text").attr("x",25).attr("y",17).attr("fill","#56B4E9").attr("font-family","Helvetica Neue").attr("font-size","14pt").text("INDEX REAGENT"),this.vis.selectAll("."+this.div_string+"png_export").data([]).exit().remove(),this.vis.selectAll("."+this.div_string+"png_export").data([1]).enter().append("text").attr("class",this.div_string+"png_export no_png_export").attr("x",10).attr("y",this.height-10).attr("opacity",.25).style("cursor","pointer").text("png").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25).attr("fill","#000000")}).on("click",function(){a.save_png()})},render:function(){var a=this;if(this.vis.selectAll("."+this.div_string+"gene_wiki_link").data([]).exit().remove(),this.vis.selectAll(".gene_wiki_text").data([]).exit().remove(),""!==this.model.get("gene_wiki_link")){var b={action:"query",titles:this.model.get("short_description")+"_(gene)",prop:"extracts",format:"json",exchars:200,exlimit:1,exintro:!0,exsectionformat:"wiki",redirects:!0,explaintext:!0};$.getJSON("http://en.wikipedia.org/w/api.php?callback=?",b,function(b){a.vis.selectAll(".short_description_text").data([]).exit().remove(),a.vis.selectAll(".short_description_text").data([1]).enter().append("text").attr("class","short_description_text").attr("x",10).attr("y",60).attr("font-family","Helvetica Neue").attr("font-weight","bold").attr("font-size","36pt").text(a.model.get("short_description")),a.vis.selectAll(".long_description_text").data([]).exit().remove(),a.vis.selectAll(".long_description_text").data([1]).enter().append("text").attr("class","long_description_text").attr("x",10).attr("y",85).attr("font-family","Helvetica Neue").attr("font-size","14pt").text(a.model.get("long_description")),a.vis.selectAll("."+a.div_string+"gene_wiki_link").data([1]).enter().append("text").attr("class",a.div_string+"gene_wiki_link no_png_export").attr("x",40).attr("y",a.height-10).attr("opacity",.25).style("cursor","pointer").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25).attr("fill","#000000")}).on("click",function(){window.location.href=a.model.get("gene_wiki_link")}).text("wiki");for(var c in b.query.pages)if(b.query.pages.propertyIsEnumerable(c)){var d=b.query.pages[c].extract;if(void 0!==d){var e=["","","",""];e[0]=" "!=d.slice(0,50).slice(-1)?d.slice(0,50)+"-":d.slice(0,50),e[1]=" "!=d.slice(50,100).slice(-1)&&""!=d.slice(50,100).slice(49,50)?d.slice(50,100)+"-":d.slice(50,100),e[2]=" "!=d.slice(100,150).slice(-1)&&""!=d.slice(100,150).slice(49,50)?d.slice(100,150)+"-":d.slice(100,150),e[3]=""!=d.slice(100,150)?d.slice(150,200)+" ...":"",a.vis.selectAll("."+a.div_string+"gene_wiki_text1").data([1]).enter().append("text").attr("class",a.div_string+"gene_wiki_text1 gene_wiki_text").attr("x",a.width-425).attr("y",12).attr("font-family","Helvetica Neue").attr("font-size","13pt").attr("fill","#777777").text(e[0]),a.vis.selectAll("."+a.div_string+"gene_wiki_text2 ").data([1]).enter().append("text").attr("class",a.div_string+"gene_wiki_text2 gene_wiki_text").attr("x",a.width-425).attr("y",29).attr("font-family","Helvetica Neue").attr("font-size","13pt").attr("fill","#777777").text(e[1]),a.vis.selectAll("."+a.div_string+"gene_wiki_text3").data([1]).enter().append("text").attr("class",a.div_string+"gene_wiki_text3 gene_wiki_text").attr("x",a.width-425).attr("y",46).attr("font-family","Helvetica Neue").attr("font-size","13pt").attr("fill","#777777").text(e[2]),a.vis.selectAll("."+a.div_string+"gene_wiki_text4").data([1]).enter().append("text").attr("class",a.div_string+"gene_wiki_text4 gene_wiki_text").attr("x",a.width-425).attr("y",64).attr("font-family","Helvetica Neue").attr("font-size","13pt").attr("fill","#777777").text(e[3])}}})}else this.vis.selectAll(".short_description_text").data([]).exit().remove(),this.vis.selectAll(".short_description_text").data([1]).enter().append("text").attr("class","short_description_text").attr("x",10).attr("y",60).attr("font-family","Helvetica Neue").attr("font-weight","bold").attr("font-size","36pt").text(this.model.get("short_description")),this.vis.selectAll(".long_description_text").data([]).exit().remove(),this.vis.selectAll(".long_description_text").data([1]).enter().append("text").attr("class","long_description_text").attr("x",10).attr("y",85).attr("font-family","Helvetica Neue").attr("font-size","14pt").text(this.model.get("long_description"))},hide:function(a){a=void 0!==a?a:1;var b=this;this.$el.animate({opacity:0},a),setTimeout(function(){b.$el.hide()},a)},show:function(a){a=void 0!==a?a:1,this.$el.show(),this.$el.animate({opacity:1},a)},save_png:function(){var a=this.vis.attr("width"),b=this.vis.attr("height"),c='<canvas id="tmpCanvas" width="'+a+'px" height="'+b+'px"></canvas>';$("body").append(c);var d=this.vis.selectAll(".no_png_export"),e=d.attr("opacity");d.attr("opacity",0);var f=this.vis.node().parentNode.innerHTML;canvg(document.getElementById("tmpCanvas"),"<svg>"+f+"</svg>",{ignoreMouse:!0,ignoreAnimation:!0});var g=$("#tmpCanvas")[0],h="cmapPertDetailView"+(new Date).getTime()+".png";g.toBlob&&g.toBlob(function(a){saveAs(a,h)}),$("#tmpCanvas").remove(),d.attr("opacity",e)}}),PertSearchBar=Backbone.View.extend({initialize:function(){var a=this;this.match_cell_lines=void 0!==this.options.match_cell_lines?this.options.match_cell_lines:!0;var b="http://api.lincscloud.org/a2/cellinfo?callback=?",c={q:'{"cell_id":{"$regex":""}}',d:"cell_id"};$.getJSON(b,c,function(b){a.cell_lines=b,a.render(),$("#search",a.el).bind("input propertychange change",function(){var b=$("#search",a.el).val(),c="";-1!=a.cell_lines.indexOf(b)&&a.match_cell_lines&&(c="cell"),a.trigger("search:DidType",{val:b,type:c})})})},get_val:function(){return $("#search",this.el).val()},random_val:function(){var a=this;skip=Math.round(4e4*Math.random());var b="http://api.lincscloud.org/a2/pertinfo?callback=?";params={f:'{"pert_iname":1}',l:1,sk:skip},$.getJSON(b,params,function(b){var c=b[0].pert_iname;$("#search",this.el).val(c),a.trigger("search:DidType",{val:c,type:"single"})})},set_val:function(a){$("#search",this.el).val(a),this.trigger("search:DidType",{val:a,type:"single"})},template:function(a){void 0===a&&(a='<div class="input-append span10"><input class="span12" autocomplete="off" type="text" placeholder="search gene, compound, or cell type name; separate compound searches with :" data-provide="typeahead" id="search"><span class="add-on">Search 1,209,824 profiles</span></div>');var b=Handlebars.compile(a);return b},render:function(){var a=this;this.$el.html(this.template());var b=[],c="http://api.lincscloud.org/a2/pertinfo?callback=?",d={};$("#search",this.$el).typeahead({items:4,source:function(e,f){var g=$("#search",this.$el).val();return $.getJSON(c,{q:'{"pert_iname":{"$regex":"'+g+'", "$options":"i"}}',f:'{"pert_iname":1,"pert_type":1}',l:100,s:'{"pert_iname":1}'},function(c){return c.forEach(function(a){b.push(a.pert_iname),d[a.pert_iname]=a}),b=_.uniq(b),a.match_cell_lines&&(b=b.concat(a.cell_lines)),f(b)})},highlighter:function(b){return-1!=a.cell_lines.indexOf(b)?'<div><span class="label" style="background-color: #CC79A7">Cellular Context</span>  '+b+"</div>":"trt_sh"===d[b].pert_type||"trt_oe"===d[b].pert_type?'<div><span class="label" style="background-color: #0072B2">Genetic Reagent</span>  '+b+"</div>":"trt_cp"===d[b].pert_type?'<div><span class="label" style="background-color: #E69F00">Chemical Reagent</span>  '+b+"</div>":void 0}})}}),TickView=Backbone.View.extend({initialize:function(){this.bg_color=void 0!==this.options.bg_color?this.options.bg_color:"#eeeeee",this.span_class=void 0!==this.options.span_class?this.options.span_class:"#span12",this.template=void 0!==this.options.template?this.options.template:"../templates/d3_target.handlebars",this.listenTo(this.model,"change",this.redraw),this.compile_template_and_draw();var a=this;$(window).resize(function(){a.redraw()})},compile_template_and_draw:function(){var a=this;this.isCompiling=!0,$.ajax({url:a.template,datatype:"html",success:function(b){a.div_string="d3_target"+Math.round(1e6*Math.random()),a.compiled_template=Handlebars.compile(b),a.$el.append(a.compiled_template({div_string:a.div_string,span_class:a.span_class})),a.vis=d3.select("#"+a.div_string).append("svg").attr("width",a.width).attr("height",a.height),a.isCompiling=!1,a.redraw()}})},redraw:function(){var a=this;this.width=$("#"+this.div_string).outerWidth(),$("#"+this.div_string).animate({height:18*_.keys(this.model.get("data_object")).length+50},500),setTimeout(function(){a.height=$("#"+a.div_string).outerHeight(),a.init_view(),a.render()},501)},init_view:function(){var a=this;this.$el.is(":hidden")&&(this.$el.animate({opacity:0},1),this.$el.show()),this.vis.attr("width",this.width),this.vis.attr("height",this.height),this.margin=25,this.well_offset=80,this.x_scale=d3.scale.linear().domain([-1,1]).range([this.well_offset+this.margin,this.width-this.margin]),this.vis.selectAll(".bg_layer").data([]).exit().remove(),this.bg_layer=this.vis.append("g").attr("class","bg_layer"),this.vis.selectAll(".fg_layer").data([]).exit().remove(),this.fg_layer=this.vis.append("g").attr("class","fg_layer"),this.bg_layer.selectAll(".bg_panel").data([]).exit().remove(),this.bg_layer.selectAll(".bg_panel").data([1]).enter().append("rect").attr("class","bg_panel").attr("height",this.height).attr("width",this.width).attr("fill",this.bg_color);var b=d3.svg.axis().scale(this.x_scale).orient("bottom");this.vis.selectAll(".axis").data([]).exit().remove(),this.vis.append("g").attr("class","axis").attr("transform","translate(0,"+(this.height-this.margin)+")").call(b),this.vis.select(".axis").selectAll("path").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges"),this.vis.select(".axis").selectAll("line").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges"),this.vis.select(".axis").selectAll("text").style("font-family","sans-serif").style("font-size","11px");var c=_.pairs(this.model.get("data_object"));c.sort(function(a,b){return b>a?1:a>b?-1:0});var d=[],e=[];c.forEach(function(a){d.push(a[0]),e.push(a[1])}),this.fg_layer.selectAll(".title_text").data([]).exit().remove(),this.fg_layer.selectAll(".title_text").data([1]).enter().append("text").attr("class","title_text").attr("x",this.width/2).attr("y",17).attr("fill","#56B4E9").attr("font-family","Helvetica Neue").attr("font-size","14pt").attr("text-anchor","middle").text(this.model.get("title")),this.fg_layer.selectAll(".category_well").data([]).exit().remove(),this.fg_layer.selectAll(".category_well").data(d).enter().append("rect").attr("class","category_well").attr("x",this.margin+this.well_offset).attr("y",function(a,b){return 18*b+23}).attr("height",17).attr("width",this.width-2*this.margin-this.well_offset).attr("fill",function(a,b){return 0==b%2?"#bdbdbd":"#999999"}),e.forEach(function(b,c){tick_class=d[c]+"tick",a.fg_layer.selectAll("."+tick_class).data([]).exit().remove(),a.fg_layer.selectAll("."+tick_class).data(b).enter().append("rect").attr("class","tick "+tick_class).attr("x",a.x_scale).attr("y",18*c+23).attr("height",17).attr("width",3).attr("fill","#ff0000")}),this.fg_layer.selectAll("."+this.div_string+"png_export").data([]).exit().remove(),this.fg_layer.selectAll("."+this.div_string+"png_export").data([1]).enter().append("text").attr("class",this.div_string+"png_export no_png_export").attr("x",10).attr("y",this.height-10).attr("opacity",.25).style("cursor","pointer").text("png").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25).attr("fill","#000000")}).on("click",function(){a.save_png()})},render:function(){var a=_.pairs(this.model.get("data_object")),b=[],c=[];a.forEach(function(a){b.push(a[0]),c.push(a[1])}),this.category_text_selection=this.fg_layer.selectAll(".category_text").data(b),this.category_text_selection.enter().append("text").attr("class","category_text").attr("x",this.margin).attr("y",function(a,b){return 18*b+40}).attr("font-family","Helvetica Neue").attr("font-size","14pt").text(function(a){return a}),this.category_text_selection.exit().remove()},hide:function(a){function b(){c.isCompiling||(clearInterval(d),c.width=c.width=$("#"+c.div_string).outerWidth(),setTimeout(function(){c.$el.hide()},a))}a=void 0!==a?a:1;var c=this;this.$el.animate({opacity:0},a);var d=setInterval(b(),1)},show:function(a){a=void 0!==a?a:1,this.$el.show(),this.$el.animate({opacity:1},a)},save_png:function(){var a=this.vis.attr("width"),b=this.vis.attr("height"),c='<canvas id="tmpCanvas" width="'+a+'px" height="'+b+'px"></canvas>';$("body").append(c);var d=this.vis.selectAll(".no_png_export"),e=d.attr("opacity");d.attr("opacity",0);var f=this.vis.node().parentNode.innerHTML;canvg(document.getElementById("tmpCanvas"),"<svg>"+f+"</svg>",{ignoreMouse:!0,ignoreAnimation:!0});var g=$("#tmpCanvas")[0],h="cmapTickView"+(new Date).getTime()+".png";g.toBlob&&g.toBlob(function(a){saveAs(a,h)}),$("#tmpCanvas").remove(),d.attr("opacity",e)}});var PertCollection=Backbone.Collection.extend({model:PertModel,url:"http://api.lincscloud.org/a2/pertinfo?callback=?",skip:0,isLoading:!1,getData:function(a,b,c){var d=this;this.isLoading=!0,this.search_string=a,this.search_type=b,this.limit=void 0!==c?c:30,("single"===b||void 0===b)&&(this.q_param='{"pert_iname":{"$regex":"'+a+'","$options":"i"}}'),"multi"===b&&(a='["'+a.split(":").join('","')+'"]',this.q_param='{"pert_iname":{"$in":"'+a+'"}}'),"cell"===b&&(this.q_param='{"cell_id":"'+a+'"}'),this.s_param='{"pert_iname":1}';var e={q:this.q_param,l:this.limit,s:this.s_param,sk:this.skip};this.fetch({data:$.param(e),remove:!1,success:function(){d.isLoading=!1}})}}),SummlyResultCollection=Backbone.Collection.extend({model:SummlyResultModel,url:"http://api.lincscloud.org/a2/pertinfo?callback=?",skip:0,isLoading:!1,getData:function(a,b,c){var d=this;this.isLoading=!0,this.search_string=a,this.search_type=b,this.limit=void 0!==c?c:30,("single"===b||void 0===b)&&(this.q_param='{"pert_iname":{"$regex":"","$options":"i"}}'),"multi"===b&&(a='["'+a.split(":").join('","')+'"]',this.q_param='{"pert_iname":{"$in":"'+a+'"}}');var e={q:this.q_param,l:this.limit,s:'{"num_gold":1}',sk:Math.round(39970*Math.random())};$.getJSON(this.url,e,function(b){var c=[],e=["ASC","HA1E","HCC515","NEU","NPC","PHH","SKL","MCF7","HEPG2","VCAP","A549","A375","HT29","PC3"];b.forEach(function(b){var d=e.slice(0,Math.round(14*Math.random())+1),f={};d.forEach(function(a){f[a]=[2*Math.random()-1]}),c.push({query:a,target:b.pert_iname,pert_type:b.pert_type,summly_score:Math.random(),summly_rank:Math.random(),specificity:Math.random(),cell_line_scores:f})}),d.add(c),d.isLoading=!1})}});Tile.prototype.init=function(){this.build_html(),this.inject(),this.draw_bg(),this.init_state=!0;var a=this;$(window).resize(function(){a.draw_bg()})},Tile.prototype.build_html=function(){"small"==this.tile_type&&(this.html='<div id="'+this.div_id+'" class="span3" style="height:150px '+this.style+'"></div>'),"medium"==this.tile_type&&(this.html='<div id="'+this.div_id+'" class="span6" style="height:300px '+this.style+'"></div>'),"wide"==this.tile_type&&(this.html='<div id="'+this.div_id+'" class="span12" style="height:300px '+this.style+'"></div>')},Tile.prototype.inject=function(){$(this.div_target).append(this.html)},Tile.prototype.draw_bg=function(){this.width=$("#"+this.div_id).outerWidth(),this.height="small"==this.tile_type?150:300,this.init_state||(this.svg=d3.select("#"+this.div_id).append("svg").attr("class",this.div_id+"_tile_svg").attr("width",this.width).attr("height",this.height),this.svg.append("g").attr("class","draw_layer"),this.svg.append("g").attr("class","link_layer"),this.link_selection=this.svg.select(".link_layer").selectAll("rect.link_rect").data([1]),this.link_selection.enter().append("a").attr("xlink:href",this.link).append("rect").attr("x",0).attr("y",0).attr("rx",20).attr("ry",20).attr("class","link_rect").attr("height",this.height).attr("width",this.width).attr("fill",this.color).attr("opacity",0)),this.svg.select(".draw_layer").selectAll("rect.bg").data([]).exit().remove(),this.svg.select(".draw_layer").selectAll("rect.bg").data([1]).enter().append("rect").attr("x",0).attr("y",0).attr("rx",20).attr("ry",20).attr("class","bg").attr("height",this.height).attr("width",this.width).attr("fill",this.color)
},Tile.prototype.hide=function(a){a=void 0!==a?a:0,$("#"+this.div_id).animate({opacity:0,width:0,height:0},a);var b=this;setTimeout(function(){$("#"+b.div_id).hide()},a)},Tile.prototype.show=function(a){a=void 0!==a?a:0,$("#"+this.div_id).show(),$("#"+this.div_id).animate({opacity:1,width:this.width,height:this.height},a)},ImageTile.prototype=new Tile({display:!1}),ImageTile.prototype.constructor=ImageTile,ImageTile.prototype.draw=function(){this.draw_bg(),this.draw_image()},ImageTile.prototype.draw_image=function(){this.width=$("#"+this.div_id).outerWidth(),this.height="small"==this.tile_type?150:300,this.init_state||(this.svg=d3.select("#"+this.div_id).append("svg").attr("class",this.div_id+"_tile_svg").attr("width",this.width).attr("height",this.height)),this.image_size=this.height-50,this.svg.select(".draw_layer").selectAll("image."+this.div_id).data([]).exit().remove(),this.image_selection=this.svg.select(".draw_layer").selectAll("image."+this.div_id).data([1]).enter().append("image").attr("xlink:href",this.image).attr("class",this.div_id).attr("x",this.width/2-this.image_size/2).attr("y",this.height/2-this.image_size/2).attr("height",this.image_size).attr("width",this.image_size)},AnimatedImageTile.prototype=new ImageTile({display:!1}),AnimatedImageTile.prototype.constructor=AnimatedImageTile,AnimatedImageTile.prototype.draw=function(){this.draw_bg(),this.draw_image()},AnimatedImageTile.prototype.start_animation=function(a,b){a=void 0!==a?a:2e3,b=void 0!==b?b:1e4+1e4*Math.random();var c=this;setInterval(function(){c.image_selection.transition().duration(a/2).attr("y",-c.image_size-10).transition().duration(1).attr("y",c.height+c.image_size+10).transition().duration(a/2).attr("y",c.height/2-c.image_size/2)},b)},ImageTextTile.prototype=new ImageTile({display:!1}),ImageTextTile.prototype.constructor=ImageTextTile,ImageTextTile.prototype.draw=function(){this.draw_bg(),this.draw_image(),this.draw_text()},ImageTextTile.prototype.draw_text=function(){if(this.width=$("#"+this.div_id).outerWidth(),this.height="small"==this.tile_type?150:300,this.init_state||(this.svg=d3.select("#"+this.div_id).append("svg").attr("class",this.div_id+"_tile_svg").attr("width",this.width).attr("height",this.height)),"wide"==this.tile_type||"medium"==this.tile_type){var a,b,c,d,e;"wide"==this.tile_type&&(a=2*(this.width/3),b=5*(this.height/10),c=5*(this.height/10),d=this.width/3-20,e="<h2>"+this.title+"</h2>"),"medium"==this.tile_type&&(a=20,b=8.5*(this.height/10),c=1.5*(this.height/10),d=this.width-40,e="<h3>"+this.title+"</h3>"),this.svg.select(".draw_layer").selectAll(".tile_text").data([]).exit().remove(),this.svg.select(".draw_layer").selectAll(".tile_text").data([this.title]).enter().append("foreignObject").attr("class","tile_text").attr("x",a).attr("y",b).attr("height",c).attr("width",d).append("xhtml:div").style("background-color",this.color).html(e)}},AnimatedImageTextTile.prototype=new ImageTile({display:!1}),AnimatedImageTextTile.prototype.constructor=AnimatedImageTextTile,AnimatedImageTextTile.prototype.draw=function(){this.draw_bg(),this.draw_image(),this.draw_text();var a=this;this.link_selection.on("mouseover",function(){a.show_text()}),this.link_selection.on("mouseout",function(){a.hide_text()})},AnimatedImageTextTile.prototype.show_text=function(){this.TextIsAnimating||$("#"+this.div_id+"_tile_text").animate({opacity:1},500),this.TextIsAnimating=!0;var a=this;setTimeout(function(){a.TextIsAnimatingIn=!1},500)},AnimatedImageTextTile.prototype.hide_text=function(){this.TextIsAnimating||$("#"+this.div_id+"_tile_text").animate({opacity:0},500),this.TextIsAnimating=!0;var a=this;setTimeout(function(){a.TextIsAnimatingOut=!1},500)},AnimatedImageTextTile.prototype.draw_text=function(){this.width=$("#"+this.div_id).outerWidth(),this.height="small"==this.tile_type?150:300,this.init_state||(this.svg=d3.select("#"+this.div_id).append("svg").attr("class",this.div_id+"_tile_svg").attr("width",this.width).attr("height",this.height));var a,b,c,d,e;a=0,b=20,c=this.height-40,d=this.width,"wide"==this.tile_type&&(e="<h2>"+this.title+"</h2>"),("medium"==this.tile_type||"small"==this.tile_type)&&(e="<h3>"+this.title+"</h3>"),this.svg.select(".draw_layer").selectAll(".tile_text").data([]).exit().remove(),this.svg.select(".draw_layer").selectAll(".tile_text").data([this.title]).enter().append("foreignObject").attr("class","tile_text").attr("x",a).attr("y",b).attr("height",c).attr("width",d).style("pointer-events","none").append("xhtml:div").attr("id",this.div_id+"_tile_text").style("opacity",0).style("background-color","#ffffff").html(e)},FullAnimatedImageTextTile.prototype=new AnimatedImageTile({display:!1}),FullAnimatedImageTextTile.prototype.constructor=FullAnimatedImageTextTile,FullAnimatedImageTextTile.prototype.draw=function(){this.draw_bg(),this.draw_image(),this.draw_text();var a=this;this.link_selection.on("mouseover",function(){a.show_text()}),this.link_selection.on("mouseout",function(){a.hide_text()})},FullAnimatedImageTextTile.prototype.show_text=function(){this.TextIsAnimatingIn||$("#"+this.div_id+"_tile_text").animate({opacity:1},500),this.TextIsAnimating=!0;var a=this;setTimeout(function(){a.TextIsAnimatingIn=!1},500)},FullAnimatedImageTextTile.prototype.hide_text=function(){this.TextIsAnimatingOut||$("#"+this.div_id+"_tile_text").animate({opacity:0},500),this.TextIsAnimating=!0;var a=this;setTimeout(function(){a.TextIsAnimatingOut=!1},500)},FullAnimatedImageTextTile.prototype.draw_text=function(){this.width=$("#"+this.div_id).outerWidth(),this.height="small"==this.tile_type?150:300,this.init_state||(this.svg=d3.select("#"+this.div_id).append("svg").attr("class",this.div_id+"_tile_svg").attr("width",this.width).attr("height",this.height));var a,b,c,d,e;a=0,b=20,c=this.height-40,d=this.width,"wide"==this.tile_type&&(e="<h2>"+this.title+"</h2>"),("medium"==this.tile_type||"small"==this.tile_type)&&(e="<h3>"+this.title+"</h3>"),this.svg.select(".draw_layer").selectAll(".tile_text").data([]).exit().remove(),this.svg.select(".draw_layer").selectAll(".tile_text").data([this.title]).enter().append("foreignObject").attr("class","tile_text").attr("x",a).attr("y",b).attr("height",c).attr("width",d).style("pointer-events","none").append("xhtml:body").attr("id",this.div_id+"_tile_text").attr("height",c).attr("width",d).style("background-color","#ffffff").style("opacity",0).html(e)};